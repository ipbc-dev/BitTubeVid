var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),__awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{u(i.next(e))}catch(t){s(t)}}function o(e){try{u(i.throw(e))}catch(t){s(t)}}function u(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(a,o)}u((i=i.apply(e,t||[])).next())}))},__generator=this&&this.__generator||function(e,t){var n,i,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(o){s=[6,o],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}};(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"0ovO":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("NOtv"),r=n("A+nu");t.HttpMediaManager=function(e){function t(t){var n=this;return(n=e.call(this)||this).settings=t,n.xhrRequests=new Map,n.failedSegments=new Map,n.debug=i("p2pml:http-media-manager"),n.now=function(){return performance.now()},n}return __extends(t,e),t.prototype.download=function(e,t){if(!this.isDownloading(e)){this.cleanTimedOutFailedSegments();var n=this.settings.segmentUrlBuilder?this.settings.segmentUrlBuilder(e):e.url;this.debug("http segment download",n),e.requestUrl=n;var i=new XMLHttpRequest;if(i.open("GET",n,!0),i.responseType="arraybuffer",e.range)i.setRequestHeader("Range",e.range),t=void 0;else if(void 0!==t&&this.settings.httpUseRanges){for(var r=0,s=0,a=t;s<a.length;s++){r+=a[s].byteLength}i.setRequestHeader("Range","bytes="+r+"-"),this.debug("continue download from",r)}else t=void 0;this.setupXhrEvents(i,e,t),this.settings.xhrSetup&&this.settings.xhrSetup(i,n),this.xhrRequests.set(e.id,{xhr:i,segment:e}),i.send()}},t.prototype.abort=function(e){var t=this.xhrRequests.get(e.id);t&&(t.xhr.abort(),this.xhrRequests.delete(e.id),this.debug("http segment abort",e.id))},t.prototype.isDownloading=function(e){return this.xhrRequests.has(e.id)},t.prototype.isFailed=function(e){var t=this.failedSegments.get(e.id);return void 0!==t&&t>this.now()},t.prototype.getActiveDownloads=function(){return this.xhrRequests},t.prototype.getActiveDownloadsCount=function(){return this.xhrRequests.size},t.prototype.destroy=function(){this.xhrRequests.forEach((function(e){return e.xhr.abort()})),this.xhrRequests.clear()},t.prototype.setupXhrEvents=function(e,t,n){var i=this,r=0;e.addEventListener("progress",(function(e){i.emit("bytes-downloaded",e.loaded-r),r=e.loaded})),e.addEventListener("load",(function(r){return __awaiter(i,void 0,void 0,(function(){var i,s,a,o,u,d,g,l,h;return __generator(this,(function(c){switch(c.label){case 0:if(r.target.status<200||r.target.status>=300)return[2,void this.segmentFailure(t,r,e)];if(i=r.target.response,void 0!==n&&206===r.target.status){for(s=0,a=0,o=n;a<o.length;a++)h=o[a],s+=h.byteLength;for(u=new Uint8Array(s+i.byteLength),d=0,g=0,l=n;g<l.length;g++)h=l[g],u.set(new Uint8Array(h),d),d+=h.byteLength;u.set(new Uint8Array(i),d),i=u.buffer}return[4,this.segmentDownloadFinished(t,i,e)];case 1:return c.sent(),[2]}}))}))})),e.addEventListener("error",(function(n){i.segmentFailure(t,n,e)})),e.addEventListener("timeout",(function(n){i.segmentFailure(t,n,e)}))},t.prototype.segmentDownloadFinished=function(e,t,n){return __awaiter(this,void 0,void 0,(function(){var i;return __generator(this,(function(r){switch(r.label){case 0:if(e.responseUrl=null===n.responseURL?void 0:n.responseURL,!this.settings.segmentValidator)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.settings.segmentValidator(Object.assign(Object.assign({},e),{data:t}),"http")];case 2:return r.sent(),[3,4];case 3:return i=r.sent(),[2,(this.debug("segment validator failed",i),void this.segmentFailure(e,i,n))];case 4:return this.xhrRequests.delete(e.id),this.emit("segment-loaded",e,t),[2]}}))}))},t.prototype.segmentFailure=function(e,t,n){e.responseUrl=null===n.responseURL?void 0:n.responseURL,this.xhrRequests.delete(e.id),this.failedSegments.set(e.id,this.now()+this.settings.httpFailedSegmentTimeout),this.emit("segment-error",e,t)},t.prototype.cleanTimedOutFailedSegments=function(){var e=this,t=this.now(),n=[];this.failedSegments.forEach((function(e,i){e<t&&n.push(i)})),n.forEach((function(t){return e.failedSegments.delete(t)}))},t}(r.STEEmitter)},"10ky":function(e,t,n){"use strict";n.r(t),n.d(t,"LineStream",(function(){return u})),n.d(t,"ParseStream",(function(){return g})),n.d(t,"Parser",(function(){return h}));var i=n("vgmO"),r=n.n(i);function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function a(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var o=function(){function e(){this.listeners={}}var t=e.prototype;return t.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.off=function(e,t){if(!this.listeners[e])return!1;var n=this.listeners[e].indexOf(t);return this.listeners[e].splice(n,1),n>-1},t.trigger=function(e){var t,n,i,r=this.listeners[e];if(r)if(2===arguments.length)for(n=r.length,t=0;t<n;++t)r[t].call(this,arguments[1]);else for(i=Array.prototype.slice.call(arguments,1),n=r.length,t=0;t<n;++t)r[t].apply(this,i)},t.dispose=function(){this.listeners={}},t.pipe=function(e){this.on("data",(function(t){e.push(t)}))},e}(),u=function(e){function t(){var t;return(t=e.call(this)||this).buffer="",t}return a(t,e),t.prototype.push=function(e){var t;for(this.buffer+=e,t=this.buffer.indexOf("\n");t>-1;t=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)},t}(o),d=function(e){for(var t,n=e.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')),i={},r=n.length;r--;)""!==n[r]&&((t=/([^=]*)=(.*)/.exec(n[r]).slice(1))[0]=t[0].replace(/^\s+|\s+$/g,""),t[1]=t[1].replace(/^\s+|\s+$/g,""),t[1]=t[1].replace(/^['"](.*)['"]$/g,"$1"),i[t[0]]=t[1]);return i},g=function(e){function t(){var t;return(t=e.call(this)||this).customParsers=[],t.tagMappers=[],t}a(t,e);var n=t.prototype;return n.push=function(e){var t,n,i=this;0!==(e=e.trim()).length&&("#"===e[0]?this.tagMappers.reduce((function(t,n){var i=n(e);return i===e?t:t.concat([i])}),[e]).forEach((function(e){for(var r=0;r<i.customParsers.length;r++)if(i.customParsers[r].call(i,e))return;if(0===e.indexOf("#EXT"))if(e=e.replace("\r",""),t=/^#EXTM3U/.exec(e))i.trigger("data",{type:"tag",tagType:"m3u"});else{if(t=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(e))return n={type:"tag",tagType:"inf"},t[1]&&(n.duration=parseFloat(t[1])),t[2]&&(n.title=t[2]),void i.trigger("data",n);if(t=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(e))return n={type:"tag",tagType:"targetduration"},t[1]&&(n.duration=parseInt(t[1],10)),void i.trigger("data",n);if(t=/^#ZEN-TOTAL-DURATION:?([0-9.]*)?/.exec(e))return n={type:"tag",tagType:"totalduration"},t[1]&&(n.duration=parseInt(t[1],10)),void i.trigger("data",n);if(t=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(e))return n={type:"tag",tagType:"version"},t[1]&&(n.version=parseInt(t[1],10)),void i.trigger("data",n);if(t=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(e))return n={type:"tag",tagType:"media-sequence"},t[1]&&(n.number=parseInt(t[1],10)),void i.trigger("data",n);if(t=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(e))return n={type:"tag",tagType:"discontinuity-sequence"},t[1]&&(n.number=parseInt(t[1],10)),void i.trigger("data",n);if(t=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(e))return n={type:"tag",tagType:"playlist-type"},t[1]&&(n.playlistType=t[1]),void i.trigger("data",n);if(t=/^#EXT-X-BYTERANGE:?([0-9.]*)?@?([0-9.]*)?/.exec(e))return n={type:"tag",tagType:"byterange"},t[1]&&(n.length=parseInt(t[1],10)),t[2]&&(n.offset=parseInt(t[2],10)),void i.trigger("data",n);if(t=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(e))return n={type:"tag",tagType:"allow-cache"},t[1]&&(n.allowed=!/NO/.test(t[1])),void i.trigger("data",n);if(t=/^#EXT-X-MAP:?(.*)$/.exec(e)){if(n={type:"tag",tagType:"map"},t[1]){var s=d(t[1]);if(s.URI&&(n.uri=s.URI),s.BYTERANGE){var a=s.BYTERANGE.split("@"),o=a[0],u=a[1];n.byterange={},o&&(n.byterange.length=parseInt(o,10)),u&&(n.byterange.offset=parseInt(u,10))}}i.trigger("data",n)}else if(t=/^#EXT-X-STREAM-INF:?(.*)$/.exec(e)){if(n={type:"tag",tagType:"stream-inf"},t[1]){if(n.attributes=d(t[1]),n.attributes.RESOLUTION){var g=n.attributes.RESOLUTION.split("x"),l={};g[0]&&(l.width=parseInt(g[0],10)),g[1]&&(l.height=parseInt(g[1],10)),n.attributes.RESOLUTION=l}n.attributes.BANDWIDTH&&(n.attributes.BANDWIDTH=parseInt(n.attributes.BANDWIDTH,10)),n.attributes["PROGRAM-ID"]&&(n.attributes["PROGRAM-ID"]=parseInt(n.attributes["PROGRAM-ID"],10))}i.trigger("data",n)}else{if(t=/^#EXT-X-MEDIA:?(.*)$/.exec(e))return n={type:"tag",tagType:"media"},t[1]&&(n.attributes=d(t[1])),void i.trigger("data",n);if(t=/^#EXT-X-ENDLIST/.exec(e))i.trigger("data",{type:"tag",tagType:"endlist"});else if(t=/^#EXT-X-DISCONTINUITY/.exec(e))i.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(t=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(e))return n={type:"tag",tagType:"program-date-time"},t[1]&&(n.dateTimeString=t[1],n.dateTimeObject=new Date(t[1])),void i.trigger("data",n);if(t=/^#EXT-X-KEY:?(.*)$/.exec(e))return n={type:"tag",tagType:"key"},t[1]&&(n.attributes=d(t[1]),n.attributes.IV&&("0x"===n.attributes.IV.substring(0,2).toLowerCase()&&(n.attributes.IV=n.attributes.IV.substring(2)),n.attributes.IV=n.attributes.IV.match(/.{8}/g),n.attributes.IV[0]=parseInt(n.attributes.IV[0],16),n.attributes.IV[1]=parseInt(n.attributes.IV[1],16),n.attributes.IV[2]=parseInt(n.attributes.IV[2],16),n.attributes.IV[3]=parseInt(n.attributes.IV[3],16),n.attributes.IV=new Uint32Array(n.attributes.IV))),void i.trigger("data",n);if(t=/^#EXT-X-START:?(.*)$/.exec(e))return n={type:"tag",tagType:"start"},t[1]&&(n.attributes=d(t[1]),n.attributes["TIME-OFFSET"]=parseFloat(n.attributes["TIME-OFFSET"]),n.attributes.PRECISE=/YES/.test(n.attributes.PRECISE)),void i.trigger("data",n);if(t=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(e))return(n={type:"tag",tagType:"cue-out-cont"}).data=t[1]?t[1]:"",void i.trigger("data",n);if(t=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(e))return(n={type:"tag",tagType:"cue-out"}).data=t[1]?t[1]:"",void i.trigger("data",n);if(t=/^#EXT-X-CUE-IN:?(.*)?$/.exec(e))return(n={type:"tag",tagType:"cue-in"}).data=t[1]?t[1]:"",void i.trigger("data",n);i.trigger("data",{type:"tag",data:e.slice(4)})}}}else i.trigger("data",{type:"comment",text:e.slice(1)})})):this.trigger("data",{type:"uri",uri:e}))},n.addParser=function(e){var t=this,n=e.expression,i=e.customType,r=e.dataParser,s=e.segment;"function"!=typeof r&&(r=function(e){return e}),this.customParsers.push((function(e){if(n.exec(e))return t.trigger("data",{type:"custom",data:r(e),customType:i,segment:s}),!0}))},n.addTagMapper=function(e){var t=e.expression,n=e.map;this.tagMappers.push((function(e){return t.test(e)?n(e):e}))},t}(o);function l(e){for(var t=r.a.atob(e||""),n=new Uint8Array(t.length),i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}var h=function(e){function t(){var t;(t=e.call(this)||this).lineStream=new u,t.parseStream=new g,t.lineStream.pipe(t.parseStream);var n,i,r=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t),a=[],o={},d=function(){},h={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},c=0;return t.manifest={allowCache:!0,discontinuityStarts:[],segments:[]},t.parseStream.on("data",(function(e){var t,u;({tag:function(){({"allow-cache":function(){this.manifest.allowCache=e.allowed,"allowed"in e||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var t={};"length"in e&&(o.byterange=t,t.length=e.length,"offset"in e||(this.trigger("info",{message:"defaulting offset to zero"}),e.offset=0)),"offset"in e&&(o.byterange=t,t.offset=e.offset)},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),e.duration>0&&(o.duration=e.duration),0===e.duration&&(o.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=a},key:function(){if(e.attributes)if("NONE"!==e.attributes.METHOD)if(e.attributes.URI){if("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===e.attributes.KEYFORMAT)return-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(e.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===e.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==e.attributes.URI.substring(0,23)?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):e.attributes.KEYID&&"0x"===e.attributes.KEYID.substring(0,2)?void(this.manifest.contentProtection={"com.widevine.alpha":{attributes:{schemeIdUri:e.attributes.KEYFORMAT,keyId:e.attributes.KEYID.substring(2)},pssh:l(e.attributes.URI.split(",")[1])}}):void this.trigger("warn",{message:"invalid key ID provided for Widevine"}));e.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),i={method:e.attributes.METHOD||"AES-128",uri:e.attributes.URI},void 0!==e.attributes.IV&&(i.iv=e.attributes.IV)}else this.trigger("warn",{message:"ignoring key declaration without URI"});else i=null;else this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence":function(){isFinite(e.number)?this.manifest.mediaSequence=e.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+e.number})},"discontinuity-sequence":function(){isFinite(e.number)?(this.manifest.discontinuitySequence=e.number,c=e.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+e.number})},"playlist-type":function(){/VOD|EVENT/.test(e.playlistType)?this.manifest.playlistType=e.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+e.playlist})},map:function(){n={},e.uri&&(n.uri=e.uri),e.byterange&&(n.byterange=e.byterange)},"stream-inf":function(){this.manifest.playlists=a,this.manifest.mediaGroups=this.manifest.mediaGroups||h,e.attributes?(o.attributes||(o.attributes={}),s(o.attributes,e.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media:function(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||h,e.attributes&&e.attributes.TYPE&&e.attributes["GROUP-ID"]&&e.attributes.NAME){var n=this.manifest.mediaGroups[e.attributes.TYPE];n[e.attributes["GROUP-ID"]]=n[e.attributes["GROUP-ID"]]||{},t=n[e.attributes["GROUP-ID"]],(u={default:/yes/i.test(e.attributes.DEFAULT)}).autoselect=!!u.default||/yes/i.test(e.attributes.AUTOSELECT),e.attributes.LANGUAGE&&(u.language=e.attributes.LANGUAGE),e.attributes.URI&&(u.uri=e.attributes.URI),e.attributes["INSTREAM-ID"]&&(u.instreamId=e.attributes["INSTREAM-ID"]),e.attributes.CHARACTERISTICS&&(u.characteristics=e.attributes.CHARACTERISTICS),e.attributes.FORCED&&(u.forced=/yes/i.test(e.attributes.FORCED)),t[e.attributes.NAME]=u}else this.trigger("warn",{message:"ignoring incomplete or missing media group"})},discontinuity:function(){c+=1,o.discontinuity=!0,this.manifest.discontinuityStarts.push(a.length)},"program-date-time":function(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=e.dateTimeString,this.manifest.dateTimeObject=e.dateTimeObject),o.dateTimeString=e.dateTimeString,o.dateTimeObject=e.dateTimeObject},targetduration:function(){!isFinite(e.duration)||e.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+e.duration}):this.manifest.targetDuration=e.duration},totalduration:function(){!isFinite(e.duration)||e.duration<0?this.trigger("warn",{message:"ignoring invalid total duration: "+e.duration}):this.manifest.totalDuration=e.duration},start:function(){e.attributes&&!isNaN(e.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:e.attributes["TIME-OFFSET"],precise:e.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out":function(){o.cueOut=e.data},"cue-out-cont":function(){o.cueOutCont=e.data},"cue-in":function(){o.cueIn=e.data}}[e.tagType]||d).call(r)},uri:function(){o.uri=e.uri,a.push(o),!this.manifest.targetDuration||"duration"in o||(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),o.duration=this.manifest.targetDuration),i&&(o.key=i),o.timeline=c,n&&(o.map=n),o={}},comment:function(){},custom:function(){e.segment?(o.custom=o.custom||{},o.custom[e.customType]=e.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[e.customType]=e.data)}})[e.type].call(r)})),t}a(t,e);var n=t.prototype;return n.push=function(e){this.lineStream.push(e)},n.end=function(){this.lineStream.push("\n")},n.addParser=function(e){this.parseStream.addParser(e)},n.addTagMapper=function(e){this.parseStream.addTagMapper(e)},t}(o)},"3Lai":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SegmentsMemoryStorage=function(){function e(e){this.settings=e,this.cache=new Map}return e.prototype.storeSegment=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return this.cache.set(e.id,{segment:e,lastAccessed:performance.now()}),[2]}))}))},e.prototype.getSegmentsMap=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this.cache]}))}))},e.prototype.getSegment=function(e,t){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){return void 0!==(t=this.cache.get(e))?[2,(t.lastAccessed=performance.now(),t.segment)]:[2]}))}))},e.prototype.hasSegment=function(e,t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.cache.has(e)]}))}))},e.prototype.clean=function(e,t){return __awaiter(this,void 0,void 0,(function(){var e,n,i,r,s,a,o,u,d,g=this;return __generator(this,(function(l){for(e=[],n=[],i=performance.now(),r=0,s=this.cache.values();r<s.length;r++)d=s[r],i-d.lastAccessed>this.settings.cachedSegmentExpiration?e.push(d.segment.id):n.push(d);if((a=n.length-this.settings.cachedSegmentsCount)>0)for(n.sort((function(e,t){return e.lastAccessed-t.lastAccessed})),o=0,u=n;o<u.length&&(d=u[o],void 0!==t&&t(d.segment.id)||(e.push(d.segment.id),0!=--a));o++);return[2,(e.forEach((function(e){return g.cache.delete(e)})),e.length>0)]}))}))},e.prototype.destroy=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return this.cache.clear(),[2]}))}))},e}()},"A+nu":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("+qE3");t.STEEmitter=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.on=function(t,n){return e.prototype.on.call(this,t,n)},t.prototype.emit=function(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];return e.prototype.emit.apply(this,[t].concat(n))},t}(i.EventEmitter)},O885:function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),(i=t.Events||(t.Events={})).SegmentLoaded="segment_loaded",i.SegmentError="segment_error",i.SegmentAbort="segment_abort",i.PeerConnect="peer_connect",i.PeerClose="peer_close",i.PieceBytesDownloaded="piece_bytes_downloaded",i.PieceBytesUploaded="piece_bytes_uploaded"},OKKN:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("+qE3"),r=n("uOj1"),s=n("iXDm"),a=n("yLkh"),o=n("b7KT");t.Engine=function(e){function t(t){void 0===t&&(t={});var n=this;return(n=e.call(this)||this).loader=new r.HybridLoader(t.loader),n.segmentManager=new s.SegmentManager(n.loader,t.segments),Object.keys(r.Events).map((function(e){return r.Events[e]})).forEach((function(e){return n.loader.on(e,(function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return n.emit.apply(n,[e].concat(t))}))})),n}return __extends(t,e),t.isSupported=function(){return r.HybridLoader.isSupported()},t.prototype.createLoaderClass=function(){return o.createHlsJsLoaderClass(a.HlsJsLoader,this)},t.prototype.destroy=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.segmentManager.destroy()];case 1:return e.sent(),[2]}}))}))},t.prototype.getSettings=function(){return{segments:this.segmentManager.getSettings(),loader:this.loader.getSettings()}},t.prototype.getDetails=function(){return{loader:this.loader.getDetails()}},t.prototype.setPlayingSegment=function(e,t,n,i){this.segmentManager.setPlayingSegment(e,t,n,i)},t.prototype.setPlayingSegmentByCurrentTime=function(e){this.segmentManager.setPlayingSegmentByCurrentTime(e)},t}(i.EventEmitter)},R6j9:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r,s=n("NOtv"),a=n("A+nu"),o=n("tjlA");!function(e){e[e.SegmentData=0]="SegmentData",e[e.SegmentAbsent=1]="SegmentAbsent",e[e.SegmentsMap=2]="SegmentsMap",e[e.SegmentRequest=3]="SegmentRequest",e[e.CancelSegmentRequest=4]="CancelSegmentRequest"}(i||(i={})),function(e){e[e.Loaded=0]="Loaded",e[e.LoadingByHttp=1]="LoadingByHttp"}(r=t.MediaPeerSegmentStatus||(t.MediaPeerSegmentStatus={}));var u=function(e,t){this.id=e,this.size=t,this.bytesDownloaded=0,this.pieces=[]};t.MediaPeer=function(e){function t(t,n){var r=this;return(r=e.call(this)||this).peer=t,r.settings=n,r.remoteAddress="",r.downloadingSegmentId=null,r.downloadingSegment=null,r.segmentsMap=new Map,r.debug=s("p2pml:media-peer"),r.timer=null,r.onPeerConnect=function(){r.debug("peer connect",r.id,r),r.remoteAddress=r.peer.remoteAddress,r.emit("connect",r)},r.onPeerClose=function(){r.debug("peer close",r.id,r),r.terminateSegmentRequest(),r.emit("close",r)},r.onPeerError=function(e){r.debug("peer error",r.id,e,r)},r.onPeerData=function(e){var t=r.getJsonCommand(e);if(null!=t){if(r.downloadingSegment){r.debug("peer segment download is interrupted by a command",r.id,r);var n=r.downloadingSegment.id;return r.terminateSegmentRequest(),void r.emit("segment-error",r,n,"Segment download is interrupted by a command")}switch(r.debug("peer receive command",r.id,t,r),t.c){case i.SegmentsMap:r.segmentsMap=r.createSegmentsMap(t.m),r.emit("data-updated");break;case i.SegmentRequest:r.emit("segment-request",r,t.i);break;case i.SegmentData:r.downloadingSegmentId===t.i&&(r.downloadingSegment=new u(t.i,t.s),r.cancelResponseTimeoutTimer());break;case i.SegmentAbsent:r.downloadingSegmentId===t.i&&(r.terminateSegmentRequest(),r.segmentsMap.delete(t.i),r.emit("segment-absent",r,t.i))}}else r.receiveSegmentPiece(e)},r.peer.on("connect",r.onPeerConnect),r.peer.on("close",r.onPeerClose),r.peer.on("error",r.onPeerError),r.peer.on("data",r.onPeerData),r.id=t.id,r}return __extends(t,e),t.prototype.receiveSegmentPiece=function(e){if(this.downloadingSegment){this.downloadingSegment.bytesDownloaded+=e.byteLength,this.downloadingSegment.pieces.push(e),this.emit("bytes-downloaded",this,e.byteLength);var t=this.downloadingSegment.id;if(this.downloadingSegment.bytesDownloaded==this.downloadingSegment.size){for(var n=new Uint8Array(this.downloadingSegment.size),i=0,r=0,s=this.downloadingSegment.pieces;r<s.length;r++){var a=s[r];n.set(new Uint8Array(a),i),i+=a.byteLength}this.debug("peer segment download done",this.id,t,this),this.terminateSegmentRequest(),this.emit("segment-loaded",this,t,n.buffer)}else this.downloadingSegment.bytesDownloaded>this.downloadingSegment.size&&(this.debug("peer segment download bytes mismatch",this.id,t,this),this.terminateSegmentRequest(),this.emit("segment-error",this,t,"Too many bytes received for segment"))}else this.debug("peer segment not requested",this.id,this)},t.prototype.getJsonCommand=function(e){var t=new Uint8Array(e);if(123==t[0]&&34==t[1]&&125==t[e.byteLength-1])try{return JSON.parse((new TextDecoder).decode(e))}catch(n){}return null},t.prototype.createSegmentsMap=function(e){if(null==e||!(e instanceof Object))return new Map;for(var t=new Map,n=0,i=Object.keys(e);n<i.length;n++){var s=i[n],a=e[s];if(!(a instanceof Array&&2===a.length&&"string"==typeof a[0]&&a[1]instanceof Array))return new Map;var o=a[0].split("|"),u=a[1];if(o.length!==u.length)return new Map;for(var d=0;d<o.length;d++){var g=u[d];if("number"!=typeof g||void 0===r[g])return new Map;t.set(s+"+"+o[d],g)}}return t},t.prototype.sendCommand=function(e){this.debug("peer send command",this.id,e,this),this.peer.write(JSON.stringify(e))},t.prototype.destroy=function(){this.debug("peer destroy",this.id,this),this.terminateSegmentRequest(),this.peer.destroy()},t.prototype.getDownloadingSegmentId=function(){return this.downloadingSegmentId},t.prototype.getSegmentsMap=function(){return this.segmentsMap},t.prototype.sendSegmentsMap=function(e){this.sendCommand({c:i.SegmentsMap,m:e})},t.prototype.sendSegmentData=function(e,t){this.sendCommand({c:i.SegmentData,i:e,s:t.byteLength});for(var n=t.byteLength;n>0;){var r=n>=this.settings.webRtcMaxMessageSize?this.settings.webRtcMaxMessageSize:n,s=o.Buffer.from(t,t.byteLength-n,r);this.peer.write(s),n-=r}this.emit("bytes-uploaded",this,t.byteLength)},t.prototype.sendSegmentAbsent=function(e){this.sendCommand({c:i.SegmentAbsent,i:e})},t.prototype.requestSegment=function(e){if(this.downloadingSegmentId)throw new Error("A segment is already downloading: "+this.downloadingSegmentId);this.sendCommand({c:i.SegmentRequest,i:e}),this.downloadingSegmentId=e,this.runResponseTimeoutTimer()},t.prototype.cancelSegmentRequest=function(){var e;if(this.downloadingSegmentId){var t=this.downloadingSegmentId;e=this.downloadingSegment?this.downloadingSegment.pieces:void 0,this.terminateSegmentRequest(),this.sendCommand({c:i.CancelSegmentRequest,i:t})}return e},t.prototype.runResponseTimeoutTimer=function(){var e=this;this.timer=setTimeout((function(){if(e.timer=null,e.downloadingSegmentId){var t=e.downloadingSegmentId;e.cancelSegmentRequest(),e.emit("segment-timeout",e,t)}}),this.settings.p2pSegmentDownloadTimeout)},t.prototype.cancelResponseTimeoutTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},t.prototype.terminateSegmentRequest=function(){this.downloadingSegmentId=null,this.downloadingSegment=null,this.cancelResponseTimeoutTimer()},t}(a.STEEmitter)},b7KT:function(e,t){e.exports.createHlsJsLoaderClass=function(e,t){function n(){this.impl=new e(t.segmentManager),this.stats=this.impl.stats}return n.prototype.load=function(e,t,n){this.context=e,this.impl.load(e,t,n)},n.prototype.abort=function(){this.impl.abort(this.context)},n.prototype.destroy=function(){this.context&&this.impl.abort(this.context)},n.getEngine=function(){return t},n}},fnjI:function(e,t,n){var i=n("P7XM"),r=n("tnIz"),s=n("hwdV").Buffer,a=[1518500249,1859775393,-1894007588,-899497514],o=new Array(80);function u(){this.init(),this._w=o,r.call(this,64,56)}function d(e){return e<<5|e>>>27}function g(e){return e<<30|e>>>2}function l(e,t,n,i){return 0===e?t&n|~t&i:2===e?t&n|t&i|n&i:t^n^i}i(u,r),u.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},u.prototype._update=function(e){for(var t,n=this._w,i=0|this._a,r=0|this._b,s=0|this._c,o=0|this._d,u=0|this._e,h=0;h<16;++h)n[h]=e.readInt32BE(4*h);for(;h<80;++h)n[h]=(t=n[h-3]^n[h-8]^n[h-14]^n[h-16])<<1|t>>>31;for(var c=0;c<80;++c){var m=~~(c/20),p=d(i)+l(m,r,s,o)+u+n[c]+a[m]|0;u=o,o=s,s=g(r),r=i,i=p}this._a=i+this._a|0,this._b=r+this._b|0,this._c=s+this._c|0,this._d=o+this._d|0,this._e=u+this._e|0},u.prototype._hash=function(){var e=s.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=u},iXDm:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("uOj1"),r=n("10ky"),s={forwardSegmentCount:20,swarmId:void 0,assetsStorage:void 0};t.SegmentManager=function(){function e(e,t){var n=this;void 0===t&&(t={}),this.masterPlaylist=null,this.variantPlaylists=new Map,this.segmentRequest=null,this.playQueue=[],this.onSegmentLoaded=function(e){n.segmentRequest&&n.segmentRequest.segmentUrl===e.url&&d(n.segmentRequest.segmentByterange)===e.range&&(n.segmentRequest.onSuccess(e.data.slice(0),e.downloadBandwidth),n.segmentRequest=null)},this.onSegmentError=function(e,t){n.segmentRequest&&n.segmentRequest.segmentUrl===e.url&&d(n.segmentRequest.segmentByterange)===e.range&&(n.segmentRequest.onError(t),n.segmentRequest=null)},this.onSegmentAbort=function(e){n.segmentRequest&&n.segmentRequest.segmentUrl===e.url&&d(n.segmentRequest.segmentByterange)===e.range&&(n.segmentRequest.onError("Loading aborted: internal abort"),n.segmentRequest=null)},this.settings=Object.assign(Object.assign({},s),t),this.loader=e,this.loader.on(i.Events.SegmentLoaded,this.onSegmentLoaded),this.loader.on(i.Events.SegmentError,this.onSegmentError),this.loader.on(i.Events.SegmentAbort,this.onSegmentAbort)}return e.prototype.getSettings=function(){return this.settings},e.prototype.processPlaylist=function(e,t,n){var i=new r.Parser;i.push(t),i.end();var s=new a(e,n,i.manifest);if(s.manifest.playlists){this.masterPlaylist=s;for(var o=0,u=this.variantPlaylists;o<u.length;o++){var d=u[o],g=d[0],l=d[1],h=this.getStreamSwarmId(l.requestUrl),c=h.streamSwarmId,m=h.found,p=h.index;m?(l.streamSwarmId=c,l.streamId="V"+p.toString()):this.variantPlaylists.delete(g)}}else{var f=this.getStreamSwarmId(e);c=f.streamSwarmId,m=f.found,p=f.index;(m||null===this.masterPlaylist)&&(s.streamSwarmId=c,s.streamId=null===this.masterPlaylist?void 0:"V"+p.toString(),this.variantPlaylists.set(e,s),this.updateSegments())}},e.prototype.loadPlaylist=function(e){return __awaiter(this,void 0,void 0,(function(){var t,n,i,r;return __generator(this,(function(s){switch(s.label){case 0:return void 0===(t=this.settings.assetsStorage)?[3,5]:(i=void 0,void 0===(i=this.getMasterSwarmId())&&(i=e.split("?")[0]),[4,t.getAsset(e,void 0,i)]);case 1:return void 0===(r=s.sent())?[3,2]:(n={responseURL:r.responseUri,response:r.data},[3,4]);case 2:return[4,this.loadContent(e,"text")];case 3:n=s.sent(),t.storeAsset({masterManifestUri:null!==this.masterPlaylist?this.masterPlaylist.requestUrl:e,masterSwarmId:i,requestUri:e,responseUri:n.responseURL,data:n.response}),s.label=4;case 4:return[3,7];case 5:return[4,this.loadContent(e,"text")];case 6:n=s.sent(),s.label=7;case 7:return[2,(this.processPlaylist(e,n.response,n.responseURL),n)]}}))}))},e.prototype.loadSegment=function(e,t){return __awaiter(this,void 0,void 0,(function(){var n,i,r,s,a,u,g,l,h,c,m=this;return __generator(this,(function(p){switch(p.label){case 0:return n=this.getSegmentLocation(e,t),i=d(t),n?[3,7]:(r=void 0,void 0===(s=this.settings.assetsStorage)?[3,4]:(a=void 0,u=null!==this.masterPlaylist?this.masterPlaylist.requestUrl:void 0,void 0===(a=this.getMasterSwarmId())&&1===this.variantPlaylists.size&&(a=this.variantPlaylists.values().next().value.requestUrl.split("?")[0]),void 0===u&&1===this.variantPlaylists.size&&(u=this.variantPlaylists.values().next().value.requestUrl),void 0===a||void 0===u?[3,4]:[4,s.getAsset(e,i,a)]));case 1:return void 0===(g=p.sent())?[3,2]:(r=g.data,[3,4]);case 2:return[4,this.loadContent(e,"arraybuffer",i)];case 3:l=p.sent(),s.storeAsset({masterManifestUri:u,masterSwarmId:a,requestUri:e,requestRange:i,responseUri:l.responseURL,data:r=l.response}),p.label=4;case 4:return void 0===r?[4,this.loadContent(e,"arraybuffer",i)]:[3,6];case 5:r=p.sent().response,p.label=6;case 6:return[2,{content:r,downloadBandwidth:0}];case 7:return h=(n.playlist.manifest.mediaSequence?n.playlist.manifest.mediaSequence:0)+n.segmentIndex,this.playQueue.length>0&&this.playQueue[this.playQueue.length-1].segmentSequence!==h-1&&(this.playQueue=[]),this.segmentRequest&&this.segmentRequest.onError("Cancel segment request: simultaneous segment requests are not supported"),c=new Promise((function(i,r){m.segmentRequest=new o(e,t,h,n.playlist.requestUrl,(function(e,t){return i({content:e,downloadBandwidth:t})}),(function(e){return r(e)}))})),[2,(this.playQueue.push({segmentUrl:e,segmentByterange:t,segmentSequence:h}),this.loadSegments(n.playlist,n.segmentIndex,!0),c)]}}))}))},e.prototype.setPlayingSegment=function(e,t,n,i){var r=this.playQueue.findIndex((function(n){return n.segmentUrl==e&&u(n.segmentByterange,t)}));r>=0&&(this.playQueue=this.playQueue.slice(r),this.playQueue[0].playPosition={start:n,duration:i},this.updateSegments())},e.prototype.setPlayingSegmentByCurrentTime=function(e){if(0!==this.playQueue.length&&this.playQueue[0].playPosition){var t=this.playQueue[0].playPosition;t.start+t.duration-e<.2&&(this.playQueue=this.playQueue.slice(1),this.updateSegments())}},e.prototype.abortSegment=function(e,t){this.segmentRequest&&this.segmentRequest.segmentUrl===e&&u(this.segmentRequest.segmentByterange,t)&&(this.segmentRequest.onSuccess(void 0,0),this.segmentRequest=null)},e.prototype.destroy=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this.segmentRequest&&(this.segmentRequest.onError("Loading aborted: object destroyed"),this.segmentRequest=null),this.masterPlaylist=null,this.variantPlaylists.clear(),this.playQueue=[],void 0!==this.settings.assetsStorage?[4,this.settings.assetsStorage.destroy()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[4,this.loader.destroy()];case 3:return e.sent(),[2]}}))}))},e.prototype.updateSegments=function(){if(this.segmentRequest){var e=this.getSegmentLocation(this.segmentRequest.segmentUrl,this.segmentRequest.segmentByterange);e&&this.loadSegments(e.playlist,e.segmentIndex,!1)}},e.prototype.getSegmentLocation=function(e,t){for(var n=0,i=this.variantPlaylists.values();n<i.length;n++){var r=i[n],s=r.getSegmentIndex(e,t);if(s>=0)return{playlist:r,segmentIndex:s}}},e.prototype.loadSegments=function(e,t,n){return __awaiter(this,void 0,void 0,(function(){var i,r,s,a,o,u,g,l,h,c,m;return __generator(this,(function(p){switch(p.label){case 0:for(i=[],r=e.manifest.segments,s=e.manifest.mediaSequence?e.manifest.mediaSequence:0,a=null,o=Math.max(0,this.playQueue.length-1),u=this.getMasterSwarmId(),g=t;g<r.length&&i.length<this.settings.forwardSegmentCount;++g)m=e.manifest.segments[g],l=e.getSegmentAbsoluteUrl(m.uri),h=m.byterange,c=this.getSegmentId(e,s+g),i.push({id:c,url:l,masterSwarmId:void 0!==u?u:e.streamSwarmId,masterManifestUri:null!==this.masterPlaylist?this.masterPlaylist.requestUrl:e.requestUrl,streamId:e.streamId,sequence:(s+g).toString(),range:d(h),priority:o++}),n&&!a&&(a=c);return this.loader.load(i,e.streamSwarmId),a?[4,this.loader.getSegment(a)]:[3,2];case 1:(m=p.sent())&&this.onSegmentLoaded(m),p.label=2;case 2:return[2]}}))}))},e.prototype.getSegmentId=function(e,t){return e.streamSwarmId+"+"+t},e.prototype.getMasterSwarmId=function(){var e=this.settings.swarmId&&0!==this.settings.swarmId.length?this.settings.swarmId:void 0;return void 0!==e?e:null!==this.masterPlaylist?this.masterPlaylist.requestUrl.split("?")[0]:void 0},e.prototype.getStreamSwarmId=function(e){var t=this.getMasterSwarmId();if(null!==this.masterPlaylist)for(var n=0;n<this.masterPlaylist.manifest.playlists.length;++n)if(new URL(this.masterPlaylist.manifest.playlists[n].uri,this.masterPlaylist.responseUrl).toString()===e)return{streamSwarmId:t+"+V"+n,found:!0,index:n};return{streamSwarmId:void 0!==t?t:e.split("?")[0],found:!1,index:-1}},e.prototype.loadContent=function(e,t,n){return __awaiter(this,void 0,void 0,(function(){var i=this;return __generator(this,(function(r){return[2,new Promise((function(r,s){var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType=t,n&&a.setRequestHeader("Range",n),a.addEventListener("readystatechange",(function(){4===a.readyState&&(a.status>=200&&a.status<300?r(a):s(a.statusText))}));var o=i.loader.getSettings().xhrSetup;o&&o(a,e),a.send()}))]}))}))},e}();var a=function(){function e(e,t,n){this.requestUrl=e,this.responseUrl=t,this.manifest=n,this.streamSwarmId=""}return e.prototype.getSegmentIndex=function(e,t){for(var n=0;n<this.manifest.segments.length;++n){var i=this.manifest.segments[n];if(e===this.getSegmentAbsoluteUrl(i.uri)&&u(i.byterange,t))return n}return-1},e.prototype.getSegmentAbsoluteUrl=function(e){return new URL(e,this.responseUrl).toString()},e}(),o=function(e,t,n,i,r,s){this.segmentUrl=e,this.segmentByterange=t,this.segmentSequence=n,this.playlistRequestUrl=i,this.onSuccess=r,this.onError=s};function u(e,t){return void 0===e?void 0===t:void 0!==t&&e.length===t.length&&e.offset===t.offset}function d(e){if(void 0!==e)return"bytes="+e.offset+"-"+(e.offset+e.length-1)}},lcUr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("NOtv"),r=n("O885"),s=n("+qE3"),a=n("0ovO"),o=n("n5Qj"),u=n("R6j9"),d=n("xzjP"),g=n("3Lai"),l=n("3oOE"),h={cachedSegmentExpiration:3e5,cachedSegmentsCount:30,useP2P:!0,consumeOnly:!1,requiredSegmentsPriority:1,simultaneousHttpDownloads:2,httpDownloadProbability:.1,httpDownloadProbabilityInterval:1e3,httpDownloadProbabilitySkipIfNoPeers:!1,httpFailedSegmentTimeout:1e4,httpDownloadMaxPriority:20,httpDownloadInitialTimeout:0,httpDownloadInitialTimeoutPerSegment:4e3,httpUseRanges:!1,simultaneousP2PDownloads:3,p2pDownloadMaxPriority:20,p2pSegmentDownloadTimeout:6e4,webRtcMaxMessageSize:65535,trackerAnnounce:["wss://tracker.novage.com.ua","wss://tracker.openwebtorrent.com"],peerRequestsPerAnnounce:10,rtcConfig:n("BRrH").config};t.HybridLoader=function(e){function t(t){void 0===t&&(t={});var n=this;return(n=e.call(this)||this).debug=i("p2pml:hybrid-loader"),n.debugSegments=i("p2pml:hybrid-loader-segments"),n.segmentsQueue=[],n.bandwidthApproximator=new d.BandwidthApproximator,n.httpDownloadInitialTimeoutTimestamp=-1/0,n.processInitialSegmentTimeout=function(){return __awaiter(n,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return void 0===this.httpRandomDownloadInterval?[3,3]:void 0===this.masterSwarmId?[3,2]:[4,this.segmentsStorage.getSegmentsMap(this.masterSwarmId)];case 1:e=t.sent(),this.processSegmentsQueue(e)&&!this.settings.consumeOnly&&this.p2pManager.sendSegmentsMapToAll(this.createSegmentsMap(e)),t.label=2;case 2:this.httpDownloadInitialTimeoutTimestamp!==-1/0&&setTimeout(this.processInitialSegmentTimeout,this.settings.httpDownloadInitialTimeoutPerSegment),t.label=3;case 3:return[2]}}))}))},n.downloadRandomSegmentOverHttp=function(){return __awaiter(n,void 0,void 0,(function(){var e,t,n,i,r=this;return __generator(this,(function(s){switch(s.label){case 0:return void 0===this.masterSwarmId||void 0===this.httpRandomDownloadInterval||this.httpDownloadInitialTimeoutTimestamp!==-1/0||this.httpManager.getActiveDownloadsCount()>=this.settings.simultaneousHttpDownloads||this.settings.httpDownloadProbabilitySkipIfNoPeers&&0===this.p2pManager.getPeers().size||this.settings.consumeOnly?[2]:[4,this.segmentsStorage.getSegmentsMap(this.masterSwarmId)];case 1:return e=s.sent(),t=this.p2pManager.getOvrallSegmentsMap(),0==(n=this.segmentsQueue.filter((function(n){return!r.p2pManager.isDownloading(n)&&!r.httpManager.isDownloading(n)&&!t.has(n.id)&&!r.httpManager.isFailed(n)&&n.priority<=r.settings.httpDownloadMaxPriority&&!e.has(n.id)}))).length?[2]:Math.random()>this.settings.httpDownloadProbability*n.length?[2]:(i=n[Math.floor(Math.random()*n.length)],this.debugSegments("HTTP download (random)",i.priority,i.url),this.httpManager.download(i),this.p2pManager.sendSegmentsMapToAll(this.createSegmentsMap(e)),[2])}}))}))},n.onPieceBytesDownloaded=function(e,t,i){n.bandwidthApproximator.addBytes(t,n.now()),n.emit(r.Events.PieceBytesDownloaded,e,t,i)},n.onPieceBytesUploaded=function(e,t,i){n.emit(r.Events.PieceBytesUploaded,e,t,i)},n.onSegmentLoaded=function(e,t,i){return __awaiter(n,void 0,void 0,(function(){var n,s;return __generator(this,(function(a){switch(a.label){case 0:return this.debugSegments("segment loaded",e.id,e.url),void 0===this.masterSwarmId?[2]:(e.data=t,e.downloadBandwidth=this.bandwidthApproximator.getBandwidth(this.now()),[4,this.segmentsStorage.storeSegment(e)]);case 1:return a.sent(),this.emit(r.Events.SegmentLoaded,e,i),void 0!==n?[3,3]:[4,this.segmentsStorage.getSegmentsMap(this.masterSwarmId)];case 2:return s=a.sent(),[3,4];case 3:s=n,a.label=4;case 4:return n=s,this.processSegmentsQueue(n),this.settings.consumeOnly||this.p2pManager.sendSegmentsMapToAll(this.createSegmentsMap(n)),[2]}}))}))},n.onSegmentError=function(e,t,i){return __awaiter(n,void 0,void 0,(function(){var n;return __generator(this,(function(s){switch(s.label){case 0:return this.debugSegments("segment error",e.id,e.url,i,t),this.emit(r.Events.SegmentError,e,t,i),void 0===this.masterSwarmId?[3,2]:[4,this.segmentsStorage.getSegmentsMap(this.masterSwarmId)];case 1:n=s.sent(),this.processSegmentsQueue(n)&&!this.settings.consumeOnly&&this.p2pManager.sendSegmentsMapToAll(this.createSegmentsMap(n)),s.label=2;case 2:return[2]}}))}))},n.onPeerConnect=function(e){return __awaiter(n,void 0,void 0,(function(){var t,n,i,s;return __generator(this,(function(a){switch(a.label){case 0:return this.emit(r.Events.PeerConnect,e),this.settings.consumeOnly||void 0===this.masterSwarmId?[3,2]:(n=(t=this.p2pManager).sendSegmentsMap,i=[e.id],s=this.createSegmentsMap,[4,this.segmentsStorage.getSegmentsMap(this.masterSwarmId)]);case 1:n.apply(t,i.concat([s.apply(this,[a.sent()])])),a.label=2;case 2:return[2]}}))}))},n.onPeerClose=function(e){n.emit(r.Events.PeerClose,e)},n.onTrackerUpdate=function(e){return __awaiter(n,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return this.httpDownloadInitialTimeoutTimestamp!==-1/0&&void 0!==e.incomplete&&e.incomplete<=1&&(this.debugSegments("cancel initial HTTP download timeout - no peers"),this.httpDownloadInitialTimeoutTimestamp=-1/0,void 0!==this.masterSwarmId)?[4,this.segmentsStorage.getSegmentsMap(this.masterSwarmId)]:[3,2];case 1:t=n.sent(),this.processSegmentsQueue(t)&&!this.settings.consumeOnly&&this.p2pManager.sendSegmentsMapToAll(this.createSegmentsMap(t)),n.label=2;case 2:return[2]}}))}))},n.settings=Object.assign(Object.assign({},h),t),t.bufferedSegmentsCount&&(void 0===t.p2pDownloadMaxPriority&&(n.settings.p2pDownloadMaxPriority=t.bufferedSegmentsCount),void 0===t.httpDownloadMaxPriority&&(n.settings.p2pDownloadMaxPriority=t.bufferedSegmentsCount),delete n.settings.bufferedSegmentsCount),n.segmentsStorage=void 0===n.settings.segmentsStorage?new g.SegmentsMemoryStorage(n.settings):n.settings.segmentsStorage,n.debug("loader settings",n.settings),n.httpManager=n.createHttpManager(),n.httpManager.on("segment-loaded",n.onSegmentLoaded),n.httpManager.on("segment-error",n.onSegmentError),n.httpManager.on("bytes-downloaded",(function(e){return n.onPieceBytesDownloaded("http",e)})),n.p2pManager=n.createP2PManager(),n.p2pManager.on("segment-loaded",n.onSegmentLoaded),n.p2pManager.on("segment-error",n.onSegmentError),n.p2pManager.on("peer-data-updated",(function(){return __awaiter(n,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return void 0===this.masterSwarmId?[2]:[4,this.segmentsStorage.getSegmentsMap(this.masterSwarmId)];case 1:return e=t.sent(),this.processSegmentsQueue(e)&&!this.settings.consumeOnly&&this.p2pManager.sendSegmentsMapToAll(this.createSegmentsMap(e)),[2]}}))}))})),n.p2pManager.on("bytes-downloaded",(function(e,t){return n.onPieceBytesDownloaded("p2p",e,t)})),n.p2pManager.on("bytes-uploaded",(function(e,t){return n.onPieceBytesUploaded("p2p",e,t)})),n.p2pManager.on("peer-connected",n.onPeerConnect),n.p2pManager.on("peer-closed",n.onPeerClose),n.p2pManager.on("tracker-update",n.onTrackerUpdate),n}return __extends(t,e),t.isSupported=function(){var e=l();return e&&void 0!==e.RTCPeerConnection.prototype.createDataChannel},t.prototype.createHttpManager=function(){return new a.HttpMediaManager(this.settings)},t.prototype.createP2PManager=function(){return new o.P2PMediaManager(this.segmentsStorage,this.settings)},t.prototype.load=function(e,t){return __awaiter(this,void 0,void 0,(function(){var n,i,s,a,o,u,d,g,l,h,c;return __generator(this,(function(m){switch(m.label){case 0:for(void 0===this.httpRandomDownloadInterval&&(this.httpRandomDownloadInterval=setInterval(this.downloadRandomSegmentOverHttp,this.settings.httpDownloadProbabilityInterval),this.settings.httpDownloadInitialTimeout>0&&this.settings.httpDownloadInitialTimeoutPerSegment>0&&(this.debugSegments("enable initial HTTP download timeout",this.settings.httpDownloadInitialTimeout,"per segment",this.settings.httpDownloadInitialTimeoutPerSegment),this.httpDownloadInitialTimeoutTimestamp=this.now(),setTimeout(this.processInitialSegmentTimeout,this.settings.httpDownloadInitialTimeoutPerSegment+100))),e.length>0&&(this.masterSwarmId=e[0].masterSwarmId),void 0!==this.masterSwarmId&&this.p2pManager.setStreamSwarmId(t,this.masterSwarmId),this.debug("load segments"),n=!1,i=function(t){e.find((function(e){return e.url==t.url}))||(s.debug("remove segment",t.url),s.httpManager.isDownloading(t)?(n=!0,s.httpManager.abort(t)):s.p2pManager.abort(t),s.emit(r.Events.SegmentAbort,t))},s=this,a=0,o=this.segmentsQueue;a<o.length;a++)h=o[a],i(h);if(this.debug.enabled)for(u=function(e){d.segmentsQueue.find((function(t){return t.url==e.url}))||d.debug("add segment",e.url)},d=this,g=0,l=e;g<l.length;g++)h=l[g],u(h);return this.segmentsQueue=e,void 0===this.masterSwarmId?[2]:[4,this.segmentsStorage.getSegmentsMap(this.masterSwarmId)];case 1:return c=m.sent(),n=this.processSegmentsQueue(c)||n,[4,this.cleanSegmentsStorage()];case 2:return m.sent()?[4,this.segmentsStorage.getSegmentsMap(this.masterSwarmId)]:[3,4];case 3:c=m.sent(),n=!0,m.label=4;case 4:return n&&!this.settings.consumeOnly&&this.p2pManager.sendSegmentsMapToAll(this.createSegmentsMap(c)),[2]}}))}))},t.prototype.getSegment=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,void 0===this.masterSwarmId?void 0:this.segmentsStorage.getSegment(e,this.masterSwarmId)]}))}))},t.prototype.getSettings=function(){return this.settings},t.prototype.getDetails=function(){return{peerId:this.p2pManager.getPeerId()}},t.prototype.destroy=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return void 0!==this.httpRandomDownloadInterval&&(clearInterval(this.httpRandomDownloadInterval),this.httpRandomDownloadInterval=void 0),this.httpDownloadInitialTimeoutTimestamp=-1/0,this.segmentsQueue=[],this.httpManager.destroy(),this.p2pManager.destroy(),this.masterSwarmId=void 0,[4,this.segmentsStorage.destroy()];case 1:return e.sent(),[2]}}))}))},t.prototype.processSegmentsQueue=function(e){if(this.debugSegments("process segments queue. priority",this.segmentsQueue.length>0?this.segmentsQueue[0].priority:0),void 0===this.masterSwarmId||0===this.segmentsQueue.length)return!1;var t,n=!1,i=!0;if(this.httpDownloadInitialTimeoutTimestamp!==-1/0){for(var r=void 0,s=0,a=this.segmentsQueue;s<a.length;s++){var o=a[s];if(!e.has(o.id)){r=o.priority;break}}var d=this.now()-this.httpDownloadInitialTimeoutTimestamp;(i=d>=this.settings.httpDownloadInitialTimeout||void 0!==r&&d>this.settings.httpDownloadInitialTimeoutPerSegment&&r<=0)&&(this.debugSegments("cancel initial HTTP download timeout - timed out"),this.httpDownloadInitialTimeoutTimestamp=-1/0)}for(var g=0;g<this.segmentsQueue.length;g++){o=this.segmentsQueue[g];if(!e.has(o.id)&&!this.httpManager.isDownloading(o)){if(o.priority<=this.settings.requiredSegmentsPriority&&i&&!this.httpManager.isFailed(o)){if(this.httpManager.getActiveDownloadsCount()>=this.settings.simultaneousHttpDownloads)for(var l=this.segmentsQueue.length-1;l>g;l--){var h=this.segmentsQueue[l];if(this.httpManager.isDownloading(h)){this.debugSegments("cancel HTTP download",h.priority,h.url),this.httpManager.abort(h);break}}if(this.httpManager.getActiveDownloadsCount()<this.settings.simultaneousHttpDownloads){var c=this.p2pManager.abort(o);this.httpManager.download(o,c),this.debugSegments("HTTP download (priority)",o.priority,o.url),n=!0;continue}}if(!this.p2pManager.isDownloading(o))if(o.priority<=this.settings.requiredSegmentsPriority){if((t=t||this.p2pManager.getOvrallSegmentsMap()).get(o.id)!==u.MediaPeerSegmentStatus.Loaded)continue;if(this.p2pManager.getActiveDownloadsCount()>=this.settings.simultaneousP2PDownloads)for(l=this.segmentsQueue.length-1;l>g;l--){h=this.segmentsQueue[l];if(this.p2pManager.isDownloading(h)){this.debugSegments("cancel P2P download",h.priority,h.url),this.p2pManager.abort(h);break}}if(this.p2pManager.getActiveDownloadsCount()<this.settings.simultaneousP2PDownloads&&this.p2pManager.download(o)){this.debugSegments("P2P download (priority)",o.priority,o.url);continue}}else this.p2pManager.getActiveDownloadsCount()<this.settings.simultaneousP2PDownloads&&o.priority<=this.settings.p2pDownloadMaxPriority&&this.p2pManager.download(o)&&this.debugSegments("P2P download",o.priority,o.url)}}return n},t.prototype.getStreamSwarmId=function(e){return void 0===e.streamId?e.masterSwarmId:e.masterSwarmId+"+"+e.streamId},t.prototype.createSegmentsMap=function(e){for(var t=this,n={},i=function(e,i){var r=t.getStreamSwarmId(e),s=e.sequence,a=n[r];void 0===a&&(n[r]=a=["",[]]);var o=a[1];a[0]+=0==o.length?s:"|"+s,o.push(i)},r=0,s=e.values();r<s.length;r++){i(s[r].segment,u.MediaPeerSegmentStatus.Loaded)}for(var a=0,o=this.httpManager.getActiveDownloads().values();a<o.length;a++){i(o[a].segment,u.MediaPeerSegmentStatus.LoadingByHttp)}return n},t.prototype.cleanSegmentsStorage=function(){return __awaiter(this,void 0,void 0,(function(){var e=this;return __generator(this,(function(t){return[2,void 0!==this.masterSwarmId&&this.segmentsStorage.clean(this.masterSwarmId,(function(t){return void 0!==e.segmentsQueue.find((function(e){return e.id===t}))}))]}))}))},t.prototype.now=function(){return performance.now()},t}(s.EventEmitter)},n5Qj:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("NOtv"),r=n("J6t0"),s=n("A+nu"),a=n("R6j9"),o=n("tjlA"),u=n("fnjI"),d="-WW"+n("uOj1").version.replace(/\d*./g,(function(e){return("0"+parseInt(e,10)%100).slice(-2)})).slice(0,4)+"-",g=function(e,t){this.peerId=e,this.segment=t};t.P2PMediaManager=function(e){function t(t,n){var r=this;return(r=e.call(this)||this).sementsStorage=t,r.settings=n,r.trackerClient=null,r.peers=new Map,r.peerCandidates=new Map,r.peerSegmentRequests=new Map,r.streamSwarmId=null,r.debug=i("p2pml:p2p-media-manager"),r.pendingTrackerClient=null,r.onTrackerError=function(e){r.debug("tracker error",e)},r.onTrackerWarning=function(e){r.debug("tracker warning",e)},r.onTrackerUpdate=function(e){r.debug("tracker update",e),r.emit("tracker-update",e)},r.onTrackerPeer=function(e){if(r.debug("tracker peer",e.id,e),r.peers.has(e.id))return r.debug("tracker peer already connected",e.id,e),void e.destroy();var t=new a.MediaPeer(e,r.settings);t.on("connect",r.onPeerConnect),t.on("close",r.onPeerClose),t.on("data-updated",r.onPeerDataUpdated),t.on("segment-request",r.onSegmentRequest),t.on("segment-loaded",r.onSegmentLoaded),t.on("segment-absent",r.onSegmentAbsent),t.on("segment-error",r.onSegmentError),t.on("segment-timeout",r.onSegmentTimeout),t.on("bytes-downloaded",r.onPieceBytesDownloaded),t.on("bytes-uploaded",r.onPieceBytesUploaded);var n=r.peerCandidates.get(t.id);n||r.peerCandidates.set(t.id,n=[]),n.push(t)},r.onPieceBytesDownloaded=function(e,t){r.emit("bytes-downloaded",t,e.id)},r.onPieceBytesUploaded=function(e,t){r.emit("bytes-uploaded",t,e.id)},r.onPeerConnect=function(e){if(r.peers.get(e.id))return r.debug("tracker peer already connected (in peer connect)",e.id,e),void e.destroy();r.peers.set(e.id,e);var t=r.peerCandidates.get(e.id);if(t){for(var n=0,i=t;n<i.length;n++){var s=i[n];s!=e&&s.destroy()}r.peerCandidates.delete(e.id)}r.emit("peer-connected",{id:e.id,remoteAddress:e.remoteAddress})},r.onPeerClose=function(e){if(r.peers.get(e.id)!=e){var t=r.peerCandidates.get(e.id);if(!t)return;var n=t.indexOf(e);return-1!=n&&t.splice(n,1),void(0==t.length&&r.peerCandidates.delete(e.id))}for(var i=0,s=r.peerSegmentRequests;i<s.length;i++){var a=s[i],o=a[0];a[1].peerId==e.id&&r.peerSegmentRequests.delete(o)}r.peers.delete(e.id),r.emit("peer-data-updated"),r.emit("peer-closed",e.id)},r.onPeerDataUpdated=function(){r.emit("peer-data-updated")},r.onSegmentRequest=function(e,t){return __awaiter(r,void 0,void 0,(function(){var n;return __generator(this,(function(i){switch(i.label){case 0:return void 0===this.masterSwarmId?[2]:[4,this.sementsStorage.getSegment(t,this.masterSwarmId)];case 1:return(n=i.sent())?e.sendSegmentData(t,n.data):e.sendSegmentAbsent(t),[2]}}))}))},r.onSegmentLoaded=function(e,t,n){return __awaiter(r,void 0,void 0,(function(){var i,r,s;return __generator(this,(function(a){switch(a.label){case 0:if(!(i=this.peerSegmentRequests.get(t)))return[2];if(r=i.segment,!this.settings.segmentValidator)return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.settings.segmentValidator(Object.assign(Object.assign({},r),{data:n}),"p2p",e.id)];case 2:return a.sent(),[3,4];case 3:return s=a.sent(),[2,(this.debug("segment validator failed",s),this.peerSegmentRequests.delete(t),this.emit("segment-error",r,s,e.id),void this.onPeerClose(e))];case 4:return this.peerSegmentRequests.delete(t),this.emit("segment-loaded",r,n,e.id),[2]}}))}))},r.onSegmentAbsent=function(e,t){r.peerSegmentRequests.delete(t),r.emit("peer-data-updated")},r.onSegmentError=function(e,t,n){var i=r.peerSegmentRequests.get(t);i&&(r.peerSegmentRequests.delete(t),r.emit("segment-error",i.segment,n,e.id))},r.onSegmentTimeout=function(e,t){var n=r.peerSegmentRequests.get(t);n&&(r.peerSegmentRequests.delete(t),e.destroy(),r.peers.delete(n.peerId)&&r.emit("peer-data-updated"))},r.peerId=n.useP2P?function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=d,n=0;n<20-d.length;n++)t+=e.charAt(Math.floor(Math.random()*e.length));return(new TextEncoder).encode(t).buffer}():new ArrayBuffer(0),r.debug.enabled&&r.debug("peer ID",r.getPeerId(),(new TextDecoder).decode(r.peerId)),r}return __extends(t,e),t.prototype.getPeers=function(){return this.peers},t.prototype.getPeerId=function(){return o.Buffer.from(this.peerId).toString("hex")},t.prototype.setStreamSwarmId=function(e,t){return __awaiter(this,void 0,void 0,(function(){var n,i;return __generator(this,(function(r){return this.streamSwarmId===e?[2]:(this.destroy(!0),this.streamSwarmId=e,this.masterSwarmId=t,this.debug("stream swarm ID",this.streamSwarmId),this.pendingTrackerClient={isDestroyed:!1},n=this.pendingTrackerClient,i=(new u).update(2+this.streamSwarmId).digest(),n.isDestroyed?null!=this.trackerClient&&(this.trackerClient.destroy(),this.trackerClient=null):(this.pendingTrackerClient=null,this.createClient(i)),[2])}))}))},t.prototype.createClient=function(e){var t=this;if(this.settings.useP2P){var n={infoHash:o.Buffer.from(e,0,20),peerId:o.Buffer.from(this.peerId,0,20),announce:this.settings.trackerAnnounce,rtcConfig:this.settings.rtcConfig,port:6881,getAnnounceOpts:function(){return{numwant:t.settings.peerRequestsPerAnnounce}}},i=this.trackerClient;this.trackerClient=new r(n),this.trackerClient.on("error",this.onTrackerError),this.trackerClient.on("warning",this.onTrackerWarning),this.trackerClient.on("update",this.onTrackerUpdate),this.trackerClient.on("peer",this.onTrackerPeer),this.trackerClient.start(),null!=i&&(i.destroy(),i=null)}},t.prototype.download=function(e){if(this.isDownloading(e))return!1;for(var t=[],n=0,i=this.peers.values();n<i.length;n++){var r=i[n];null==r.getDownloadingSegmentId()&&r.getSegmentsMap().get(e.id)===a.MediaPeerSegmentStatus.Loaded&&t.push(r)}if(0===t.length)return!1;var s=t[Math.floor(Math.random()*t.length)];return s.requestSegment(e.id),this.peerSegmentRequests.set(e.id,new g(s.id,e)),!0},t.prototype.abort=function(e){var t,n=this.peerSegmentRequests.get(e.id);if(n){var i=this.peers.get(n.peerId);i&&(t=i.cancelSegmentRequest()),this.peerSegmentRequests.delete(e.id)}return t},t.prototype.isDownloading=function(e){return this.peerSegmentRequests.has(e.id)},t.prototype.getActiveDownloadsCount=function(){return this.peerSegmentRequests.size},t.prototype.destroy=function(e){void 0===e&&(e=!1),this.streamSwarmId=null,this.trackerClient&&(this.trackerClient.stop(),e?(this.trackerClient.removeAllListeners("error"),this.trackerClient.removeAllListeners("warning"),this.trackerClient.removeAllListeners("update"),this.trackerClient.removeAllListeners("peer")):(this.trackerClient.destroy(),this.trackerClient=null)),this.pendingTrackerClient&&(this.pendingTrackerClient.isDestroyed=!0,this.pendingTrackerClient=null),this.peers.forEach((function(e){return e.destroy()})),this.peers.clear(),this.peerSegmentRequests.clear();for(var t=0,n=this.peerCandidates.values();t<n.length;t++)for(var i=0,r=n[t];i<r.length;i++){r[i].destroy()}this.peerCandidates.clear()},t.prototype.sendSegmentsMapToAll=function(e){this.peers.forEach((function(t){return t.sendSegmentsMap(e)}))},t.prototype.sendSegmentsMap=function(e,t){var n=this.peers.get(e);n&&n.sendSegmentsMap(t)},t.prototype.getOvrallSegmentsMap=function(){for(var e=new Map,t=0,n=this.peers.values();t<n.length;t++)for(var i=0,r=n[t].getSegmentsMap();i<r.length;i++){var s=r[i],o=s[0];s[1]===a.MediaPeerSegmentStatus.Loaded?e.set(o,a.MediaPeerSegmentStatus.Loaded):e.get(o)||e.set(o,a.MediaPeerSegmentStatus.LoadingByHttp)}return e},t}(s.STEEmitter)},tlK4:function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}function r(e){e&&e.config&&e.config.loader&&"function"==typeof e.config.loader.getEngine&&s(e,e.config.loader.getEngine())}function s(e,t){var n=this;e.on("hlsFragChanged",(function(e,n){var i=n.frag;t.setPlayingSegment(i.url,2!==i.byteRange.length?void 0:{offset:i.byteRange[0],length:i.byteRange[1]-i.byteRange[0]},i.start,i.duration)})),e.on("hlsDestroying",(function(){return __awaiter(n,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,t.destroy()];case 1:return e.sent(),[2]}}))}))})),e.on("hlsError",(function(n,i){if("bufferStalledError"===i.details){var r=void 0===e.media?e.el_:e.media;if(void 0===r)return;t.setPlayingSegmentByCurrentTime(r.currentTime)}}))}Object.defineProperty(t,"__esModule",{value:!0}),t.version="0.6.2",i(n("OKKN")),i(n("iXDm")),t.initHlsJsPlayer=r,t.initClapprPlayer=function(e){e.on("play",(function(){var t=e.core.getCurrentPlayback();t._hls&&!t._hls._p2pm_linitialized&&(t._hls._p2pm_linitialized=!0,r(e.core.getCurrentPlayback()._hls))}))},t.initFlowplayerHlsJsPlayer=function(e){e.on("ready",(function(){return r(e.engine.hlsjs?e.engine.hlsjs:e.engine.hls)}))},t.initVideoJsContribHlsJsPlayer=function(e){e.ready((function(){var t=e.tech_.options_;t&&t.hlsjsConfig&&t.hlsjsConfig.loader&&"function"==typeof t.hlsjsConfig.loader.getEngine&&s(e.tech_,t.hlsjsConfig.loader.getEngine())}))},t.initVideoJsHlsJsPlugin=function(){null!=videojs&&null!=videojs.Html5Hlsjs&&videojs.Html5Hlsjs.addHook("beforeinitialize",(function(e,t){t.config&&t.config.loader&&"function"==typeof t.config.loader.getEngine&&s(t,t.config.loader.getEngine())}))},t.initMediaElementJsPlayer=function(e){var t=this;e.addEventListener("hlsFragChanged",(function(t){var n=e.hlsPlayer;if(n&&n.config&&n.config.loader&&"function"==typeof n.config.loader.getEngine){var i=n.config.loader.getEngine();if(t.data&&t.data.length>1){var r=t.data[1].frag;i.setPlayingSegment(r.url,2!==r.byteRange.length?void 0:{offset:r.byteRange[0],length:r.byteRange[1]-r.byteRange[0]},r.start,r.duration)}}})),e.addEventListener("hlsDestroying",(function(){return __awaiter(t,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return(t=e.hlsPlayer)&&t.config&&t.config.loader&&"function"==typeof t.config.loader.getEngine?[4,t.config.loader.getEngine().destroy()]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))})),e.addEventListener("hlsError",(function(t){var n=e.hlsPlayer;n&&n.config&&n.config.loader&&"function"==typeof n.config.loader.getEngine&&void 0!==t.data&&"bufferStalledError"===t.data.details&&n.config.loader.getEngine().setPlayingSegmentByCurrentTime(n.media.currentTime)}))},t.initJwPlayer=function(e,t){var n=setInterval((function(){e.hls&&e.hls.config&&(clearInterval(n),Object.assign(e.hls.config,t),r(e.hls))}),200)}},tnIz:function(e,t,n){var i=n("hwdV").Buffer;function r(e,t){this._block=i.alloc(e),this._finalSize=t,this._blockSize=e,this._len=0}r.prototype.update=function(e,t){"string"==typeof e&&(e=i.from(e,t=t||"utf8"));for(var n=this._block,r=this._blockSize,s=e.length,a=this._len,o=0;o<s;){for(var u=a%r,d=Math.min(s-o,r-u),g=0;g<d;g++)n[u+g]=e[o+g];o+=d,(a+=d)%r==0&&this._update(n)}return this._len+=s,this},r.prototype.digest=function(e){var t=this._len%this._blockSize;this._block[t]=128,this._block.fill(0,t+1),t>=this._finalSize&&(this._update(this._block),this._block.fill(0));var n=8*this._len;if(n<=4294967295)this._block.writeUInt32BE(n,this._blockSize-4);else{var i=(4294967295&n)>>>0;this._block.writeUInt32BE((n-i)/4294967296,this._blockSize-8),this._block.writeUInt32BE(i,this._blockSize-4)}this._update(this._block);var r=this._hash();return e?r.toString(e):r},r.prototype._update=function(){throw new Error("_update must be implemented by subclass")},e.exports=r},uOj1:function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),t.version="0.6.2",i(n("O885")),i(n("lcUr"))},xzjP:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t){this.value=e,this.timeStamp=t};t.BandwidthApproximator=function(){function e(){this.lastBytes=[],this.currentBytesSum=0,this.lastBandwidth=[]}return e.prototype.addBytes=function(e,t){for(this.lastBytes.push(new i(e,t)),this.currentBytesSum+=e;t-this.lastBytes[0].timeStamp>1e3;)this.currentBytesSum-=this.lastBytes.shift().value;this.lastBandwidth.push(new i(this.currentBytesSum/1e3,t))},e.prototype.getBandwidth=function(e){for(;0!=this.lastBandwidth.length&&e-this.lastBandwidth[0].timeStamp>6e4;)this.lastBandwidth.shift();for(var t=0,n=0,i=this.lastBandwidth;n<i.length;n++){var r=i[n];r.value>t&&(t=r.value)}return t},e.prototype.getSmoothInterval=function(){return 1e3},e.prototype.getMeasureInterval=function(){return 6e4},e}()},yLkh:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HlsJsLoader=function(){function e(e){this.stats={},this.segmentManager=e}return e.prototype.load=function(e,t,n){return __awaiter(this,void 0,void 0,(function(){var t,i,r,s,a=this;return __generator(this,(function(o){switch(o.label){case 0:if(!e.type)return[3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.segmentManager.loadPlaylist(e.url)];case 2:return t=o.sent(),this.successPlaylist(t,e,n),[3,4];case 3:return i=o.sent(),this.error(i,e,n),[3,4];case 4:return[3,11];case 5:if(!e.frag)return[3,10];o.label=6;case 6:return o.trys.push([6,8,,9]),[4,this.segmentManager.loadSegment(e.url,null==e.rangeStart||null==e.rangeEnd?void 0:{offset:e.rangeStart,length:e.rangeEnd-e.rangeStart})];case 7:return void 0!==(r=o.sent()).content&&setTimeout((function(){return a.successSegment(r.content,r.downloadBandwidth,e,n)}),0),[3,9];case 8:return s=o.sent(),setTimeout((function(){return a.error(s,e,n)}),0),[3,9];case 9:return[3,11];case 10:console.warn("Unknown load request",e),o.label=11;case 11:return[2]}}))}))},e.prototype.abort=function(e){this.segmentManager.abortSegment(e.url,null==e.rangeStart||null==e.rangeEnd?void 0:{offset:e.rangeStart,length:e.rangeEnd-e.rangeStart})},e.prototype.successPlaylist=function(e,t,n){var i=performance.now();this.stats.trequest=i-300,this.stats.tfirst=i-200,this.stats.tload=i,this.stats.loaded=e.response.length,n.onSuccess({url:e.responseURL,data:e.response},this.stats,t)},e.prototype.successSegment=function(e,t,n,i){var r=performance.now(),s=e.byteLength/(void 0===t||t<=0?12500:t);this.stats.trequest=r-1-s,this.stats.tfirst=r-s,this.stats.tload=r,this.stats.loaded=e.byteLength,i.onSuccess({url:n.url,data:e},this.stats,n)},e.prototype.error=function(e,t,n){n.onError(e,t)},e}()}}]);