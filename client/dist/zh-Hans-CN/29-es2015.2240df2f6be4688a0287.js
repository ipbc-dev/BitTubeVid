(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{t94N:function(a,e,n){"use strict";n.r(e);var l=n("8Y7J");class i{}var o=n("pMnS"),t=n("1+T7"),d=n("iInd"),s=n("SVse"),u=n("s7LF"),r=n("ecRl"),p=n("QUbI"),m=n("3szM"),c=n("0C+C"),v=n("cKMx"),h=n("LTwV"),g=n("mOsc"),f=n("pyEO"),C=n("M9Zh"),b=n("kIzR"),M=n("fKnF"),V=n("ihI+"),F=n("lJxs"),I=n("eIep"),N=(n("ey9i"),n("M0ag")),S=n("UFc/"),_=(n("HUk+"),n("XRCn"));class T extends N.a{constructor(a,e,n,l,i,o,t,d){super(),this.formValidatorService=a,this.route=e,this.router=n,this.notifier=l,this.videoService=i,this.loadingBar=o,this.videoCaptionService=t,this.i18n=d,this.isUpdatingVideo=!1,this.userVideoChannels=[],this.schedulePublicationPossible=!1,this.videoCaptions=[],this.waitTranscodingEnabled=!0,this.updateDone=!1}ngOnInit(){this.buildForm({}),this.route.data.pipe(Object(F.a)(a=>a.videoData)).subscribe(({video:a,videoChannels:e,videoCaptions:n})=>{this.video=new S.a(a),this.userVideoChannels=e,this.videoCaptions=n,this.schedulePublicationPossible=this.video.privacy===_.m.PRIVATE,a.getFiles().length>1&&(this.waitTranscodingEnabled=!1),setTimeout(()=>this.hydrateFormFromVideo())},a=>{console.error(a),this.notifier.error(a.message)})}onUnload(a){const{text:e,canDeactivate:n}=this.canDeactivate();if(!n)return a.returnValue=e,e}canDeactivate(){if(!0===this.updateDone)return{canDeactivate:!0};const a=this.i18n("You have unsaved changes! If you leave, your changes will be lost.");for(const e of this.videoCaptions)if(e.action)return{canDeactivate:!1,text:a};return{canDeactivate:!1===this.formChanged,text:a}}checkForm(){return this.forceCheck(),this.form.valid}update(){!1!==this.checkForm()&&!0!==this.isUpdatingVideo&&(this.video.patch(this.form.value),this.loadingBar.start(),this.isUpdatingVideo=!0,this.videoService.updateVideo(this.video).pipe(Object(I.a)(()=>this.videoCaptionService.updateCaptions(this.video.id,this.videoCaptions))).subscribe(()=>{this.updateDone=!0,this.isUpdatingVideo=!1,this.loadingBar.complete(),this.notifier.success(this.i18n("Video updated.")),this.router.navigate(["/videos/watch",this.video.uuid])},a=>{this.loadingBar.complete(),this.isUpdatingVideo=!1,this.notifier.error(a.message),console.error(a)}))}hydrateFormFromVideo(){this.form.patchValue(this.video.toFormPatch());const a=[{url:"thumbnailUrl",name:"thumbnailfile"},{url:"previewUrl",name:"previewfile"}];for(const e of a)fetch(this.video[e.url]).then(a=>a.blob()).then(a=>{this.form.patchValue({[e.name]:a})})}}var D=n("TtxX"),O=n("GiVz"),k=l["\u0275crt"]({encapsulation:0,styles:[t.a],data:{}});function w(a){return l["\u0275vid"](0,[(a()(),l["\u0275eld"](0,0,null,null,22,"div",[["class","margin-content"]],null,null,null,null,null)),(a()(),l["\u0275eld"](1,0,null,null,6,"div",[["class","title-page title-page-single"]],null,null,null,null,null)),(a()(),l["\u0275eld"](2,0,null,null,1,"span",[["class","mr-1"]],null,null,null,null,null)),(a()(),l["\u0275ted"](-1,null,["\u66f4\u65b0"])),(a()(),l["\u0275eld"](4,0,null,null,3,"a",[],[[1,"target",0],[8,"href",4]],[[null,"click"]],(function(a,e,n){var i=!0;return"click"===e&&(i=!1!==l["\u0275nov"](a,5).onClick(n.button,n.ctrlKey,n.metaKey,n.shiftKey)&&i),i}),null,null)),l["\u0275did"](5,671744,null,0,d.s,[d.p,d.a,s.LocationStrategy],{routerLink:[0,"routerLink"]},null),l["\u0275pad"](6,2),(a()(),l["\u0275ted"](7,null,["",""])),(a()(),l["\u0275eld"](8,0,null,null,14,"form",[["novalidate",""]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"submit"],[null,"reset"]],(function(a,e,n){var i=!0;return"submit"===e&&(i=!1!==l["\u0275nov"](a,10).onSubmit(n)&&i),"reset"===e&&(i=!1!==l["\u0275nov"](a,10).onReset()&&i),i}),null,null)),l["\u0275did"](9,16384,null,0,u["\u0275angular_packages_forms_forms_z"],[],null,null),l["\u0275did"](10,540672,null,0,u.FormGroupDirective,[[8,null],[8,null]],{form:[0,"form"]},null),l["\u0275prd"](2048,null,u.ControlContainer,null,[u.FormGroupDirective]),l["\u0275did"](12,16384,null,0,u.NgControlStatusGroup,[[4,u.ControlContainer]],null,null),(a()(),l["\u0275eld"](13,0,null,null,1,"my-video-edit",[],null,null,null,r.b,r.a)),l["\u0275did"](14,245760,null,0,p.a,[m.a,c.a,v.a,h.a,d.a,d.p,g.a,f.a,C.a,l.NgZone],{form:[0,"form"],formErrors:[1,"formErrors"],validationMessages:[2,"validationMessages"],userVideoChannels:[3,"userVideoChannels"],schedulePublicationPossible:[4,"schedulePublicationPossible"],videoCaptions:[5,"videoCaptions"],waitTranscodingEnabled:[6,"waitTranscodingEnabled"]},null),(a()(),l["\u0275eld"](15,0,null,null,7,"div",[["class","submit-container"]],null,null,null,null,null)),(a()(),l["\u0275eld"](16,0,null,null,6,"div",[["class","submit-button"]],null,[[null,"click"]],(function(a,e,n){var l=!0;return"click"===e&&(l=!1!==a.component.update()&&l),l}),null,null)),l["\u0275prd"](512,null,s["\u0275NgClassImpl"],s["\u0275NgClassR2Impl"],[l.IterableDiffers,l.KeyValueDiffers,l.ElementRef,l.Renderer2]),l["\u0275did"](18,278528,null,0,s.NgClass,[s["\u0275NgClassImpl"]],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),l["\u0275pod"](19,{disabled:0}),(a()(),l["\u0275eld"](20,0,null,null,1,"my-global-icon",[["iconName","validate"]],null,null,null,b.b,b.a)),l["\u0275did"](21,114688,null,0,M.a,[l.ElementRef,V.a],{iconName:[0,"iconName"]},null),(a()(),l["\u0275eld"](22,0,null,null,0,"input",[["type","button"],["value","\u66f4\u65b0"]],null,null,null,null,null))],(function(a,e){var n=e.component,l=a(e,6,0,"/videos/watch",n.video.uuid);a(e,5,0,l),a(e,10,0,n.form),a(e,14,0,n.form,n.formErrors,n.validationMessages,n.userVideoChannels,n.schedulePublicationPossible,n.videoCaptions,n.waitTranscodingEnabled);var i=a(e,19,0,!n.form.valid||!0===n.isUpdatingVideo);a(e,18,0,"submit-button",i),a(e,21,0,"validate")}),(function(a,e){var n=e.component;a(e,4,0,l["\u0275nov"](e,5).target,l["\u0275nov"](e,5).href),a(e,7,0,null==n.video?null:n.video.name),a(e,8,0,l["\u0275nov"](e,12).ngClassUntouched,l["\u0275nov"](e,12).ngClassTouched,l["\u0275nov"](e,12).ngClassPristine,l["\u0275nov"](e,12).ngClassDirty,l["\u0275nov"](e,12).ngClassValid,l["\u0275nov"](e,12).ngClassInvalid,l["\u0275nov"](e,12).ngClassPending)}))}function y(a){return l["\u0275vid"](0,[(a()(),l["\u0275eld"](0,0,null,null,1,"my-videos-update",[],null,[["window","beforeunload"]],(function(a,e,n){var i=!0;return"window:beforeunload"===e&&(i=!1!==l["\u0275nov"](a,1).onUnload(n)&&i),i}),w,k)),l["\u0275did"](1,114688,null,0,T,[m.a,d.a,d.p,g.a,h.a,D.c,v.a,O.a],null,null)],(function(a,e){a(e,1,0)}),null)}var R=l["\u0275ccf"]("my-videos-update",T,y,{},{},[]),P=n("9AJC"),E=n("CLta"),A=n("IheW"),L=n("9IV+"),U=n("G0yt"),j=n("Huiz"),B=n("nvTd"),x=n("upD4"),z=n("6RP5"),K=n("HvDw"),X=n("vQJr"),G=n("l/z6"),H=n("wQE2"),J=n("biPt"),Z=n("mTdg"),Y=n("VNja"),Q=n("mpCX"),q=n("hD3C"),W=n("F4xN"),$=n("Qmuk"),aa=n("yXFd"),ea=n("wpFD"),na=n("/7bI"),la=n("JtBY"),ia=n("D/X6"),oa=n("cvwr"),ta=n("tSwB"),da=n("RtUV"),sa=n("W3Gj"),ua=n("AD+P"),ra=n("hlYB"),pa=n("I88b"),ma=n("GvuC"),ca=n("V+Hg"),va=n("45hh"),ha=n("WZ9d"),ga=n("fR23"),fa=n("1MVc"),Ca=n("Vurf"),ba=n("mpAo"),Ma=n("c6Lk"),Va=n("j8ES"),Fa=n("cp0P");class Ia{constructor(a,e,n){this.videoService=a,this.videoChannelService=e,this.videoCaptionService=n}resolve(a){return this.videoService.getVideo({videoId:a.params.uuid}).pipe(Object(I.a)(a=>Object(Fa.a)([this.videoService.loadCompleteDescription(a.descriptionPath).pipe(Object(F.a)(e=>Object.assign(a,{description:e}))),this.videoChannelService.listAccountVideoChannels(a.account).pipe(Object(F.a)(a=>a.data),Object(F.a)(a=>a.map(a=>({id:a.id,label:a.displayName,support:a.support})))),this.videoCaptionService.listCaptions(a.id).pipe(Object(F.a)(a=>a.data))])),Object(F.a)(([a,e,n])=>({video:a,videoChannels:e,videoCaptions:n})))}}var Na=n("fftR"),Sa=n("37nT"),_a=n("Phsq");class Ta{}var Da=n("mB+Y"),Oa=n("VSng"),ka=n("7LN8"),wa=n("KB/w"),ya=n("IbkX"),Ra=n("Fa87"),Pa=n("oz/p"),Ea=n("VQoA"),Aa=n("IP0z"),La=n("/HVE"),Ua=n("hOhj"),ja=n("g4HV"),Ba=n("No4M"),xa=n("PCNd"),za=n("pYoP"),Ka=n("0dEx");n.d(e,"VideoUpdateModuleNgFactory",(function(){return Xa}));var Xa=l["\u0275cmf"](i,[],(function(a){return l["\u0275mod"]([l["\u0275mpd"](512,l.ComponentFactoryResolver,l["\u0275CodegenComponentFactoryResolver"],[[8,[o.a,R,P.g,P.h,P.e,P.f]],[3,l.ComponentFactoryResolver],l.NgModuleRef]),l["\u0275mpd"](4608,s.NgLocalization,s.NgLocaleLocalization,[l.LOCALE_ID,[2,s["\u0275angular_packages_common_common_a"]]]),l["\u0275mpd"](4608,u.FormBuilder,u.FormBuilder,[]),l["\u0275mpd"](4608,u["\u0275angular_packages_forms_forms_o"],u["\u0275angular_packages_forms_forms_o"],[]),l["\u0275mpd"](4608,E.h,E.h,[]),l["\u0275mpd"](4608,A.m,A.s,[s.DOCUMENT,l.PLATFORM_ID,A.q]),l["\u0275mpd"](4608,A.t,A.t,[A.m,A.r]),l["\u0275mpd"](5120,A.a,(function(a,e){return[a,new L.a(e)]}),[A.t,l.Injector]),l["\u0275mpd"](4608,A.p,A.p,[]),l["\u0275mpd"](6144,A.n,null,[A.p]),l["\u0275mpd"](4608,A.l,A.l,[A.n]),l["\u0275mpd"](6144,A.b,null,[A.l]),l["\u0275mpd"](4608,A.g,A.o,[A.b,l.Injector]),l["\u0275mpd"](4608,A.c,A.c,[A.g]),l["\u0275mpd"](4608,U.A,U.A,[l.ComponentFactoryResolver,l.Injector,U.yb,U.B]),l["\u0275mpd"](4608,O.a,O.a,[l.TRANSLATIONS_FORMAT,l.TRANSLATIONS,l.LOCALE_ID,[2,O.b]]),l["\u0275mpd"](4608,j.a,j.a,[d.p,O.a]),l["\u0275mpd"](4608,B.a,B.a,[]),l["\u0275mpd"](4608,x.a,x.a,[A.c,B.a,j.a]),l["\u0275mpd"](4608,z.a,z.a,[A.c,B.a,j.a]),l["\u0275mpd"](4608,K.a,K.a,[A.c,B.a,j.a]),l["\u0275mpd"](4608,X.a,X.a,[A.c,j.a,B.a,O.a]),l["\u0275mpd"](4608,h.a,h.a,[A.c,j.a,B.a,f.a,O.a]),l["\u0275mpd"](4608,G.a,G.a,[A.c,j.a]),l["\u0275mpd"](4608,H.a,H.a,[A.c,B.a,j.a]),l["\u0275mpd"](4608,J.a,J.a,[A.c,f.a,j.a,B.a,l.NgZone]),l["\u0275mpd"](4608,v.a,v.a,[A.c,f.a,j.a]),l["\u0275mpd"](4608,Z.a,Z.a,[A.c,B.a,j.a,f.a]),l["\u0275mpd"](4608,Y.a,Y.a,[A.c,j.a,B.a,l.NgZone]),l["\u0275mpd"](4608,m.a,m.a,[u.FormBuilder]),l["\u0275mpd"](4608,Q.a,Q.a,[O.a]),l["\u0275mpd"](4608,q.a,q.a,[O.a]),l["\u0275mpd"](4608,W.a,W.a,[O.a]),l["\u0275mpd"](4608,$.a,$.a,[O.a]),l["\u0275mpd"](4608,aa.a,aa.a,[O.a]),l["\u0275mpd"](4608,ea.a,ea.a,[O.a]),l["\u0275mpd"](4608,na.a,na.a,[O.a]),l["\u0275mpd"](4608,la.a,la.a,[O.a]),l["\u0275mpd"](4608,c.a,c.a,[O.a]),l["\u0275mpd"](4608,ia.a,ia.a,[O.a]),l["\u0275mpd"](4608,oa.a,oa.a,[O.a]),l["\u0275mpd"](4608,ta.a,ta.a,[A.c,j.a,h.a,f.a]),l["\u0275mpd"](4608,da.a,da.a,[O.a]),l["\u0275mpd"](4608,sa.a,sa.a,[O.a]),l["\u0275mpd"](4608,ua.a,ua.a,[O.a]),l["\u0275mpd"](4608,ra.a,ra.a,[A.c,j.a,B.a]),l["\u0275mpd"](4608,pa.a,pa.a,[A.c,j.a,B.a,h.a]),l["\u0275mpd"](4608,ma.a,ma.a,[]),l["\u0275mpd"](4608,ca.a,ca.a,[ma.a]),l["\u0275mpd"](4608,va.a,va.a,[ca.a]),l["\u0275mpd"](4608,ha.a,ha.a,[A.c,B.a,j.a,va.a,f.a]),l["\u0275mpd"](4608,C.a,C.a,[O.a]),l["\u0275mpd"](4608,ga.a,ga.a,[]),l["\u0275mpd"](4608,fa.a,fa.a,[Ca.a,A.c,j.a,B.a,ba.a]),l["\u0275mpd"](4608,Ma.a,Ma.a,[A.c,B.a,j.a]),l["\u0275mpd"](4608,Va.a,Va.a,[A.c,B.a,j.a]),l["\u0275mpd"](4608,Ia,Ia,[h.a,H.a,v.a]),l["\u0275mpd"](4608,Na.a,Na.a,[Sa.a,O.a]),l["\u0275mpd"](1073742336,d.t,d.t,[[2,d.z],[2,d.p]]),l["\u0275mpd"](1073742336,Ta,Ta,[]),l["\u0275mpd"](1073742336,s.CommonModule,s.CommonModule,[]),l["\u0275mpd"](1073742336,u["\u0275angular_packages_forms_forms_d"],u["\u0275angular_packages_forms_forms_d"],[]),l["\u0275mpd"](1073742336,u.ReactiveFormsModule,u.ReactiveFormsModule,[]),l["\u0275mpd"](1073742336,u.FormsModule,u.FormsModule,[]),l["\u0275mpd"](1073742336,Da.e,Da.e,[]),l["\u0275mpd"](1073742336,E.f,E.f,[]),l["\u0275mpd"](1073742336,Oa.ButtonModule,Oa.ButtonModule,[]),l["\u0275mpd"](1073742336,ka.SharedModule,ka.SharedModule,[]),l["\u0275mpd"](1073742336,wa.CalendarModule,wa.CalendarModule,[]),l["\u0275mpd"](1073742336,A.e,A.e,[]),l["\u0275mpd"](1073742336,A.d,A.d,[]),l["\u0275mpd"](1073742336,U.x,U.x,[]),l["\u0275mpd"](1073742336,U.C,U.C,[]),l["\u0275mpd"](1073742336,U.N,U.N,[]),l["\u0275mpd"](1073742336,U.Z,U.Z,[]),l["\u0275mpd"](1073742336,U.kb,U.kb,[]),l["\u0275mpd"](1073742336,U.m,U.m,[]),l["\u0275mpd"](1073742336,ya.b,ya.b,[]),l["\u0275mpd"](1073742336,Ra.InputTextModule,Ra.InputTextModule,[]),l["\u0275mpd"](1073742336,Pa.InputMaskModule,Pa.InputMaskModule,[]),l["\u0275mpd"](1073742336,Ea.b,Ea.b,[]),l["\u0275mpd"](1073742336,Ea.h,Ea.h,[]),l["\u0275mpd"](1073742336,Ea.e,Ea.e,[]),l["\u0275mpd"](1073742336,Ea.c,Ea.c,[]),l["\u0275mpd"](1073742336,Ea.f,Ea.f,[]),l["\u0275mpd"](1073742336,Ea.d,Ea.d,[]),l["\u0275mpd"](1073742336,Ea.g,Ea.g,[]),l["\u0275mpd"](1073742336,Aa.a,Aa.a,[]),l["\u0275mpd"](1073742336,La.b,La.b,[]),l["\u0275mpd"](1073742336,Ua.ScrollingModule,Ua.ScrollingModule,[]),l["\u0275mpd"](1073742336,ja.TooltipModule,ja.TooltipModule,[]),l["\u0275mpd"](1073742336,Ba.MultiSelectModule,Ba.MultiSelectModule,[]),l["\u0275mpd"](1073742336,xa.a,xa.a,[]),l["\u0275mpd"](1073742336,za.a,za.a,[]),l["\u0275mpd"](1073742336,i,i,[]),l["\u0275mpd"](1024,d.n,(function(){return[[{path:"",component:T,canActivate:[_a.a,Ka.a],canDeactivate:[Na.a],resolve:{videoData:Ia}}]]}),[]),l["\u0275mpd"](256,l.LOCALE_ID,"zh-Hans-CN",[]),l["\u0275mpd"](256,u.COMPOSITION_BUFFER_MODE,!1,[]),l["\u0275mpd"](256,A.q,"XSRF-TOKEN",[]),l["\u0275mpd"](256,A.r,"X-XSRF-TOKEN",[]),l["\u0275mpd"](256,l.TRANSLATIONS_FORMAT,"xlf",[])])}))}}]);