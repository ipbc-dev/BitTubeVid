function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,a=!1,s=void 0;try{for(var i,o=e[Symbol.iterator]();!(r=(i=o.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(u){a=!0,s=u}finally{try{r||null==o.return||o.return()}finally{if(a)throw s}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _get(e,t,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=_superPropBase(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function asyncGeneratorStep(e,t,n,r,a,s,i){try{var o=e[s](i),u=o.value}catch(l){return void n(l)}o.done?t(u):Promise.resolve(u).then(r,a)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function i(e){asyncGeneratorStep(s,r,a,i,o,"next",e)}function o(e){asyncGeneratorStep(s,r,a,i,o,"throw",e)}i(void 0)}))}}function _createForOfIteratorHelper(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,r=_getPrototypeOf(e);if(t){var a=_getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"0ovO":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("NOtv"),a=n("A+nu");t.HttpMediaManager=function(e){_inherits(a,e);var t,n=_createSuper(a);function a(e){var t;return _classCallCheck(this,a),(t=n.call(this)).settings=e,t.xhrRequests=new Map,t.failedSegments=new Map,t.debug=r("p2pml:http-media-manager"),t.now=function(){return performance.now()},t}return _createClass(a,[{key:"download",value:function(e,t){if(!this.isDownloading(e)){this.cleanTimedOutFailedSegments();var n=this.settings.segmentUrlBuilder?this.settings.segmentUrlBuilder(e):e.url;this.debug("http segment download",n),e.requestUrl=n;var r=new XMLHttpRequest;if(r.open("GET",n,!0),r.responseType="arraybuffer",e.range)r.setRequestHeader("Range",e.range),t=void 0;else if(void 0!==t&&this.settings.httpUseRanges){var a,s=0,i=_createForOfIteratorHelper(t);try{for(i.s();!(a=i.n()).done;){s+=a.value.byteLength}}catch(o){i.e(o)}finally{i.f()}r.setRequestHeader("Range","bytes=".concat(s,"-")),this.debug("continue download from",s)}else t=void 0;this.setupXhrEvents(r,e,t),this.settings.xhrSetup&&this.settings.xhrSetup(r,n),this.xhrRequests.set(e.id,{xhr:r,segment:e}),r.send()}}},{key:"abort",value:function(e){var t=this.xhrRequests.get(e.id);t&&(t.xhr.abort(),this.xhrRequests.delete(e.id),this.debug("http segment abort",e.id))}},{key:"isDownloading",value:function(e){return this.xhrRequests.has(e.id)}},{key:"isFailed",value:function(e){var t=this.failedSegments.get(e.id);return void 0!==t&&t>this.now()}},{key:"getActiveDownloads",value:function(){return this.xhrRequests}},{key:"getActiveDownloadsCount",value:function(){return this.xhrRequests.size}},{key:"destroy",value:function(){this.xhrRequests.forEach((function(e){return e.xhr.abort()})),this.xhrRequests.clear()}},{key:"setupXhrEvents",value:function(e,t,n){var r=this,a=0;e.addEventListener("progress",(function(e){r.emit("bytes-downloaded",e.loaded-a),a=e.loaded})),e.addEventListener("load",function(){var a=_asyncToGenerator(regeneratorRuntime.mark((function a(s){var i,o,u,l,d,c,g,m,h,p;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!(s.target.status<200||s.target.status>=300)){a.next=2;break}return a.abrupt("return",void r.segmentFailure(t,s,e));case 2:if(i=s.target.response,void 0!==n&&206===s.target.status){o=0,u=_createForOfIteratorHelper(n);try{for(u.s();!(l=u.n()).done;)d=l.value,o+=d.byteLength}catch(f){u.e(f)}finally{u.f()}c=new Uint8Array(o+i.byteLength),g=0,m=_createForOfIteratorHelper(n);try{for(m.s();!(h=m.n()).done;)p=h.value,c.set(new Uint8Array(p),g),g+=p.byteLength}catch(f){m.e(f)}finally{m.f()}c.set(new Uint8Array(i),g),i=c.buffer}return a.next=6,r.segmentDownloadFinished(t,i,e);case 6:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()),e.addEventListener("error",(function(n){r.segmentFailure(t,n,e)})),e.addEventListener("timeout",(function(n){r.segmentFailure(t,n,e)}))}},{key:"segmentDownloadFinished",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.responseUrl=null===r.responseURL?void 0:r.responseURL,!this.settings.segmentValidator){e.next=9;break}return e.prev=1,e.next=4,this.settings.segmentValidator(Object.assign(Object.assign({},t),{data:n}),"http");case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return",(this.debug("segment validator failed",e.t0),void this.segmentFailure(t,e.t0,r)));case 9:this.xhrRequests.delete(t.id),this.emit("segment-loaded",t,n);case 10:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e,n,r){return t.apply(this,arguments)})},{key:"segmentFailure",value:function(e,t,n){e.responseUrl=null===n.responseURL?void 0:n.responseURL,this.xhrRequests.delete(e.id),this.failedSegments.set(e.id,this.now()+this.settings.httpFailedSegmentTimeout),this.emit("segment-error",e,t)}},{key:"cleanTimedOutFailedSegments",value:function(){var e=this,t=this.now(),n=[];this.failedSegments.forEach((function(e,r){e<t&&n.push(r)})),n.forEach((function(t){return e.failedSegments.delete(t)}))}}]),a}(a.STEEmitter)},"10ky":function(e,t,n){"use strict";n.r(t),n.d(t,"LineStream",(function(){return u})),n.d(t,"ParseStream",(function(){return d})),n.d(t,"Parser",(function(){return g}));var r=n("vgmO"),a=n.n(r);function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var o=function(){function e(){this.listeners={}}var t=e.prototype;return t.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.off=function(e,t){if(!this.listeners[e])return!1;var n=this.listeners[e].indexOf(t);return this.listeners[e].splice(n,1),n>-1},t.trigger=function(e){var t,n,r,a=this.listeners[e];if(a)if(2===arguments.length)for(n=a.length,t=0;t<n;++t)a[t].call(this,arguments[1]);else for(r=Array.prototype.slice.call(arguments,1),n=a.length,t=0;t<n;++t)a[t].apply(this,r)},t.dispose=function(){this.listeners={}},t.pipe=function(e){this.on("data",(function(t){e.push(t)}))},e}(),u=function(e){function t(){var t;return(t=e.call(this)||this).buffer="",t}return i(t,e),t.prototype.push=function(e){var t;for(this.buffer+=e,t=this.buffer.indexOf("\n");t>-1;t=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)},t}(o),l=function(e){for(var t,n=e.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')),r={},a=n.length;a--;)""!==n[a]&&((t=/([^=]*)=(.*)/.exec(n[a]).slice(1))[0]=t[0].replace(/^\s+|\s+$/g,""),t[1]=t[1].replace(/^\s+|\s+$/g,""),t[1]=t[1].replace(/^['"](.*)['"]$/g,"$1"),r[t[0]]=t[1]);return r},d=function(e){function t(){var t;return(t=e.call(this)||this).customParsers=[],t.tagMappers=[],t}i(t,e);var n=t.prototype;return n.push=function(e){var t,n,r=this;0!==(e=e.trim()).length&&("#"===e[0]?this.tagMappers.reduce((function(t,n){var r=n(e);return r===e?t:t.concat([r])}),[e]).forEach((function(e){for(var a=0;a<r.customParsers.length;a++)if(r.customParsers[a].call(r,e))return;if(0===e.indexOf("#EXT"))if(e=e.replace("\r",""),t=/^#EXTM3U/.exec(e))r.trigger("data",{type:"tag",tagType:"m3u"});else{if(t=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(e))return n={type:"tag",tagType:"inf"},t[1]&&(n.duration=parseFloat(t[1])),t[2]&&(n.title=t[2]),void r.trigger("data",n);if(t=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(e))return n={type:"tag",tagType:"targetduration"},t[1]&&(n.duration=parseInt(t[1],10)),void r.trigger("data",n);if(t=/^#ZEN-TOTAL-DURATION:?([0-9.]*)?/.exec(e))return n={type:"tag",tagType:"totalduration"},t[1]&&(n.duration=parseInt(t[1],10)),void r.trigger("data",n);if(t=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(e))return n={type:"tag",tagType:"version"},t[1]&&(n.version=parseInt(t[1],10)),void r.trigger("data",n);if(t=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(e))return n={type:"tag",tagType:"media-sequence"},t[1]&&(n.number=parseInt(t[1],10)),void r.trigger("data",n);if(t=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(e))return n={type:"tag",tagType:"discontinuity-sequence"},t[1]&&(n.number=parseInt(t[1],10)),void r.trigger("data",n);if(t=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(e))return n={type:"tag",tagType:"playlist-type"},t[1]&&(n.playlistType=t[1]),void r.trigger("data",n);if(t=/^#EXT-X-BYTERANGE:?([0-9.]*)?@?([0-9.]*)?/.exec(e))return n={type:"tag",tagType:"byterange"},t[1]&&(n.length=parseInt(t[1],10)),t[2]&&(n.offset=parseInt(t[2],10)),void r.trigger("data",n);if(t=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(e))return n={type:"tag",tagType:"allow-cache"},t[1]&&(n.allowed=!/NO/.test(t[1])),void r.trigger("data",n);if(t=/^#EXT-X-MAP:?(.*)$/.exec(e)){if(n={type:"tag",tagType:"map"},t[1]){var s=l(t[1]);if(s.URI&&(n.uri=s.URI),s.BYTERANGE){var i=s.BYTERANGE.split("@"),o=i[0],u=i[1];n.byterange={},o&&(n.byterange.length=parseInt(o,10)),u&&(n.byterange.offset=parseInt(u,10))}}r.trigger("data",n)}else if(t=/^#EXT-X-STREAM-INF:?(.*)$/.exec(e)){if(n={type:"tag",tagType:"stream-inf"},t[1]){if(n.attributes=l(t[1]),n.attributes.RESOLUTION){var d=n.attributes.RESOLUTION.split("x"),c={};d[0]&&(c.width=parseInt(d[0],10)),d[1]&&(c.height=parseInt(d[1],10)),n.attributes.RESOLUTION=c}n.attributes.BANDWIDTH&&(n.attributes.BANDWIDTH=parseInt(n.attributes.BANDWIDTH,10)),n.attributes["PROGRAM-ID"]&&(n.attributes["PROGRAM-ID"]=parseInt(n.attributes["PROGRAM-ID"],10))}r.trigger("data",n)}else{if(t=/^#EXT-X-MEDIA:?(.*)$/.exec(e))return n={type:"tag",tagType:"media"},t[1]&&(n.attributes=l(t[1])),void r.trigger("data",n);if(t=/^#EXT-X-ENDLIST/.exec(e))r.trigger("data",{type:"tag",tagType:"endlist"});else if(t=/^#EXT-X-DISCONTINUITY/.exec(e))r.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(t=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(e))return n={type:"tag",tagType:"program-date-time"},t[1]&&(n.dateTimeString=t[1],n.dateTimeObject=new Date(t[1])),void r.trigger("data",n);if(t=/^#EXT-X-KEY:?(.*)$/.exec(e))return n={type:"tag",tagType:"key"},t[1]&&(n.attributes=l(t[1]),n.attributes.IV&&("0x"===n.attributes.IV.substring(0,2).toLowerCase()&&(n.attributes.IV=n.attributes.IV.substring(2)),n.attributes.IV=n.attributes.IV.match(/.{8}/g),n.attributes.IV[0]=parseInt(n.attributes.IV[0],16),n.attributes.IV[1]=parseInt(n.attributes.IV[1],16),n.attributes.IV[2]=parseInt(n.attributes.IV[2],16),n.attributes.IV[3]=parseInt(n.attributes.IV[3],16),n.attributes.IV=new Uint32Array(n.attributes.IV))),void r.trigger("data",n);if(t=/^#EXT-X-START:?(.*)$/.exec(e))return n={type:"tag",tagType:"start"},t[1]&&(n.attributes=l(t[1]),n.attributes["TIME-OFFSET"]=parseFloat(n.attributes["TIME-OFFSET"]),n.attributes.PRECISE=/YES/.test(n.attributes.PRECISE)),void r.trigger("data",n);if(t=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(e))return(n={type:"tag",tagType:"cue-out-cont"}).data=t[1]?t[1]:"",void r.trigger("data",n);if(t=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(e))return(n={type:"tag",tagType:"cue-out"}).data=t[1]?t[1]:"",void r.trigger("data",n);if(t=/^#EXT-X-CUE-IN:?(.*)?$/.exec(e))return(n={type:"tag",tagType:"cue-in"}).data=t[1]?t[1]:"",void r.trigger("data",n);r.trigger("data",{type:"tag",data:e.slice(4)})}}}else r.trigger("data",{type:"comment",text:e.slice(1)})})):this.trigger("data",{type:"uri",uri:e}))},n.addParser=function(e){var t=this,n=e.expression,r=e.customType,a=e.dataParser,s=e.segment;"function"!=typeof a&&(a=function(e){return e}),this.customParsers.push((function(e){if(n.exec(e))return t.trigger("data",{type:"custom",data:a(e),customType:r,segment:s}),!0}))},n.addTagMapper=function(e){var t=e.expression,n=e.map;this.tagMappers.push((function(e){return t.test(e)?n(e):e}))},t}(o);function c(e){for(var t=a.a.atob(e||""),n=new Uint8Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}var g=function(e){function t(){var t;(t=e.call(this)||this).lineStream=new u,t.parseStream=new d,t.lineStream.pipe(t.parseStream);var n,r,a=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t),i=[],o={},l=function(){},g={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},m=0;return t.manifest={allowCache:!0,discontinuityStarts:[],segments:[]},t.parseStream.on("data",(function(e){var t,u;({tag:function(){({"allow-cache":function(){this.manifest.allowCache=e.allowed,"allowed"in e||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var t={};"length"in e&&(o.byterange=t,t.length=e.length,"offset"in e||(this.trigger("info",{message:"defaulting offset to zero"}),e.offset=0)),"offset"in e&&(o.byterange=t,t.offset=e.offset)},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),e.duration>0&&(o.duration=e.duration),0===e.duration&&(o.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=i},key:function(){if(e.attributes)if("NONE"!==e.attributes.METHOD)if(e.attributes.URI){if("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===e.attributes.KEYFORMAT)return-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(e.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===e.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==e.attributes.URI.substring(0,23)?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):e.attributes.KEYID&&"0x"===e.attributes.KEYID.substring(0,2)?void(this.manifest.contentProtection={"com.widevine.alpha":{attributes:{schemeIdUri:e.attributes.KEYFORMAT,keyId:e.attributes.KEYID.substring(2)},pssh:c(e.attributes.URI.split(",")[1])}}):void this.trigger("warn",{message:"invalid key ID provided for Widevine"}));e.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),r={method:e.attributes.METHOD||"AES-128",uri:e.attributes.URI},void 0!==e.attributes.IV&&(r.iv=e.attributes.IV)}else this.trigger("warn",{message:"ignoring key declaration without URI"});else r=null;else this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence":function(){isFinite(e.number)?this.manifest.mediaSequence=e.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+e.number})},"discontinuity-sequence":function(){isFinite(e.number)?(this.manifest.discontinuitySequence=e.number,m=e.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+e.number})},"playlist-type":function(){/VOD|EVENT/.test(e.playlistType)?this.manifest.playlistType=e.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+e.playlist})},map:function(){n={},e.uri&&(n.uri=e.uri),e.byterange&&(n.byterange=e.byterange)},"stream-inf":function(){this.manifest.playlists=i,this.manifest.mediaGroups=this.manifest.mediaGroups||g,e.attributes?(o.attributes||(o.attributes={}),s(o.attributes,e.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media:function(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||g,e.attributes&&e.attributes.TYPE&&e.attributes["GROUP-ID"]&&e.attributes.NAME){var n=this.manifest.mediaGroups[e.attributes.TYPE];n[e.attributes["GROUP-ID"]]=n[e.attributes["GROUP-ID"]]||{},t=n[e.attributes["GROUP-ID"]],(u={default:/yes/i.test(e.attributes.DEFAULT)}).autoselect=!!u.default||/yes/i.test(e.attributes.AUTOSELECT),e.attributes.LANGUAGE&&(u.language=e.attributes.LANGUAGE),e.attributes.URI&&(u.uri=e.attributes.URI),e.attributes["INSTREAM-ID"]&&(u.instreamId=e.attributes["INSTREAM-ID"]),e.attributes.CHARACTERISTICS&&(u.characteristics=e.attributes.CHARACTERISTICS),e.attributes.FORCED&&(u.forced=/yes/i.test(e.attributes.FORCED)),t[e.attributes.NAME]=u}else this.trigger("warn",{message:"ignoring incomplete or missing media group"})},discontinuity:function(){m+=1,o.discontinuity=!0,this.manifest.discontinuityStarts.push(i.length)},"program-date-time":function(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=e.dateTimeString,this.manifest.dateTimeObject=e.dateTimeObject),o.dateTimeString=e.dateTimeString,o.dateTimeObject=e.dateTimeObject},targetduration:function(){!isFinite(e.duration)||e.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+e.duration}):this.manifest.targetDuration=e.duration},totalduration:function(){!isFinite(e.duration)||e.duration<0?this.trigger("warn",{message:"ignoring invalid total duration: "+e.duration}):this.manifest.totalDuration=e.duration},start:function(){e.attributes&&!isNaN(e.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:e.attributes["TIME-OFFSET"],precise:e.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out":function(){o.cueOut=e.data},"cue-out-cont":function(){o.cueOutCont=e.data},"cue-in":function(){o.cueIn=e.data}}[e.tagType]||l).call(a)},uri:function(){o.uri=e.uri,i.push(o),this.manifest.targetDuration&&!("duration"in o)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),o.duration=this.manifest.targetDuration),r&&(o.key=r),o.timeline=m,n&&(o.map=n),o={}},comment:function(){},custom:function(){e.segment?(o.custom=o.custom||{},o.custom[e.customType]=e.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[e.customType]=e.data)}})[e.type].call(a)})),t}i(t,e);var n=t.prototype;return n.push=function(e){this.lineStream.push(e)},n.end=function(){this.lineStream.push("\n")},n.addParser=function(e){this.parseStream.addParser(e)},n.addTagMapper=function(e){this.parseStream.addTagMapper(e)},t}(o)},"3Lai":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SegmentsMemoryStorage=function(){function e(t){_classCallCheck(this,e),this.settings=t,this.cache=new Map}var t,n,r,a,s,i;return _createClass(e,[{key:"storeSegment",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.cache.set(t.id,{segment:t,lastAccessed:performance.now()});case 1:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getSegmentsMap",value:(s=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.cache);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"getSegment",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(r=this.cache.get(t))){e.next=3;break}return e.abrupt("return",(r.lastAccessed=performance.now(),r.segment));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"hasSegment",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.cache.has(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"clean",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,s,i,o,u,l,d,c,g,m=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],a=[],s=performance.now(),i=_createForOfIteratorHelper(this.cache.values());try{for(i.s();!(o=i.n()).done;)u=o.value,s-u.lastAccessed>this.settings.cachedSegmentExpiration?r.push(u.segment.id):a.push(u)}catch(t){i.e(t)}finally{i.f()}if(!((l=a.length-this.settings.cachedSegmentsCount)>0)){e.next=23;break}a.sort((function(e,t){return e.lastAccessed-t.lastAccessed})),d=_createForOfIteratorHelper(a),e.prev=7,d.s();case 9:if((c=d.n()).done){e.next=15;break}if(g=c.value,void 0!==n&&n(g.segment.id)||(r.push(g.segment.id),0!=--l)){e.next=13;break}return e.abrupt("break",15);case 13:e.next=9;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(7),d.e(e.t0);case 20:return e.prev=20,d.f(),e.finish(20);case 23:return e.abrupt("return",(r.forEach((function(e){return m.cache.delete(e)})),r.length>0));case 24:case"end":return e.stop()}}),e,this,[[7,17,20,23]])}))),function(e,t){return n.apply(this,arguments)})},{key:"destroy",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.cache.clear();case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}()},"A+nu":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("+qE3");t.STEEmitter=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"on",value:function(e,t){return _get(_getPrototypeOf(n.prototype),"on",this).call(this,e,t)}},{key:"emit",value:function(e){for(var t,r=arguments.length,a=new Array(r>1?r-1:0),s=1;s<r;s++)a[s-1]=arguments[s];return(t=_get(_getPrototypeOf(n.prototype),"emit",this)).call.apply(t,[this,e].concat(a))}}]),n}(r.EventEmitter)},O885:function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.Events||(t.Events={})).SegmentLoaded="segment_loaded",r.SegmentError="segment_error",r.SegmentAbort="segment_abort",r.PeerConnect="peer_connect",r.PeerClose="peer_close",r.PieceBytesDownloaded="piece_bytes_downloaded",r.PieceBytesUploaded="piece_bytes_uploaded"},OKKN:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("+qE3"),a=n("uOj1"),s=n("iXDm"),i=n("yLkh"),o=n("b7KT");t.Engine=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=n.call(this)).loader=new a.HybridLoader(t.loader),e.segmentManager=new s.SegmentManager(e.loader,t.segments),Object.keys(a.Events).map((function(e){return a.Events[e]})).forEach((function(t){return e.loader.on(t,(function(){for(var n,r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(n=e).emit.apply(n,[t].concat(a))}))})),e}return _createClass(r,[{key:"createLoaderClass",value:function(){return o.createHlsJsLoaderClass(i.HlsJsLoader,this)}},{key:"destroy",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.segmentManager.destroy();case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSettings",value:function(){return{segments:this.segmentManager.getSettings(),loader:this.loader.getSettings()}}},{key:"getDetails",value:function(){return{loader:this.loader.getDetails()}}},{key:"setPlayingSegment",value:function(e,t,n,r){this.segmentManager.setPlayingSegment(e,t,n,r)}},{key:"setPlayingSegmentByCurrentTime",value:function(e){this.segmentManager.setPlayingSegmentByCurrentTime(e)}}],[{key:"isSupported",value:function(){return a.HybridLoader.isSupported()}}]),r}(r.EventEmitter)},R6j9:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a,s=n("NOtv"),i=n("A+nu"),o=n("tjlA");!function(e){e[e.SegmentData=0]="SegmentData",e[e.SegmentAbsent=1]="SegmentAbsent",e[e.SegmentsMap=2]="SegmentsMap",e[e.SegmentRequest=3]="SegmentRequest",e[e.CancelSegmentRequest=4]="CancelSegmentRequest"}(r||(r={})),function(e){e[e.Loaded=0]="Loaded",e[e.LoadingByHttp=1]="LoadingByHttp"}(a=t.MediaPeerSegmentStatus||(t.MediaPeerSegmentStatus={}));var u=function e(t,n){_classCallCheck(this,e),this.id=t,this.size=n,this.bytesDownloaded=0,this.pieces=[]};t.MediaPeer=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,a){var i;return _classCallCheck(this,n),(i=t.call(this)).peer=e,i.settings=a,i.remoteAddress="",i.downloadingSegmentId=null,i.downloadingSegment=null,i.segmentsMap=new Map,i.debug=s("p2pml:media-peer"),i.timer=null,i.onPeerConnect=function(){i.debug("peer connect",i.id,_assertThisInitialized(i)),i.remoteAddress=i.peer.remoteAddress,i.emit("connect",_assertThisInitialized(i))},i.onPeerClose=function(){i.debug("peer close",i.id,_assertThisInitialized(i)),i.terminateSegmentRequest(),i.emit("close",_assertThisInitialized(i))},i.onPeerError=function(e){i.debug("peer error",i.id,e,_assertThisInitialized(i))},i.onPeerData=function(e){var t=i.getJsonCommand(e);if(null!=t){if(i.downloadingSegment){i.debug("peer segment download is interrupted by a command",i.id,_assertThisInitialized(i));var n=i.downloadingSegment.id;return i.terminateSegmentRequest(),void i.emit("segment-error",_assertThisInitialized(i),n,"Segment download is interrupted by a command")}switch(i.debug("peer receive command",i.id,t,_assertThisInitialized(i)),t.c){case r.SegmentsMap:i.segmentsMap=i.createSegmentsMap(t.m),i.emit("data-updated");break;case r.SegmentRequest:i.emit("segment-request",_assertThisInitialized(i),t.i);break;case r.SegmentData:i.downloadingSegmentId===t.i&&(i.downloadingSegment=new u(t.i,t.s),i.cancelResponseTimeoutTimer());break;case r.SegmentAbsent:i.downloadingSegmentId===t.i&&(i.terminateSegmentRequest(),i.segmentsMap.delete(t.i),i.emit("segment-absent",_assertThisInitialized(i),t.i))}}else i.receiveSegmentPiece(e)},i.peer.on("connect",i.onPeerConnect),i.peer.on("close",i.onPeerClose),i.peer.on("error",i.onPeerError),i.peer.on("data",i.onPeerData),i.id=e.id,i}return _createClass(n,[{key:"receiveSegmentPiece",value:function(e){if(this.downloadingSegment){this.downloadingSegment.bytesDownloaded+=e.byteLength,this.downloadingSegment.pieces.push(e),this.emit("bytes-downloaded",this,e.byteLength);var t=this.downloadingSegment.id;if(this.downloadingSegment.bytesDownloaded==this.downloadingSegment.size){var n,r=new Uint8Array(this.downloadingSegment.size),a=0,s=_createForOfIteratorHelper(this.downloadingSegment.pieces);try{for(s.s();!(n=s.n()).done;){var i=n.value;r.set(new Uint8Array(i),a),a+=i.byteLength}}catch(o){s.e(o)}finally{s.f()}this.debug("peer segment download done",this.id,t,this),this.terminateSegmentRequest(),this.emit("segment-loaded",this,t,r.buffer)}else this.downloadingSegment.bytesDownloaded>this.downloadingSegment.size&&(this.debug("peer segment download bytes mismatch",this.id,t,this),this.terminateSegmentRequest(),this.emit("segment-error",this,t,"Too many bytes received for segment"))}else this.debug("peer segment not requested",this.id,this)}},{key:"getJsonCommand",value:function(e){var t=new Uint8Array(e);if(123==t[0]&&34==t[1]&&125==t[e.byteLength-1])try{return JSON.parse((new TextDecoder).decode(e))}catch(n){}return null}},{key:"createSegmentsMap",value:function(e){if(null==e||!(e instanceof Object))return new Map;for(var t=new Map,n=0,r=Object.keys(e);n<r.length;n++){var s=r[n],i=e[s];if(!(i instanceof Array&&2===i.length&&"string"==typeof i[0]&&i[1]instanceof Array))return new Map;var o=i[0].split("|"),u=i[1];if(o.length!==u.length)return new Map;for(var l=0;l<o.length;l++){var d=u[l];if("number"!=typeof d||void 0===a[d])return new Map;t.set("".concat(s,"+").concat(o[l]),d)}}return t}},{key:"sendCommand",value:function(e){this.debug("peer send command",this.id,e,this),this.peer.write(JSON.stringify(e))}},{key:"destroy",value:function(){this.debug("peer destroy",this.id,this),this.terminateSegmentRequest(),this.peer.destroy()}},{key:"getDownloadingSegmentId",value:function(){return this.downloadingSegmentId}},{key:"getSegmentsMap",value:function(){return this.segmentsMap}},{key:"sendSegmentsMap",value:function(e){this.sendCommand({c:r.SegmentsMap,m:e})}},{key:"sendSegmentData",value:function(e,t){this.sendCommand({c:r.SegmentData,i:e,s:t.byteLength});for(var n=t.byteLength;n>0;){var a=n>=this.settings.webRtcMaxMessageSize?this.settings.webRtcMaxMessageSize:n,s=o.Buffer.from(t,t.byteLength-n,a);this.peer.write(s),n-=a}this.emit("bytes-uploaded",this,t.byteLength)}},{key:"sendSegmentAbsent",value:function(e){this.sendCommand({c:r.SegmentAbsent,i:e})}},{key:"requestSegment",value:function(e){if(this.downloadingSegmentId)throw new Error("A segment is already downloading: "+this.downloadingSegmentId);this.sendCommand({c:r.SegmentRequest,i:e}),this.downloadingSegmentId=e,this.runResponseTimeoutTimer()}},{key:"cancelSegmentRequest",value:function(){var e;if(this.downloadingSegmentId){var t=this.downloadingSegmentId;e=this.downloadingSegment?this.downloadingSegment.pieces:void 0,this.terminateSegmentRequest(),this.sendCommand({c:r.CancelSegmentRequest,i:t})}return e}},{key:"runResponseTimeoutTimer",value:function(){var e=this;this.timer=setTimeout((function(){if(e.timer=null,e.downloadingSegmentId){var t=e.downloadingSegmentId;e.cancelSegmentRequest(),e.emit("segment-timeout",e,t)}}),this.settings.p2pSegmentDownloadTimeout)}},{key:"cancelResponseTimeoutTimer",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null)}},{key:"terminateSegmentRequest",value:function(){this.downloadingSegmentId=null,this.downloadingSegment=null,this.cancelResponseTimeoutTimer()}}]),n}(i.STEEmitter)},b7KT:function(e,t){e.exports.createHlsJsLoaderClass=function(e,t){function n(){this.impl=new e(t.segmentManager),this.stats=this.impl.stats}return n.prototype.load=function(e,t,n){this.context=e,this.impl.load(e,t,n)},n.prototype.abort=function(){this.impl.abort(this.context)},n.prototype.destroy=function(){this.context&&this.impl.abort(this.context)},n.getEngine=function(){return t},n}},fnjI:function(e,t,n){var r=n("P7XM"),a=n("tnIz"),s=n("hwdV").Buffer,i=[1518500249,1859775393,-1894007588,-899497514],o=new Array(80);function u(){this.init(),this._w=o,a.call(this,64,56)}function l(e){return e<<5|e>>>27}function d(e){return e<<30|e>>>2}function c(e,t,n,r){return 0===e?t&n|~t&r:2===e?t&n|t&r|n&r:t^n^r}r(u,a),u.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},u.prototype._update=function(e){for(var t,n=this._w,r=0|this._a,a=0|this._b,s=0|this._c,o=0|this._d,u=0|this._e,g=0;g<16;++g)n[g]=e.readInt32BE(4*g);for(;g<80;++g)n[g]=(t=n[g-3]^n[g-8]^n[g-14]^n[g-16])<<1|t>>>31;for(var m=0;m<80;++m){var h=~~(m/20),p=l(r)+c(h,a,s,o)+u+n[m]+i[h]|0;u=o,o=s,s=d(a),a=r,r=p}this._a=r+this._a|0,this._b=a+this._b|0,this._c=s+this._c|0,this._d=o+this._d|0,this._e=u+this._e|0},u.prototype._hash=function(){var e=s.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=u},iXDm:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("uOj1"),a=n("10ky"),s={forwardSegmentCount:20,swarmId:void 0,assetsStorage:void 0};t.SegmentManager=function(){function e(t){var n=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,e),this.masterPlaylist=null,this.variantPlaylists=new Map,this.segmentRequest=null,this.playQueue=[],this.onSegmentLoaded=function(e){n.segmentRequest&&n.segmentRequest.segmentUrl===e.url&&l(n.segmentRequest.segmentByterange)===e.range&&(n.segmentRequest.onSuccess(e.data.slice(0),e.downloadBandwidth),n.segmentRequest=null)},this.onSegmentError=function(e,t){n.segmentRequest&&n.segmentRequest.segmentUrl===e.url&&l(n.segmentRequest.segmentByterange)===e.range&&(n.segmentRequest.onError(t),n.segmentRequest=null)},this.onSegmentAbort=function(e){n.segmentRequest&&n.segmentRequest.segmentUrl===e.url&&l(n.segmentRequest.segmentByterange)===e.range&&(n.segmentRequest.onError("Loading aborted: internal abort"),n.segmentRequest=null)},this.settings=Object.assign(Object.assign({},s),a),this.loader=t,this.loader.on(r.Events.SegmentLoaded,this.onSegmentLoaded),this.loader.on(r.Events.SegmentError,this.onSegmentError),this.loader.on(r.Events.SegmentAbort,this.onSegmentAbort)}var t,n,d,c,g;return _createClass(e,[{key:"getSettings",value:function(){return this.settings}},{key:"processPlaylist",value:function(e,t,n){var r=new a.Parser;r.push(t),r.end();var s=new i(e,n,r.manifest);if(s.manifest.playlists){this.masterPlaylist=s;var o,u=_createForOfIteratorHelper(this.variantPlaylists);try{for(u.s();!(o=u.n()).done;){var l=_slicedToArray(o.value,2),d=l[0],c=l[1],g=this.getStreamSwarmId(c.requestUrl),m=g.streamSwarmId,h=g.found,p=g.index;h?(c.streamSwarmId=m,c.streamId="V"+p.toString()):this.variantPlaylists.delete(d)}}catch(b){u.e(b)}finally{u.f()}}else{var f=this.getStreamSwarmId(e),y=f.streamSwarmId,v=f.found,S=f.index;(v||null===this.masterPlaylist)&&(s.streamSwarmId=y,s.streamId=null===this.masterPlaylist?void 0:"V"+S.toString(),this.variantPlaylists.set(e,s),this.updateSegments())}}},{key:"loadPlaylist",value:(g=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(n=this.settings.assetsStorage)){e.next=16;break}return void 0===(a=this.getMasterSwarmId())&&(a=t.split("?")[0]),e.next=5,n.getAsset(t,void 0,a);case 5:if(void 0===(s=e.sent)){e.next=10;break}r={responseURL:s.responseUri,response:s.data},e.next=14;break;case 10:return e.next=12,this.loadContent(t,"text");case 12:r=e.sent,n.storeAsset({masterManifestUri:null!==this.masterPlaylist?this.masterPlaylist.requestUrl:t,masterSwarmId:a,requestUri:t,responseUri:r.responseURL,data:r.response});case 14:e.next=19;break;case 16:return e.next=18,this.loadContent(t,"text");case 18:r=e.sent;case 19:return e.abrupt("return",(this.processPlaylist(t,r.response,r.responseURL),r));case 20:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"loadSegment",value:(c=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,s,i,u,d,c,g,m,h,p=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.getSegmentLocation(t,n),a=l(n),r){e.next=23;break}if(void 0===(i=this.settings.assetsStorage)){e.next=17;break}if(d=null!==this.masterPlaylist?this.masterPlaylist.requestUrl:void 0,void 0===(u=this.getMasterSwarmId())&&1===this.variantPlaylists.size&&(u=this.variantPlaylists.values().next().value.requestUrl.split("?")[0]),void 0===d&&1===this.variantPlaylists.size&&(d=this.variantPlaylists.values().next().value.requestUrl),void 0===u||void 0===d){e.next=17;break}return e.next=8,i.getAsset(t,a,u);case 8:if(void 0===(c=e.sent)){e.next=13;break}s=c.data,e.next=17;break;case 13:return e.next=15,this.loadContent(t,"arraybuffer",a);case 15:g=e.sent,s=g.response,i.storeAsset({masterManifestUri:d,masterSwarmId:u,requestUri:t,requestRange:a,responseUri:g.responseURL,data:s});case 17:if(e.t0=void 0===s,!e.t0){e.next=22;break}return e.next=21,this.loadContent(t,"arraybuffer",a);case 21:s=e.sent.response;case 22:return e.abrupt("return",{content:s,downloadBandwidth:0});case 23:return m=(r.playlist.manifest.mediaSequence?r.playlist.manifest.mediaSequence:0)+r.segmentIndex,this.playQueue.length>0&&this.playQueue[this.playQueue.length-1].segmentSequence!==m-1&&(this.playQueue=[]),this.segmentRequest&&this.segmentRequest.onError("Cancel segment request: simultaneous segment requests are not supported"),h=new Promise((function(e,a){p.segmentRequest=new o(t,n,m,r.playlist.requestUrl,(function(t,n){return e({content:t,downloadBandwidth:n})}),(function(e){return a(e)}))})),e.abrupt("return",(this.playQueue.push({segmentUrl:t,segmentByterange:n,segmentSequence:m}),this.loadSegments(r.playlist,r.segmentIndex,!0),h));case 27:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"setPlayingSegment",value:function(e,t,n,r){var a=this.playQueue.findIndex((function(n){return n.segmentUrl==e&&u(n.segmentByterange,t)}));a>=0&&(this.playQueue=this.playQueue.slice(a),this.playQueue[0].playPosition={start:n,duration:r},this.updateSegments())}},{key:"setPlayingSegmentByCurrentTime",value:function(e){if(0!==this.playQueue.length&&this.playQueue[0].playPosition){var t=this.playQueue[0].playPosition;t.start+t.duration-e<.2&&(this.playQueue=this.playQueue.slice(1),this.updateSegments())}}},{key:"abortSegment",value:function(e,t){this.segmentRequest&&this.segmentRequest.segmentUrl===e&&u(this.segmentRequest.segmentByterange,t)&&(this.segmentRequest.onSuccess(void 0,0),this.segmentRequest=null)}},{key:"destroy",value:(d=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.segmentRequest&&(this.segmentRequest.onError("Loading aborted: object destroyed"),this.segmentRequest=null),this.masterPlaylist=null,this.variantPlaylists.clear(),this.playQueue=[],e.t0=void 0!==this.settings.assetsStorage,!e.t0){e.next=8;break}return e.next=8,this.settings.assetsStorage.destroy();case 8:return e.next=10,this.loader.destroy();case 10:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"updateSegments",value:function(){if(this.segmentRequest){var e=this.getSegmentLocation(this.segmentRequest.segmentUrl,this.segmentRequest.segmentByterange);e&&this.loadSegments(e.playlist,e.segmentIndex,!1)}}},{key:"getSegmentLocation",value:function(e,t){var n,r=_createForOfIteratorHelper(this.variantPlaylists.values());try{for(r.s();!(n=r.n()).done;){var a=n.value,s=a.getSegmentIndex(e,t);if(s>=0)return{playlist:a,segmentIndex:s}}}catch(i){r.e(i)}finally{r.f()}}},{key:"loadSegments",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var a,s,i,o,u,d,c,g,m,h,p,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=[],s=t.manifest.segments,i=t.manifest.mediaSequence?t.manifest.mediaSequence:0,o=null,u=Math.max(0,this.playQueue.length-1),d=this.getMasterSwarmId(),c=n;c<s.length&&a.length<this.settings.forwardSegmentCount;++c)g=t.manifest.segments[c],m=t.getSegmentAbsoluteUrl(g.uri),h=g.byterange,p=this.getSegmentId(t,i+c),a.push({id:p,url:m,masterSwarmId:void 0!==d?d:t.streamSwarmId,masterManifestUri:null!==this.masterPlaylist?this.masterPlaylist.requestUrl:t.requestUrl,streamId:t.streamId,sequence:(i+c).toString(),range:l(h),priority:u++}),r&&!o&&(o=p);if(this.loader.load(a,t.streamSwarmId),!o){e.next=9;break}return e.next=7,this.loader.getSegment(o);case 7:(f=e.sent)&&this.onSegmentLoaded(f);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"getSegmentId",value:function(e,t){return"".concat(e.streamSwarmId,"+").concat(t)}},{key:"getMasterSwarmId",value:function(){var e=this.settings.swarmId&&0!==this.settings.swarmId.length?this.settings.swarmId:void 0;return void 0!==e?e:null!==this.masterPlaylist?this.masterPlaylist.requestUrl.split("?")[0]:void 0}},{key:"getStreamSwarmId",value:function(e){var t=this.getMasterSwarmId();if(null!==this.masterPlaylist)for(var n=0;n<this.masterPlaylist.manifest.playlists.length;++n)if(new URL(this.masterPlaylist.manifest.playlists[n].uri,this.masterPlaylist.responseUrl).toString()===e)return{streamSwarmId:"".concat(t,"+V").concat(n),found:!0,index:n};return{streamSwarmId:void 0!==t?t:e.split("?")[0],found:!1,index:-1}}},{key:"loadContent",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,s){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType=n,r&&i.setRequestHeader("Range",r),i.addEventListener("readystatechange",(function(){4===i.readyState&&(i.status>=200&&i.status<300?e(i):s(i.statusText))}));var o=a.loader.getSettings().xhrSetup;o&&o(i,t),i.send()})));case 1:case"end":return e.stop()}}),e)}))),function(e,n,r){return t.apply(this,arguments)})}]),e}();var i=function(){function e(t,n,r){_classCallCheck(this,e),this.requestUrl=t,this.responseUrl=n,this.manifest=r,this.streamSwarmId=""}return _createClass(e,[{key:"getSegmentIndex",value:function(e,t){for(var n=0;n<this.manifest.segments.length;++n){var r=this.manifest.segments[n];if(e===this.getSegmentAbsoluteUrl(r.uri)&&u(r.byterange,t))return n}return-1}},{key:"getSegmentAbsoluteUrl",value:function(e){return new URL(e,this.responseUrl).toString()}}]),e}(),o=function e(t,n,r,a,s,i){_classCallCheck(this,e),this.segmentUrl=t,this.segmentByterange=n,this.segmentSequence=r,this.playlistRequestUrl=a,this.onSuccess=s,this.onError=i};function u(e,t){return void 0===e?void 0===t:void 0!==t&&e.length===t.length&&e.offset===t.offset}function l(e){if(void 0!==e)return"bytes=".concat(e.offset,"-").concat(e.offset+e.length-1)}},lcUr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("NOtv"),a=n("O885"),s=n("+qE3"),i=n("0ovO"),o=n("n5Qj"),u=n("R6j9"),l=n("xzjP"),d=n("3Lai"),c=n("3oOE"),g={cachedSegmentExpiration:3e5,cachedSegmentsCount:30,useP2P:!0,consumeOnly:!1,requiredSegmentsPriority:1,simultaneousHttpDownloads:2,httpDownloadProbability:.1,httpDownloadProbabilityInterval:1e3,httpDownloadProbabilitySkipIfNoPeers:!1,httpFailedSegmentTimeout:1e4,httpDownloadMaxPriority:20,httpDownloadInitialTimeout:0,httpDownloadInitialTimeoutPerSegment:4e3,httpUseRanges:!1,simultaneousP2PDownloads:3,p2pDownloadMaxPriority:20,p2pSegmentDownloadTimeout:6e4,webRtcMaxMessageSize:65535,trackerAnnounce:["wss://tracker.novage.com.ua","wss://tracker.openwebtorrent.com"],peerRequestsPerAnnounce:10,rtcConfig:n("BRrH").config};t.HybridLoader=function(e){_inherits(p,e);var t,n,s,m,h=_createSuper(p);function p(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,p),(e=h.call(this)).debug=r("p2pml:hybrid-loader"),e.debugSegments=r("p2pml:hybrid-loader-segments"),e.segmentsQueue=[],e.bandwidthApproximator=new l.BandwidthApproximator,e.httpDownloadInitialTimeoutTimestamp=-1/0,e.processInitialSegmentTimeout=_asyncToGenerator(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===e.httpRandomDownloadInterval){t.next=7;break}if(void 0===e.masterSwarmId){t.next=6;break}return t.next=4,e.segmentsStorage.getSegmentsMap(e.masterSwarmId);case 4:n=t.sent,e.processSegmentsQueue(n)&&!e.settings.consumeOnly&&e.p2pManager.sendSegmentsMapToAll(e.createSegmentsMap(n));case 6:e.httpDownloadInitialTimeoutTimestamp!==-1/0&&setTimeout(e.processInitialSegmentTimeout,e.settings.httpDownloadInitialTimeoutPerSegment);case 7:case"end":return t.stop()}}),t)}))),e.downloadRandomSegmentOverHttp=_asyncToGenerator(regeneratorRuntime.mark((function t(){var n,r,a,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(void 0===e.masterSwarmId||void 0===e.httpRandomDownloadInterval||e.httpDownloadInitialTimeoutTimestamp!==-1/0||e.httpManager.getActiveDownloadsCount()>=e.settings.simultaneousHttpDownloads||e.settings.httpDownloadProbabilitySkipIfNoPeers&&0===e.p2pManager.getPeers().size||e.settings.consumeOnly)){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.segmentsStorage.getSegmentsMap(e.masterSwarmId);case 4:if(n=t.sent,r=e.p2pManager.getOvrallSegmentsMap(),0!=(a=e.segmentsQueue.filter((function(t){return!e.p2pManager.isDownloading(t)&&!e.httpManager.isDownloading(t)&&!r.has(t.id)&&!e.httpManager.isFailed(t)&&t.priority<=e.settings.httpDownloadMaxPriority&&!n.has(t.id)}))).length){t.next=9;break}return t.abrupt("return");case 9:if(!(Math.random()>e.settings.httpDownloadProbability*a.length)){t.next=11;break}return t.abrupt("return");case 11:s=a[Math.floor(Math.random()*a.length)],e.debugSegments("HTTP download (random)",s.priority,s.url),e.httpManager.download(s),e.p2pManager.sendSegmentsMapToAll(e.createSegmentsMap(n));case 13:case"end":return t.stop()}}),t)}))),e.onPieceBytesDownloaded=function(t,n,r){e.bandwidthApproximator.addBytes(n,e.now()),e.emit(a.Events.PieceBytesDownloaded,t,n,r)},e.onPieceBytesUploaded=function(t,n,r){e.emit(a.Events.PieceBytesUploaded,t,n,r)},e.onSegmentLoaded=function(){var t=_asyncToGenerator(regeneratorRuntime.mark((function t(n,r,s){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.debugSegments("segment loaded",n.id,n.url),void 0!==e.masterSwarmId){t.next=2;break}return t.abrupt("return");case 2:return n.data=r,n.downloadBandwidth=e.bandwidthApproximator.getBandwidth(e.now()),t.next=6,e.segmentsStorage.storeSegment(n);case 6:if(e.emit(a.Events.SegmentLoaded,n,s),void 0!==i){t.next=13;break}return t.next=10,e.segmentsStorage.getSegmentsMap(e.masterSwarmId);case 10:t.t0=t.sent,t.next=14;break;case 13:t.t0=i;case 14:i=t.t0,e.processSegmentsQueue(i),e.settings.consumeOnly||e.p2pManager.sendSegmentsMapToAll(e.createSegmentsMap(i));case 17:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),e.onSegmentError=function(){var t=_asyncToGenerator(regeneratorRuntime.mark((function t(n,r,s){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.debugSegments("segment error",n.id,n.url,s,r),e.emit(a.Events.SegmentError,n,r,s),void 0===e.masterSwarmId){t.next=5;break}return t.next=3,e.segmentsStorage.getSegmentsMap(e.masterSwarmId);case 3:i=t.sent,e.processSegmentsQueue(i)&&!e.settings.consumeOnly&&e.p2pManager.sendSegmentsMapToAll(e.createSegmentsMap(i));case 5:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),e.onPeerConnect=function(){var t=_asyncToGenerator(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.emit(a.Events.PeerConnect,n),t.t0=e.settings.consumeOnly||void 0===e.masterSwarmId,t.t0){t.next=11;break}return t.t1=e.p2pManager,t.t2=n.id,t.t3=e,t.next=8,e.segmentsStorage.getSegmentsMap(e.masterSwarmId);case 8:t.t4=t.sent,t.t5=t.t3.createSegmentsMap.call(t.t3,t.t4),t.t1.sendSegmentsMap.call(t.t1,t.t2,t.t5);case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.onPeerClose=function(t){e.emit(a.Events.PeerClose,t)},e.onTrackerUpdate=function(){var t=_asyncToGenerator(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.httpDownloadInitialTimeoutTimestamp!==-1/0&&void 0!==n.incomplete&&n.incomplete<=1&&(e.debugSegments("cancel initial HTTP download timeout - no peers"),e.httpDownloadInitialTimeoutTimestamp=-1/0,void 0!==e.masterSwarmId))){t.next=5;break}return t.next=3,e.segmentsStorage.getSegmentsMap(e.masterSwarmId);case 3:r=t.sent,e.processSegmentsQueue(r)&&!e.settings.consumeOnly&&e.p2pManager.sendSegmentsMapToAll(e.createSegmentsMap(r));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.settings=Object.assign(Object.assign({},g),t),t.bufferedSegmentsCount&&(void 0===t.p2pDownloadMaxPriority&&(e.settings.p2pDownloadMaxPriority=t.bufferedSegmentsCount),void 0===t.httpDownloadMaxPriority&&(e.settings.p2pDownloadMaxPriority=t.bufferedSegmentsCount),delete e.settings.bufferedSegmentsCount),e.segmentsStorage=void 0===e.settings.segmentsStorage?new d.SegmentsMemoryStorage(e.settings):e.settings.segmentsStorage,e.debug("loader settings",e.settings),e.httpManager=e.createHttpManager(),e.httpManager.on("segment-loaded",e.onSegmentLoaded),e.httpManager.on("segment-error",e.onSegmentError),e.httpManager.on("bytes-downloaded",(function(t){return e.onPieceBytesDownloaded("http",t)})),e.p2pManager=e.createP2PManager(),e.p2pManager.on("segment-loaded",e.onSegmentLoaded),e.p2pManager.on("segment-error",e.onSegmentError),e.p2pManager.on("peer-data-updated",_asyncToGenerator(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==e.masterSwarmId){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.segmentsStorage.getSegmentsMap(e.masterSwarmId);case 4:n=t.sent,e.processSegmentsQueue(n)&&!e.settings.consumeOnly&&e.p2pManager.sendSegmentsMapToAll(e.createSegmentsMap(n));case 6:case"end":return t.stop()}}),t)})))),e.p2pManager.on("bytes-downloaded",(function(t,n){return e.onPieceBytesDownloaded("p2p",t,n)})),e.p2pManager.on("bytes-uploaded",(function(t,n){return e.onPieceBytesUploaded("p2p",t,n)})),e.p2pManager.on("peer-connected",e.onPeerConnect),e.p2pManager.on("peer-closed",e.onPeerClose),e.p2pManager.on("tracker-update",e.onTrackerUpdate),e}return _createClass(p,[{key:"createHttpManager",value:function(){return new i.HttpMediaManager(this.settings)}},{key:"createP2PManager",value:function(){return new o.P2PMediaManager(this.segmentsStorage,this.settings)}},{key:"load",value:(m=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,s,i,o,u,l,d,c,g=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:void 0===this.httpRandomDownloadInterval&&(this.httpRandomDownloadInterval=setInterval(this.downloadRandomSegmentOverHttp,this.settings.httpDownloadProbabilityInterval),this.settings.httpDownloadInitialTimeout>0&&this.settings.httpDownloadInitialTimeoutPerSegment>0&&(this.debugSegments("enable initial HTTP download timeout",this.settings.httpDownloadInitialTimeout,"per segment",this.settings.httpDownloadInitialTimeoutPerSegment),this.httpDownloadInitialTimeoutTimestamp=this.now(),setTimeout(this.processInitialSegmentTimeout,this.settings.httpDownloadInitialTimeoutPerSegment+100))),t.length>0&&(this.masterSwarmId=t[0].masterSwarmId),void 0!==this.masterSwarmId&&this.p2pManager.setStreamSwarmId(n,this.masterSwarmId),this.debug("load segments"),r=!1,s=_createForOfIteratorHelper(this.segmentsQueue);try{for(o=function(){var e=i.value;t.find((function(t){return t.url==e.url}))||(g.debug("remove segment",e.url),g.httpManager.isDownloading(e)?(r=!0,g.httpManager.abort(e)):g.p2pManager.abort(e),g.emit(a.Events.SegmentAbort,e))},s.s();!(i=s.n()).done;)o()}catch(m){s.e(m)}finally{s.f()}if(this.debug.enabled){u=_createForOfIteratorHelper(t);try{for(d=function(){var e=l.value;g.segmentsQueue.find((function(t){return t.url==e.url}))||g.debug("add segment",e.url)},u.s();!(l=u.n()).done;)d()}catch(m){u.e(m)}finally{u.f()}}if(this.segmentsQueue=t,void 0!==this.masterSwarmId){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this.segmentsStorage.getSegmentsMap(this.masterSwarmId);case 9:return c=e.sent,r=this.processSegmentsQueue(c)||r,e.next=13,this.cleanSegmentsStorage();case 13:if(e.t0=e.sent,!e.t0){e.next=19;break}return e.next=17,this.segmentsStorage.getSegmentsMap(this.masterSwarmId);case 17:c=e.sent,r=!0;case 19:r&&!this.settings.consumeOnly&&this.p2pManager.sendSegmentsMapToAll(this.createSegmentsMap(c));case 20:case"end":return e.stop()}}),e,this)}))),function(e,t){return m.apply(this,arguments)})},{key:"getSegment",value:(s=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",void 0===this.masterSwarmId?void 0:this.segmentsStorage.getSegment(t,this.masterSwarmId));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"getSettings",value:function(){return this.settings}},{key:"getDetails",value:function(){return{peerId:this.p2pManager.getPeerId()}}},{key:"destroy",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0!==this.httpRandomDownloadInterval&&(clearInterval(this.httpRandomDownloadInterval),this.httpRandomDownloadInterval=void 0),this.httpDownloadInitialTimeoutTimestamp=-1/0,this.segmentsQueue=[],this.httpManager.destroy(),this.p2pManager.destroy(),this.masterSwarmId=void 0,e.next=8,this.segmentsStorage.destroy();case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"processSegmentsQueue",value:function(e){if(this.debugSegments("process segments queue. priority",this.segmentsQueue.length>0?this.segmentsQueue[0].priority:0),void 0===this.masterSwarmId||0===this.segmentsQueue.length)return!1;var t,n=!1,r=!0;if(this.httpDownloadInitialTimeoutTimestamp!==-1/0){var a,s,i=_createForOfIteratorHelper(this.segmentsQueue);try{for(i.s();!(s=i.n()).done;){var o=s.value;if(!e.has(o.id)){a=o.priority;break}}}catch(y){i.e(y)}finally{i.f()}var l=this.now()-this.httpDownloadInitialTimeoutTimestamp;(r=l>=this.settings.httpDownloadInitialTimeout||void 0!==a&&l>this.settings.httpDownloadInitialTimeoutPerSegment&&a<=0)&&(this.debugSegments("cancel initial HTTP download timeout - timed out"),this.httpDownloadInitialTimeoutTimestamp=-1/0)}for(var d=0;d<this.segmentsQueue.length;d++){var c=this.segmentsQueue[d];if(!e.has(c.id)&&!this.httpManager.isDownloading(c)){if(c.priority<=this.settings.requiredSegmentsPriority&&r&&!this.httpManager.isFailed(c)){if(this.httpManager.getActiveDownloadsCount()>=this.settings.simultaneousHttpDownloads)for(var g=this.segmentsQueue.length-1;g>d;g--){var m=this.segmentsQueue[g];if(this.httpManager.isDownloading(m)){this.debugSegments("cancel HTTP download",m.priority,m.url),this.httpManager.abort(m);break}}if(this.httpManager.getActiveDownloadsCount()<this.settings.simultaneousHttpDownloads){var h=this.p2pManager.abort(c);this.httpManager.download(c,h),this.debugSegments("HTTP download (priority)",c.priority,c.url),n=!0;continue}}if(!this.p2pManager.isDownloading(c))if(c.priority<=this.settings.requiredSegmentsPriority){if((t=t||this.p2pManager.getOvrallSegmentsMap()).get(c.id)!==u.MediaPeerSegmentStatus.Loaded)continue;if(this.p2pManager.getActiveDownloadsCount()>=this.settings.simultaneousP2PDownloads)for(var p=this.segmentsQueue.length-1;p>d;p--){var f=this.segmentsQueue[p];if(this.p2pManager.isDownloading(f)){this.debugSegments("cancel P2P download",f.priority,f.url),this.p2pManager.abort(f);break}}if(this.p2pManager.getActiveDownloadsCount()<this.settings.simultaneousP2PDownloads&&this.p2pManager.download(c)){this.debugSegments("P2P download (priority)",c.priority,c.url);continue}}else this.p2pManager.getActiveDownloadsCount()<this.settings.simultaneousP2PDownloads&&c.priority<=this.settings.p2pDownloadMaxPriority&&this.p2pManager.download(c)&&this.debugSegments("P2P download",c.priority,c.url)}}return n}},{key:"getStreamSwarmId",value:function(e){return void 0===e.streamId?e.masterSwarmId:"".concat(e.masterSwarmId,"+").concat(e.streamId)}},{key:"createSegmentsMap",value:function(e){var t,n=this,r={},a=function(e,t){var a=n.getStreamSwarmId(e),s=e.sequence,i=r[a];void 0===i&&(i=["",[]],r[a]=i);var o=i[1];i[0]+=0==o.length?s:"|"+s,o.push(t)},s=_createForOfIteratorHelper(e.values());try{for(s.s();!(t=s.n()).done;){a(t.value.segment,u.MediaPeerSegmentStatus.Loaded)}}catch(l){s.e(l)}finally{s.f()}var i,o=_createForOfIteratorHelper(this.httpManager.getActiveDownloads().values());try{for(o.s();!(i=o.n()).done;){a(i.value.segment,u.MediaPeerSegmentStatus.LoadingByHttp)}}catch(l){o.e(l)}finally{o.f()}return r}},{key:"cleanSegmentsStorage",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",void 0!==this.masterSwarmId&&this.segmentsStorage.clean(this.masterSwarmId,(function(e){return void 0!==t.segmentsQueue.find((function(t){return t.id===e}))})));case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"now",value:function(){return performance.now()}}],[{key:"isSupported",value:function(){var e=c();return e&&void 0!==e.RTCPeerConnection.prototype.createDataChannel}}]),p}(s.EventEmitter)},n5Qj:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("NOtv"),a=n("J6t0"),s=n("A+nu"),i=n("R6j9"),o=n("tjlA"),u=n("fnjI"),l="-WW".concat(n("uOj1").version.replace(/\d*./g,(function(e){return("0"+parseInt(e,10)%100).slice(-2)})).slice(0,4),"-"),d=function e(t,n){_classCallCheck(this,e),this.peerId=t,this.segment=n};t.P2PMediaManager=function(e){_inherits(s,e);var t,n=_createSuper(s);function s(e,t){var a;return _classCallCheck(this,s),(a=n.call(this)).sementsStorage=e,a.settings=t,a.trackerClient=null,a.peers=new Map,a.peerCandidates=new Map,a.peerSegmentRequests=new Map,a.streamSwarmId=null,a.debug=r("p2pml:p2p-media-manager"),a.pendingTrackerClient=null,a.onTrackerError=function(e){a.debug("tracker error",e)},a.onTrackerWarning=function(e){a.debug("tracker warning",e)},a.onTrackerUpdate=function(e){a.debug("tracker update",e),a.emit("tracker-update",e)},a.onTrackerPeer=function(e){if(a.debug("tracker peer",e.id,e),a.peers.has(e.id))return a.debug("tracker peer already connected",e.id,e),void e.destroy();var t=new i.MediaPeer(e,a.settings);t.on("connect",a.onPeerConnect),t.on("close",a.onPeerClose),t.on("data-updated",a.onPeerDataUpdated),t.on("segment-request",a.onSegmentRequest),t.on("segment-loaded",a.onSegmentLoaded),t.on("segment-absent",a.onSegmentAbsent),t.on("segment-error",a.onSegmentError),t.on("segment-timeout",a.onSegmentTimeout),t.on("bytes-downloaded",a.onPieceBytesDownloaded),t.on("bytes-uploaded",a.onPieceBytesUploaded);var n=a.peerCandidates.get(t.id);n||(n=[],a.peerCandidates.set(t.id,n)),n.push(t)},a.onPieceBytesDownloaded=function(e,t){a.emit("bytes-downloaded",t,e.id)},a.onPieceBytesUploaded=function(e,t){a.emit("bytes-uploaded",t,e.id)},a.onPeerConnect=function(e){if(a.peers.get(e.id))return a.debug("tracker peer already connected (in peer connect)",e.id,e),void e.destroy();a.peers.set(e.id,e);var t=a.peerCandidates.get(e.id);if(t){var n,r=_createForOfIteratorHelper(t);try{for(r.s();!(n=r.n()).done;){var s=n.value;s!=e&&s.destroy()}}catch(i){r.e(i)}finally{r.f()}a.peerCandidates.delete(e.id)}a.emit("peer-connected",{id:e.id,remoteAddress:e.remoteAddress})},a.onPeerClose=function(e){if(a.peers.get(e.id)!=e){var t=a.peerCandidates.get(e.id);if(!t)return;var n=t.indexOf(e);return-1!=n&&t.splice(n,1),void(0==t.length&&a.peerCandidates.delete(e.id))}var r,s=_createForOfIteratorHelper(a.peerSegmentRequests);try{for(s.s();!(r=s.n()).done;){var i=_slicedToArray(r.value,2),o=i[0];i[1].peerId==e.id&&a.peerSegmentRequests.delete(o)}}catch(u){s.e(u)}finally{s.f()}a.peers.delete(e.id),a.emit("peer-data-updated"),a.emit("peer-closed",e.id)},a.onPeerDataUpdated=function(){a.emit("peer-data-updated")},a.onSegmentRequest=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==a.masterSwarmId){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,a.sementsStorage.getSegment(n,a.masterSwarmId);case 4:(r=e.sent)?t.sendSegmentData(n,r.data):t.sendSegmentAbsent(n);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),a.onSegmentLoaded=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var s,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=a.peerSegmentRequests.get(n)){e.next=3;break}return e.abrupt("return");case 3:if(i=s.segment,!a.settings.segmentValidator){e.next=13;break}return e.prev=5,e.next=8,a.settings.segmentValidator(Object.assign(Object.assign({},i),{data:r}),"p2p",t.id);case 8:e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(5),e.abrupt("return",(a.debug("segment validator failed",e.t0),a.peerSegmentRequests.delete(n),a.emit("segment-error",i,e.t0,t.id),void a.onPeerClose(t)));case 13:a.peerSegmentRequests.delete(n),a.emit("segment-loaded",i,r,t.id);case 14:case"end":return e.stop()}}),e,null,[[5,10]])})));return function(t,n,r){return e.apply(this,arguments)}}(),a.onSegmentAbsent=function(e,t){a.peerSegmentRequests.delete(t),a.emit("peer-data-updated")},a.onSegmentError=function(e,t,n){var r=a.peerSegmentRequests.get(t);r&&(a.peerSegmentRequests.delete(t),a.emit("segment-error",r.segment,n,e.id))},a.onSegmentTimeout=function(e,t){var n=a.peerSegmentRequests.get(t);n&&(a.peerSegmentRequests.delete(t),e.destroy(),a.peers.delete(n.peerId)&&a.emit("peer-data-updated"))},a.peerId=t.useP2P?function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=l,n=0;n<20-l.length;n++)t+=e.charAt(Math.floor(Math.random()*e.length));return(new TextEncoder).encode(t).buffer}():new ArrayBuffer(0),a.debug.enabled&&a.debug("peer ID",a.getPeerId(),(new TextDecoder).decode(a.peerId)),a}return _createClass(s,[{key:"getPeers",value:function(){return this.peers}},{key:"getPeerId",value:function(){return o.Buffer.from(this.peerId).toString("hex")}},{key:"setStreamSwarmId",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.streamSwarmId!==t){e.next=2;break}return e.abrupt("return");case 2:this.destroy(!0),this.streamSwarmId=t,this.masterSwarmId=n,this.debug("stream swarm ID",this.streamSwarmId),this.pendingTrackerClient={isDestroyed:!1},r=this.pendingTrackerClient,a=(new u).update(2+this.streamSwarmId).digest(),r.isDestroyed?null!=this.trackerClient&&(this.trackerClient.destroy(),this.trackerClient=null):(this.pendingTrackerClient=null,this.createClient(a));case 5:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"createClient",value:function(e){var t=this;if(this.settings.useP2P){var n={infoHash:o.Buffer.from(e,0,20),peerId:o.Buffer.from(this.peerId,0,20),announce:this.settings.trackerAnnounce,rtcConfig:this.settings.rtcConfig,port:6881,getAnnounceOpts:function(){return{numwant:t.settings.peerRequestsPerAnnounce}}},r=this.trackerClient;this.trackerClient=new a(n),this.trackerClient.on("error",this.onTrackerError),this.trackerClient.on("warning",this.onTrackerWarning),this.trackerClient.on("update",this.onTrackerUpdate),this.trackerClient.on("peer",this.onTrackerPeer),this.trackerClient.start(),null!=r&&(r.destroy(),r=null)}}},{key:"download",value:function(e){if(this.isDownloading(e))return!1;var t,n=[],r=_createForOfIteratorHelper(this.peers.values());try{for(r.s();!(t=r.n()).done;){var a=t.value;null==a.getDownloadingSegmentId()&&a.getSegmentsMap().get(e.id)===i.MediaPeerSegmentStatus.Loaded&&n.push(a)}}catch(o){r.e(o)}finally{r.f()}if(0===n.length)return!1;var s=n[Math.floor(Math.random()*n.length)];return s.requestSegment(e.id),this.peerSegmentRequests.set(e.id,new d(s.id,e)),!0}},{key:"abort",value:function(e){var t,n=this.peerSegmentRequests.get(e.id);if(n){var r=this.peers.get(n.peerId);r&&(t=r.cancelSegmentRequest()),this.peerSegmentRequests.delete(e.id)}return t}},{key:"isDownloading",value:function(e){return this.peerSegmentRequests.has(e.id)}},{key:"getActiveDownloadsCount",value:function(){return this.peerSegmentRequests.size}},{key:"destroy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.streamSwarmId=null,this.trackerClient&&(this.trackerClient.stop(),e?(this.trackerClient.removeAllListeners("error"),this.trackerClient.removeAllListeners("warning"),this.trackerClient.removeAllListeners("update"),this.trackerClient.removeAllListeners("peer")):(this.trackerClient.destroy(),this.trackerClient=null)),this.pendingTrackerClient&&(this.pendingTrackerClient.isDestroyed=!0,this.pendingTrackerClient=null),this.peers.forEach((function(e){return e.destroy()})),this.peers.clear(),this.peerSegmentRequests.clear();var t,n=_createForOfIteratorHelper(this.peerCandidates.values());try{for(n.s();!(t=n.n()).done;){var r,a=t.value,s=_createForOfIteratorHelper(a);try{for(s.s();!(r=s.n()).done;){var i=r.value;i.destroy()}}catch(o){s.e(o)}finally{s.f()}}}catch(o){n.e(o)}finally{n.f()}this.peerCandidates.clear()}},{key:"sendSegmentsMapToAll",value:function(e){this.peers.forEach((function(t){return t.sendSegmentsMap(e)}))}},{key:"sendSegmentsMap",value:function(e,t){var n=this.peers.get(e);n&&n.sendSegmentsMap(t)}},{key:"getOvrallSegmentsMap",value:function(){var e,t=new Map,n=_createForOfIteratorHelper(this.peers.values());try{for(n.s();!(e=n.n()).done;){var r,a=_createForOfIteratorHelper(e.value.getSegmentsMap());try{for(a.s();!(r=a.n()).done;){var s=_slicedToArray(r.value,2),o=s[0];s[1]===i.MediaPeerSegmentStatus.Loaded?t.set(o,i.MediaPeerSegmentStatus.Loaded):t.get(o)||t.set(o,i.MediaPeerSegmentStatus.LoadingByHttp)}}catch(u){a.e(u)}finally{a.f()}}}catch(u){n.e(u)}finally{n.f()}return t}}]),s}(s.STEEmitter)},tlK4:function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}function a(e){e&&e.config&&e.config.loader&&"function"==typeof e.config.loader.getEngine&&s(e,e.config.loader.getEngine())}function s(e,t){e.on("hlsFragChanged",(function(e,n){var r=n.frag;t.setPlayingSegment(r.url,2!==r.byteRange.length?void 0:{offset:r.byteRange[0],length:r.byteRange[1]-r.byteRange[0]},r.start,r.duration)})),e.on("hlsDestroying",_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.destroy();case 2:case"end":return e.stop()}}),e)})))),e.on("hlsError",(function(n,r){if("bufferStalledError"===r.details){var a=void 0===e.media?e.el_:e.media;if(void 0===a)return;t.setPlayingSegmentByCurrentTime(a.currentTime)}}))}Object.defineProperty(t,"__esModule",{value:!0}),t.version="0.6.2",r(n("OKKN")),r(n("iXDm")),t.initHlsJsPlayer=a,t.initClapprPlayer=function(e){e.on("play",(function(){var t=e.core.getCurrentPlayback();t._hls&&!t._hls._p2pm_linitialized&&(t._hls._p2pm_linitialized=!0,a(e.core.getCurrentPlayback()._hls))}))},t.initFlowplayerHlsJsPlayer=function(e){e.on("ready",(function(){return a(e.engine.hlsjs?e.engine.hlsjs:e.engine.hls)}))},t.initVideoJsContribHlsJsPlayer=function(e){e.ready((function(){var t=e.tech_.options_;t&&t.hlsjsConfig&&t.hlsjsConfig.loader&&"function"==typeof t.hlsjsConfig.loader.getEngine&&s(e.tech_,t.hlsjsConfig.loader.getEngine())}))},t.initVideoJsHlsJsPlugin=function(){null!=videojs&&null!=videojs.Html5Hlsjs&&videojs.Html5Hlsjs.addHook("beforeinitialize",(function(e,t){t.config&&t.config.loader&&"function"==typeof t.config.loader.getEngine&&s(t,t.config.loader.getEngine())}))},t.initMediaElementJsPlayer=function(e){e.addEventListener("hlsFragChanged",(function(t){var n=e.hlsPlayer;if(n&&n.config&&n.config.loader&&"function"==typeof n.config.loader.getEngine){var r=n.config.loader.getEngine();if(t.data&&t.data.length>1){var a=t.data[1].frag;r.setPlayingSegment(a.url,2!==a.byteRange.length?void 0:{offset:a.byteRange[0],length:a.byteRange[1]-a.byteRange[0]},a.start,a.duration)}}})),e.addEventListener("hlsDestroying",_asyncToGenerator(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!((n=e.hlsPlayer)&&n.config&&n.config.loader&&"function"==typeof n.config.loader.getEngine)){t.next=5;break}return r=n.config.loader.getEngine(),t.next=5,r.destroy();case 5:case"end":return t.stop()}}),t)})))),e.addEventListener("hlsError",(function(t){var n=e.hlsPlayer;n&&n.config&&n.config.loader&&"function"==typeof n.config.loader.getEngine&&void 0!==t.data&&"bufferStalledError"===t.data.details&&n.config.loader.getEngine().setPlayingSegmentByCurrentTime(n.media.currentTime)}))},t.initJwPlayer=function(e,t){var n=setInterval((function(){e.hls&&e.hls.config&&(clearInterval(n),Object.assign(e.hls.config,t),a(e.hls))}),200)}},tnIz:function(e,t,n){var r=n("hwdV").Buffer;function a(e,t){this._block=r.alloc(e),this._finalSize=t,this._blockSize=e,this._len=0}a.prototype.update=function(e,t){"string"==typeof e&&(e=r.from(e,t=t||"utf8"));for(var n=this._block,a=this._blockSize,s=e.length,i=this._len,o=0;o<s;){for(var u=i%a,l=Math.min(s-o,a-u),d=0;d<l;d++)n[u+d]=e[o+d];o+=l,(i+=l)%a==0&&this._update(n)}return this._len+=s,this},a.prototype.digest=function(e){var t=this._len%this._blockSize;this._block[t]=128,this._block.fill(0,t+1),t>=this._finalSize&&(this._update(this._block),this._block.fill(0));var n=8*this._len;if(n<=4294967295)this._block.writeUInt32BE(n,this._blockSize-4);else{var r=(4294967295&n)>>>0;this._block.writeUInt32BE((n-r)/4294967296,this._blockSize-8),this._block.writeUInt32BE(r,this._blockSize-4)}this._update(this._block);var a=this._hash();return e?a.toString(e):a},a.prototype._update=function(){throw new Error("_update must be implemented by subclass")},e.exports=a},uOj1:function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),t.version="0.6.2",r(n("O885")),r(n("lcUr"))},xzjP:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function e(t,n){_classCallCheck(this,e),this.value=t,this.timeStamp=n};t.BandwidthApproximator=function(){function e(){_classCallCheck(this,e),this.lastBytes=[],this.currentBytesSum=0,this.lastBandwidth=[]}return _createClass(e,[{key:"addBytes",value:function(e,t){for(this.lastBytes.push(new r(e,t)),this.currentBytesSum+=e;t-this.lastBytes[0].timeStamp>1e3;)this.currentBytesSum-=this.lastBytes.shift().value;this.lastBandwidth.push(new r(this.currentBytesSum/1e3,t))}},{key:"getBandwidth",value:function(e){for(;0!=this.lastBandwidth.length&&e-this.lastBandwidth[0].timeStamp>6e4;)this.lastBandwidth.shift();var t,n=0,r=_createForOfIteratorHelper(this.lastBandwidth);try{for(r.s();!(t=r.n()).done;){var a=t.value;a.value>n&&(n=a.value)}}catch(s){r.e(s)}finally{r.f()}return n}},{key:"getSmoothInterval",value:function(){return 1e3}},{key:"getMeasureInterval",value:function(){return 6e4}}]),e}()},yLkh:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HlsJsLoader=function(){function e(t){_classCallCheck(this,e),this.stats={},this.segmentManager=t}var t;return _createClass(e,[{key:"load",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var a,s,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.type){e.next=13;break}return e.prev=1,e.next=4,this.segmentManager.loadPlaylist(t.url);case 4:a=e.sent,this.successPlaylist(a,t,r),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),this.error(e.t0,t,r);case 11:e.next=27;break;case 13:if(!t.frag){e.next=26;break}return e.prev=14,e.next=17,this.segmentManager.loadSegment(t.url,null==t.rangeStart||null==t.rangeEnd?void 0:{offset:t.rangeStart,length:t.rangeEnd-t.rangeStart});case 17:void 0!==(s=e.sent).content&&setTimeout((function(){return i.successSegment(s.content,s.downloadBandwidth,t,r)}),0),e.next=24;break;case 21:e.prev=21,e.t1=e.catch(14),setTimeout((function(){return i.error(e.t1,t,r)}),0);case 24:e.next=27;break;case 26:console.warn("Unknown load request",t);case 27:case"end":return e.stop()}}),e,this,[[1,8],[14,21]])}))),function(e,n,r){return t.apply(this,arguments)})},{key:"abort",value:function(e){this.segmentManager.abortSegment(e.url,null==e.rangeStart||null==e.rangeEnd?void 0:{offset:e.rangeStart,length:e.rangeEnd-e.rangeStart})}},{key:"successPlaylist",value:function(e,t,n){var r=performance.now();this.stats.trequest=r-300,this.stats.tfirst=r-200,this.stats.tload=r,this.stats.loaded=e.response.length,n.onSuccess({url:e.responseURL,data:e.response},this.stats,t)}},{key:"successSegment",value:function(e,t,n,r){var a=performance.now(),s=e.byteLength/(void 0===t||t<=0?12500:t);this.stats.trequest=a-1-s,this.stats.tfirst=a-s,this.stats.tload=a,this.stats.loaded=e.byteLength,r.onSuccess({url:n.url,data:e},this.stats,n)}},{key:"error",value:function(e,t,n){n.onError(e,t)}}]),e}()}}]);