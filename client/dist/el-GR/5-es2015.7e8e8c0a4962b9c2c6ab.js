(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"1qlQ":function(n,e,t){"use strict";t.d(e,"a",(function(){return r}));var s=t("mrSG"),i=t("8Y7J"),l=(t("ey9i"),t("3szM"),t("rCE/"));t("OwH3");class r extends l.a{constructor(n,e,t,s,l,r){super(),this.formValidatorService=n,this.modalService=e,this.notifier=t,this.userService=s,this.userValidatorsService=l,this.i18n=r,this.userBanned=new i.EventEmitter}ngOnInit(){this.buildForm({reason:this.userValidatorsService.USER_BAN_REASON})}openModal(n){this.usersToBan=n,this.openedModal=this.modalService.open(this.modal)}hide(){this.usersToBan=void 0,this.openedModal.close()}banUser(){return Object(s.a)(this,void 0,void 0,(function*(){this.userService.banUsers(this.usersToBan,this.form.value.reason||void 0).subscribe(()=>{const n=Array.isArray(this.usersToBan)?this.i18n("{{num}} users banned.",{num:this.usersToBan.length}):this.i18n("User {{username}} banned.",{username:this.usersToBan.username});this.notifier.success(n),this.userBanned.emit(this.usersToBan),this.hide()},n=>this.notifier.error(n.message))}))}}},GGhi:function(n,e,t){"use strict";var s=t("8Y7J"),i=t("kIzR"),l=t("fKnF"),r=t("ihI+"),o=t("s7LF"),u=t("SVse");t("1qlQ"),t("3szM"),t("G0yt"),t("mOsc"),t("vQJr"),t("Qmuk"),t("GiVz"),t.d(e,"a",(function(){return a})),t.d(e,"b",(function(){return h}));var a=s["\u0275crt"]({encapsulation:0,styles:[["textarea[_ngcontent-%COMP%]{display:inline-block;width:100%;background:var(--inputColor);border:1px solid #c6c6c6;border-radius:3px;height:60px;padding:5px 15px;font-size:15px}textarea[_ngcontent-%COMP%]::-webkit-input-placeholder{color:var(--inputPlaceholderColor)}textarea[_ngcontent-%COMP%]::-moz-placeholder{color:var(--inputPlaceholderColor)}textarea[_ngcontent-%COMP%]::-ms-input-placeholder{color:var(--inputPlaceholderColor)}textarea[_ngcontent-%COMP%]::placeholder{color:var(--inputPlaceholderColor)}@media screen and (max-width:100%){textarea[_ngcontent-%COMP%]{width:100%}}"]],data:{}});function c(n){return s["\u0275vid"](0,[(n()(),s["\u0275eld"](0,0,null,null,1,"div",[["class","form-error"]],null,null,null,null,null)),(n()(),s["\u0275ted"](1,null,[" "," "]))],null,(function(n,e){n(e,1,0,e.component.formErrors.reason)}))}function d(n){return s["\u0275vid"](0,[(n()(),s["\u0275eld"](0,0,null,null,4,"div",[["class","modal-header"]],null,null,null,null,null)),(n()(),s["\u0275eld"](1,0,null,null,1,"h4",[["class","modal-title"]],null,null,null,null,null)),(n()(),s["\u0275ted"](-1,null,["\u0391\u03c0\u03bf\u03ba\u03bb\u03b5\u03b9\u03c3\u03bc\u03cc\u03c2"])),(n()(),s["\u0275eld"](3,0,null,null,1,"my-global-icon",[["aria-label","Close"],["iconName","cross"],["role","button"]],null,[[null,"click"]],(function(n,e,t){var s=!0;return"click"===e&&(s=!1!==n.component.hide()&&s),s}),i.b,i.a)),s["\u0275did"](4,114688,null,0,l.a,[s.ElementRef,r.a],{iconName:[0,"iconName"]},null),(n()(),s["\u0275eld"](5,0,null,null,24,"div",[["class","modal-body"]],null,null,null,null,null)),(n()(),s["\u0275eld"](6,0,null,null,23,"form",[["novalidate",""]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngSubmit"],[null,"submit"],[null,"reset"]],(function(n,e,t){var i=!0,l=n.component;return"submit"===e&&(i=!1!==s["\u0275nov"](n,8).onSubmit(t)&&i),"reset"===e&&(i=!1!==s["\u0275nov"](n,8).onReset()&&i),"ngSubmit"===e&&(i=!1!==l.banUser()&&i),i}),null,null)),s["\u0275did"](7,16384,null,0,o["\u0275angular_packages_forms_forms_z"],[],null,null),s["\u0275did"](8,540672,null,0,o.FormGroupDirective,[[8,null],[8,null]],{form:[0,"form"]},{ngSubmit:"ngSubmit"}),s["\u0275prd"](2048,null,o.ControlContainer,null,[o.FormGroupDirective]),s["\u0275did"](10,16384,null,0,o.NgControlStatusGroup,[[4,o.ControlContainer]],null,null),(n()(),s["\u0275eld"](11,0,null,null,12,"div",[["class","form-group"]],null,null,null,null,null)),(n()(),s["\u0275eld"](12,0,null,null,9,"textarea",[["formControlName","reason"],["placeholder","\u0391\u03b9\u03c4\u03af\u03b1..."]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],(function(n,e,t){var i=!0;return"input"===e&&(i=!1!==s["\u0275nov"](n,16)._handleInput(t.target.value)&&i),"blur"===e&&(i=!1!==s["\u0275nov"](n,16).onTouched()&&i),"compositionstart"===e&&(i=!1!==s["\u0275nov"](n,16)._compositionStart()&&i),"compositionend"===e&&(i=!1!==s["\u0275nov"](n,16)._compositionEnd(t.target.value)&&i),i}),null,null)),s["\u0275prd"](512,null,u["\u0275NgClassImpl"],u["\u0275NgClassR2Impl"],[s.IterableDiffers,s.KeyValueDiffers,s.ElementRef,s.Renderer2]),s["\u0275did"](14,278528,null,0,u.NgClass,[u["\u0275NgClassImpl"]],{ngClass:[0,"ngClass"]},null),s["\u0275pod"](15,{"input-error":0}),s["\u0275did"](16,16384,null,0,o.DefaultValueAccessor,[s.Renderer2,s.ElementRef,[2,o.COMPOSITION_BUFFER_MODE]],null,null),s["\u0275prd"](1024,null,o.NG_VALUE_ACCESSOR,(function(n){return[n]}),[o.DefaultValueAccessor]),s["\u0275did"](18,671744,null,0,o.FormControlName,[[3,o.ControlContainer],[8,null],[8,null],[6,o.NG_VALUE_ACCESSOR],[2,o["\u0275angular_packages_forms_forms_q"]]],{name:[0,"name"]},null),s["\u0275prd"](2048,null,o.NgControl,null,[o.FormControlName]),s["\u0275did"](20,16384,null,0,o.NgControlStatus,[[4,o.NgControl]],null,null),(n()(),s["\u0275ted"](-1,null,["        "])),(n()(),s["\u0275and"](16777216,null,null,1,null,c)),s["\u0275did"](23,16384,null,0,u.NgIf,[s.ViewContainerRef,s.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),s["\u0275eld"](24,0,null,null,1,"div",[],null,null,null,null,null)),(n()(),s["\u0275ted"](-1,null,[" \u0388\u03bd\u03b1\u03c2 \u03b1\u03c0\u03bf\u03ba\u03bb\u03b5\u03b9\u03c3\u03bc\u03ad\u03bd\u03bf\u03c2 \u03c7\u03c1\u03ae\u03c3\u03c4\u03b7\u03c2 \u03b4\u03b5\u03bd \u03b8\u03b1 \u03bc\u03c0\u03bf\u03c1\u03b5\u03af \u03c0\u03b9\u03b1 \u03bd\u03b1 \u03c3\u03c5\u03bd\u03b4\u03b5\u03b8\u03b5\u03af. "])),(n()(),s["\u0275eld"](26,0,null,null,3,"div",[["class","form-group inputs"]],null,null,null,null,null)),(n()(),s["\u0275eld"](27,0,null,null,1,"span",[["class","action-button action-button-cancel"]],null,[[null,"click"]],(function(n,e,t){var s=!0;return"click"===e&&(s=!1!==n.component.hide()&&s),s}),null,null)),(n()(),s["\u0275ted"](-1,null,["\u0386\u03ba\u03c5\u03c1\u03bf"])),(n()(),s["\u0275eld"](29,0,null,null,0,"input",[["class","action-button-submit"],["type","submit"],["value","\u0391\u03c0\u03bf\u03ba\u03bb\u03b5\u03b9\u03c3\u03bc\u03cc\u03c2 \u03c7\u03c1\u03ae\u03c3\u03c4\u03b7"]],[[8,"disabled",0]],null,null,null,null))],(function(n,e){var t=e.component;n(e,4,0,"cross"),n(e,8,0,t.form);var s=n(e,15,0,t.formErrors.reason);n(e,14,0,s),n(e,18,0,"reason"),n(e,23,0,t.formErrors.reason)}),(function(n,e){var t=e.component;n(e,6,0,s["\u0275nov"](e,10).ngClassUntouched,s["\u0275nov"](e,10).ngClassTouched,s["\u0275nov"](e,10).ngClassPristine,s["\u0275nov"](e,10).ngClassDirty,s["\u0275nov"](e,10).ngClassValid,s["\u0275nov"](e,10).ngClassInvalid,s["\u0275nov"](e,10).ngClassPending),n(e,12,0,s["\u0275nov"](e,20).ngClassUntouched,s["\u0275nov"](e,20).ngClassTouched,s["\u0275nov"](e,20).ngClassPristine,s["\u0275nov"](e,20).ngClassDirty,s["\u0275nov"](e,20).ngClassValid,s["\u0275nov"](e,20).ngClassInvalid,s["\u0275nov"](e,20).ngClassPending),n(e,29,0,!t.form.valid)}))}function h(n){return s["\u0275vid"](0,[s["\u0275qud"](402653184,1,{modal:0}),(n()(),s["\u0275and"](0,[[1,2],["modal",2]],null,0,null,d))],null,null)}},KdfM:function(n,e,t){"use strict";t.d(e,"a",(function(){return v})),t.d(e,"b",(function(){return g}));var s=t("8Y7J"),i=t("GGhi"),l=t("1qlQ"),r=t("3szM"),o=t("G0yt"),u=t("mOsc"),a=t("vQJr"),c=t("Qmuk"),d=t("GiVz"),h=t("oEwo"),m=t("eEm8"),b=t("SVse"),v=(t("lKr9"),t("Vurf"),t("37nT"),t("pyEO"),t("hlYB"),s["\u0275crt"]({encapsulation:2,styles:[],data:{}}));function f(n){return s["\u0275vid"](0,[(n()(),s["\u0275eld"](0,0,null,null,5,null,null,null,null,null,null,null)),(n()(),s["\u0275eld"](1,0,null,null,1,"my-user-ban-modal",[],null,[[null,"userBanned"]],(function(n,e,t){var s=!0;return"userBanned"===e&&(s=!1!==n.component.onUserBanned()&&s),s}),i.b,i.a)),s["\u0275did"](2,114688,[[1,4],["userBanModal",4]],0,l.a,[r.a,o.A,u.a,a.a,c.a,d.a],null,{userBanned:"userBanned"}),(n()(),s["\u0275eld"](3,0,null,null,2,"my-action-dropdown",[],null,null,null,h.b,h.a)),s["\u0275did"](4,49152,null,0,m.a,[],{actions:[0,"actions"],entry:[1,"entry"],placement:[2,"placement"],buttonSize:[3,"buttonSize"],label:[4,"label"]},null),s["\u0275pod"](5,{user:0,account:1})],(function(n,e){var t=e.component;n(e,2,0);var s=t.userActions,i=n(e,5,0,t.user,t.account);n(e,4,0,s,i,t.placement,t.buttonSize,t.label)}),null)}function g(n){return s["\u0275vid"](0,[s["\u0275qud"](671088640,1,{userBanModal:0}),(n()(),s["\u0275and"](16777216,null,null,1,null,f)),s["\u0275did"](2,16384,null,0,b.NgIf,[s.ViewContainerRef,s.TemplateRef],{ngIf:[0,"ngIf"]},null)],(function(n,e){n(e,2,0,0!==e.component.userActions.length)}),null)}},lKr9:function(n,e,t){"use strict";t.d(e,"a",(function(){return r}));var s=t("mrSG"),i=t("8Y7J"),l=(t("1qlQ"),t("OwH3"),t("ey9i"),t("MpoC"));t("joIj"),t("gNPL");class r{constructor(n,e,t,s,l,r,o){this.authService=n,this.notifier=e,this.confirmService=t,this.serverService=s,this.userService=l,this.blocklistService=r,this.i18n=o,this.buttonSize="normal",this.placement="left",this.userChanged=new i.EventEmitter,this.userDeleted=new i.EventEmitter,this.userActions=[]}get requiresEmailVerification(){return this.serverConfig.signup.requiresEmailVerification}ngOnInit(){this.serverConfig=this.serverService.getTmpConfig(),this.serverService.getConfig().subscribe(n=>this.serverConfig=n)}ngOnChanges(){this.buildActions()}openBanUserModal(n){"root"!==n.username?this.userBanModal.openModal(n):this.notifier.error(this.i18n("You cannot ban root."))}onUserBanned(){this.userChanged.emit()}unbanUser(n){return Object(s.a)(this,void 0,void 0,(function*(){const e=this.i18n("Do you really want to unban {{username}}?",{username:n.username});!1!==(yield this.confirmService.confirm(e,this.i18n("Unban")))&&this.userService.unbanUsers(n).subscribe(()=>{this.notifier.success(this.i18n("User {{username}} unbanned.",{username:n.username})),this.userChanged.emit()},n=>this.notifier.error(n.message))}))}removeUser(n){return Object(s.a)(this,void 0,void 0,(function*(){if("root"===n.username)return void this.notifier.error(this.i18n("You cannot delete root."));const e=this.i18n("If you remove this user, you will not be able to create another with the same username!");!1!==(yield this.confirmService.confirm(e,this.i18n("Delete")))&&this.userService.removeUser(n).subscribe(()=>{this.notifier.success(this.i18n("User {{username}} deleted.",{username:n.username})),this.userDeleted.emit()},n=>this.notifier.error(n.message))}))}setEmailAsVerified(n){this.userService.updateUser(n.id,{emailVerified:!0}).subscribe(()=>{this.notifier.success(this.i18n("User {{username}} email set as verified",{username:n.username})),this.userChanged.emit()},n=>this.notifier.error(n.message))}blockAccountByUser(n){this.blocklistService.blockAccountByUser(n).subscribe(()=>{this.notifier.success(this.i18n("Account {{nameWithHost}} muted.",{nameWithHost:n.nameWithHost})),this.account.mutedByUser=!0,this.userChanged.emit()},n=>this.notifier.error(n.message))}unblockAccountByUser(n){this.blocklistService.unblockAccountByUser(n).subscribe(()=>{this.notifier.success(this.i18n("Account {{nameWithHost}} unmuted.",{nameWithHost:n.nameWithHost})),this.account.mutedByUser=!1,this.userChanged.emit()},n=>this.notifier.error(n.message))}blockServerByUser(n){this.blocklistService.blockServerByUser(n).subscribe(()=>{this.notifier.success(this.i18n("Instance {{host}} muted.",{host:n})),this.account.mutedServerByUser=!0,this.userChanged.emit()},n=>this.notifier.error(n.message))}unblockServerByUser(n){this.blocklistService.unblockServerByUser(n).subscribe(()=>{this.notifier.success(this.i18n("Instance {{host}} unmuted.",{host:n})),this.account.mutedServerByUser=!1,this.userChanged.emit()},n=>this.notifier.error(n.message))}blockAccountByInstance(n){this.blocklistService.blockAccountByInstance(n).subscribe(()=>{this.notifier.success(this.i18n("Account {{nameWithHost}} muted by the instance.",{nameWithHost:n.nameWithHost})),this.account.mutedByInstance=!0,this.userChanged.emit()},n=>this.notifier.error(n.message))}unblockAccountByInstance(n){this.blocklistService.unblockAccountByInstance(n).subscribe(()=>{this.notifier.success(this.i18n("Account {{nameWithHost}} unmuted by the instance.",{nameWithHost:n.nameWithHost})),this.account.mutedByInstance=!1,this.userChanged.emit()},n=>this.notifier.error(n.message))}blockServerByInstance(n){this.blocklistService.blockServerByInstance(n).subscribe(()=>{this.notifier.success(this.i18n("Instance {{host}} muted by the instance.",{host:n})),this.account.mutedServerByInstance=!0,this.userChanged.emit()},n=>this.notifier.error(n.message))}unblockServerByInstance(n){this.blocklistService.unblockServerByInstance(n).subscribe(()=>{this.notifier.success(this.i18n("Instance {{host}} unmuted by the instance.",{host:n})),this.account.mutedServerByInstance=!1,this.userChanged.emit()},n=>this.notifier.error(n.message))}getRouterUserEditLink(n){return["/admin","users","update",n.id]}buildActions(){if(this.userActions=[],this.authService.isLoggedIn()){const n=this.authService.getUser();if(this.user&&n.id===this.user.id)return;if(this.user&&n.hasRight(l.d.MANAGE_USERS)&&n.canManage(this.user)&&this.userActions.push([{label:this.i18n("Edit user"),description:this.i18n("Change quota, role, and more."),linkBuilder:({user:n})=>this.getRouterUserEditLink(n)},{label:this.i18n("Delete user"),description:this.i18n("Videos will be deleted, comments will be tombstoned."),handler:({user:n})=>this.removeUser(n)},{label:this.i18n("Ban"),description:this.i18n("User won't be able to login anymore, but videos and comments will be kept as is."),handler:({user:n})=>this.openBanUserModal(n),isDisplayed:({user:n})=>!n.blocked},{label:this.i18n("Unban user"),description:this.i18n("Allow the user to login and create videos/comments again"),handler:({user:n})=>this.unbanUser(n),isDisplayed:({user:n})=>n.blocked},{label:this.i18n("Set Email as Verified"),handler:({user:n})=>this.setEmailAsVerified(n),isDisplayed:({user:n})=>this.requiresEmailVerification&&!n.blocked&&!1===n.emailVerified}]),this.account){this.userActions.push([{label:this.i18n("Mute this account"),description:this.i18n("Hide any content from that user for you."),isDisplayed:({account:n})=>!1===n.mutedByUser,handler:({account:n})=>this.blockAccountByUser(n)},{label:this.i18n("Unmute this account"),description:this.i18n("Show back content from that user for you."),isDisplayed:({account:n})=>!0===n.mutedByUser,handler:({account:n})=>this.unblockAccountByUser(n)},{label:this.i18n("Mute the instance"),description:this.i18n("Hide any content from that instance for you."),isDisplayed:({account:n})=>!n.userId&&!1===n.mutedServerByInstance,handler:({account:n})=>this.blockServerByUser(n.host)},{label:this.i18n("Unmute the instance"),description:this.i18n("Show back content from that instance for you."),isDisplayed:({account:n})=>!n.userId&&!0===n.mutedServerByInstance,handler:({account:n})=>this.unblockServerByUser(n.host)}]);let e=[];n.hasRight(l.d.MANAGE_ACCOUNTS_BLOCKLIST)&&(e=e.concat([{label:this.i18n("Mute this account by your instance"),description:this.i18n("Hide any content from that user for you, your instance and its users."),isDisplayed:({account:n})=>!1===n.mutedByInstance,handler:({account:n})=>this.blockAccountByInstance(n)},{label:this.i18n("Unmute this account by your instance"),description:this.i18n("Show back content from that user for you, your instance and its users."),isDisplayed:({account:n})=>!0===n.mutedByInstance,handler:({account:n})=>this.unblockAccountByInstance(n)}])),n.hasRight(l.d.MANAGE_SERVERS_BLOCKLIST)&&(e=e.concat([{label:this.i18n("Mute the instance by your instance"),description:this.i18n("Hide any content from that instance for you, your instance and its users."),isDisplayed:({account:n})=>!n.userId&&!1===n.mutedServerByInstance,handler:({account:n})=>this.blockServerByInstance(n.host)},{label:this.i18n("Unmute the instance by your instance"),description:this.i18n("Show back content from that instance for you, your instance and its users."),isDisplayed:({account:n})=>!n.userId&&!0===n.mutedServerByInstance,handler:({account:n})=>this.unblockServerByInstance(n.host)}])),0!==e.length&&this.userActions.push(e)}}}}}}]);