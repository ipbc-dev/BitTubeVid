!function(){function e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(u){i=!0,s=u}finally{try{r||null==o.return||o.return()}finally{if(i)throw s}}return n}(e,t)||s(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,n,r){return(t="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,n,r||e)}function n(e,t,n,r,i,s,a){try{var o=e[s](a),u=o.value}catch(d){return void n(d)}o.done?t(u):Promise.resolve(u).then(r,i)}function r(e){return function(){var t=this,r=arguments;return new Promise(function(i,s){var a=e.apply(t,r);function o(e){n(a,i,s,o,u,"next",e)}function u(e){n(a,i,s,o,u,"throw",e)}o(void 0)})}}function i(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=s(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){u=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw a}}}}function s(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=p(e);if(t){var i=p(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return m(this,n)}}function m(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?h(e):t}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"0ovO":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n("Ggrn"),a=n("A+nu");t.HttpMediaManager=function(e){l(a,e);var t,n=c(a);function a(e){var t;return o(this,a),(t=n.call(this)).settings=e,t.xhrRequests=new Map,t.failedSegments=new Map,t.debug=s("p2pml:http-media-manager"),t.now=function(){return performance.now()},t}return d(a,[{key:"download",value:function(e,t){if(!this.isDownloading(e)){this.cleanTimedOutFailedSegments();var n=this.settings.segmentUrlBuilder?this.settings.segmentUrlBuilder(e):e.url;this.debug("http segment download",n),e.requestUrl=n;var r=new XMLHttpRequest;if(r.open("GET",n,!0),r.responseType="arraybuffer",e.range)r.setRequestHeader("Range",e.range),t=void 0;else if(void 0!==t&&this.settings.httpUseRanges){var s,a=0,o=i(t);try{for(o.s();!(s=o.n()).done;){a+=s.value.byteLength}}catch(u){o.e(u)}finally{o.f()}r.setRequestHeader("Range","bytes=".concat(a,"-")),this.debug("continue download from",a)}else t=void 0;this.setupXhrEvents(r,e,t),this.settings.xhrSetup&&this.settings.xhrSetup(r,n),this.xhrRequests.set(e.id,{xhr:r,segment:e}),r.send()}}},{key:"abort",value:function(e){var t=this.xhrRequests.get(e.id);t&&(t.xhr.abort(),this.xhrRequests.delete(e.id),this.debug("http segment abort",e.id))}},{key:"isDownloading",value:function(e){return this.xhrRequests.has(e.id)}},{key:"isFailed",value:function(e){var t=this.failedSegments.get(e.id);return void 0!==t&&t>this.now()}},{key:"getActiveDownloads",value:function(){return this.xhrRequests}},{key:"getActiveDownloadsCount",value:function(){return this.xhrRequests.size}},{key:"destroy",value:function(){this.xhrRequests.forEach(function(e){return e.xhr.abort()}),this.xhrRequests.clear()}},{key:"setupXhrEvents",value:function(e,t,n){var s=this,a=0;e.addEventListener("progress",function(e){s.emit("bytes-downloaded",e.loaded-a),a=e.loaded}),e.addEventListener("load",function(){var a=r(regeneratorRuntime.mark(function r(a){var o,u,d,l,g,c,m,h,p,f;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(a.target.status<200||a.target.status>=300)){r.next=2;break}return r.abrupt("return",void s.segmentFailure(t,a,e));case 2:if(o=a.target.response,void 0!==n&&206===a.target.status){u=0,d=i(n);try{for(d.s();!(l=d.n()).done;)g=l.value,u+=g.byteLength}catch(y){d.e(y)}finally{d.f()}c=new Uint8Array(u+o.byteLength),m=0,h=i(n);try{for(h.s();!(p=h.n()).done;)f=p.value,c.set(new Uint8Array(f),m),m+=f.byteLength}catch(y){h.e(y)}finally{h.f()}c.set(new Uint8Array(o),m),o=c.buffer}return r.next=6,s.segmentDownloadFinished(t,o,e);case 6:case"end":return r.stop()}},r)}));return function(e){return a.apply(this,arguments)}}()),e.addEventListener("error",function(n){s.segmentFailure(t,n,e)}),e.addEventListener("timeout",function(n){s.segmentFailure(t,n,e)})}},{key:"segmentDownloadFinished",value:(t=r(regeneratorRuntime.mark(function e(t,n,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.responseUrl=null===r.responseURL?void 0:r.responseURL,!this.settings.segmentValidator){e.next=9;break}return e.prev=1,e.next=4,this.settings.segmentValidator(Object.assign(Object.assign({},t),{data:n}),"http");case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return",(this.debug("segment validator failed",e.t0),void this.segmentFailure(t,e.t0,r)));case 9:this.xhrRequests.delete(t.id),this.emit("segment-loaded",t,n);case 10:case"end":return e.stop()}},e,this,[[1,6]])})),function(e,n,r){return t.apply(this,arguments)})},{key:"segmentFailure",value:function(e,t,n){e.responseUrl=null===n.responseURL?void 0:n.responseURL,this.xhrRequests.delete(e.id),this.failedSegments.set(e.id,this.now()+this.settings.httpFailedSegmentTimeout),this.emit("segment-error",e,t)}},{key:"cleanTimedOutFailedSegments",value:function(){var e=this,t=this.now(),n=[];this.failedSegments.forEach(function(e,r){e<t&&n.push(r)}),n.forEach(function(t){return e.failedSegments.delete(t)})}}]),a}(a.STEEmitter)},"10ky":function(e,t,n){"use strict";n.r(t),n.d(t,"LineStream",function(){return m}),n.d(t,"ParseStream",function(){return p}),n.d(t,"Parser",function(){return f});var r=n("VbXa"),i=n.n(r),s=n("CCF8"),a=n.n(s),o=n("pVnL"),u=n.n(o),d=n("PJYZ"),l=n.n(d),g=n("hQev"),c=n.n(g),m=function(e){function t(){var t;return(t=e.call(this)||this).buffer="",t}return i()(t,e),t.prototype.push=function(e){var t;for(this.buffer+=e,t=this.buffer.indexOf("\n");t>-1;t=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)},t}(a.a),h=function(e){for(var t,n=e.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')),r={},i=n.length;i--;)""!==n[i]&&((t=/([^=]*)=(.*)/.exec(n[i]).slice(1))[0]=t[0].replace(/^\s+|\s+$/g,""),t[1]=t[1].replace(/^\s+|\s+$/g,""),t[1]=t[1].replace(/^['"](.*)['"]$/g,"$1"),r[t[0]]=t[1]);return r},p=function(e){function t(){var t;return(t=e.call(this)||this).customParsers=[],t.tagMappers=[],t}i()(t,e);var n=t.prototype;return n.push=function(e){var t,n,r=this;0!==(e=e.trim()).length&&("#"===e[0]?this.tagMappers.reduce(function(t,n){var r=n(e);return r===e?t:t.concat([r])},[e]).forEach(function(e){for(var i=0;i<r.customParsers.length;i++)if(r.customParsers[i].call(r,e))return;if(0===e.indexOf("#EXT"))if(e=e.replace("\r",""),t=/^#EXTM3U/.exec(e))r.trigger("data",{type:"tag",tagType:"m3u"});else{if(t=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(e))return n={type:"tag",tagType:"inf"},t[1]&&(n.duration=parseFloat(t[1])),t[2]&&(n.title=t[2]),void r.trigger("data",n);if(t=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(e))return n={type:"tag",tagType:"targetduration"},t[1]&&(n.duration=parseInt(t[1],10)),void r.trigger("data",n);if(t=/^#ZEN-TOTAL-DURATION:?([0-9.]*)?/.exec(e))return n={type:"tag",tagType:"totalduration"},t[1]&&(n.duration=parseInt(t[1],10)),void r.trigger("data",n);if(t=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(e))return n={type:"tag",tagType:"version"},t[1]&&(n.version=parseInt(t[1],10)),void r.trigger("data",n);if(t=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(e))return n={type:"tag",tagType:"media-sequence"},t[1]&&(n.number=parseInt(t[1],10)),void r.trigger("data",n);if(t=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(e))return n={type:"tag",tagType:"discontinuity-sequence"},t[1]&&(n.number=parseInt(t[1],10)),void r.trigger("data",n);if(t=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(e))return n={type:"tag",tagType:"playlist-type"},t[1]&&(n.playlistType=t[1]),void r.trigger("data",n);if(t=/^#EXT-X-BYTERANGE:?([0-9.]*)?@?([0-9.]*)?/.exec(e))return n={type:"tag",tagType:"byterange"},t[1]&&(n.length=parseInt(t[1],10)),t[2]&&(n.offset=parseInt(t[2],10)),void r.trigger("data",n);if(t=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(e))return n={type:"tag",tagType:"allow-cache"},t[1]&&(n.allowed=!/NO/.test(t[1])),void r.trigger("data",n);if(t=/^#EXT-X-MAP:?(.*)$/.exec(e)){if(n={type:"tag",tagType:"map"},t[1]){var s=h(t[1]);if(s.URI&&(n.uri=s.URI),s.BYTERANGE){var a=s.BYTERANGE.split("@"),o=a[0],u=a[1];n.byterange={},o&&(n.byterange.length=parseInt(o,10)),u&&(n.byterange.offset=parseInt(u,10))}}r.trigger("data",n)}else if(t=/^#EXT-X-STREAM-INF:?(.*)$/.exec(e)){if(n={type:"tag",tagType:"stream-inf"},t[1]){if(n.attributes=h(t[1]),n.attributes.RESOLUTION){var d=n.attributes.RESOLUTION.split("x"),l={};d[0]&&(l.width=parseInt(d[0],10)),d[1]&&(l.height=parseInt(d[1],10)),n.attributes.RESOLUTION=l}n.attributes.BANDWIDTH&&(n.attributes.BANDWIDTH=parseInt(n.attributes.BANDWIDTH,10)),n.attributes["PROGRAM-ID"]&&(n.attributes["PROGRAM-ID"]=parseInt(n.attributes["PROGRAM-ID"],10))}r.trigger("data",n)}else{if(t=/^#EXT-X-MEDIA:?(.*)$/.exec(e))return n={type:"tag",tagType:"media"},t[1]&&(n.attributes=h(t[1])),void r.trigger("data",n);if(t=/^#EXT-X-ENDLIST/.exec(e))r.trigger("data",{type:"tag",tagType:"endlist"});else if(t=/^#EXT-X-DISCONTINUITY/.exec(e))r.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(t=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(e))return n={type:"tag",tagType:"program-date-time"},t[1]&&(n.dateTimeString=t[1],n.dateTimeObject=new Date(t[1])),void r.trigger("data",n);if(t=/^#EXT-X-KEY:?(.*)$/.exec(e))return n={type:"tag",tagType:"key"},t[1]&&(n.attributes=h(t[1]),n.attributes.IV&&("0x"===n.attributes.IV.substring(0,2).toLowerCase()&&(n.attributes.IV=n.attributes.IV.substring(2)),n.attributes.IV=n.attributes.IV.match(/.{8}/g),n.attributes.IV[0]=parseInt(n.attributes.IV[0],16),n.attributes.IV[1]=parseInt(n.attributes.IV[1],16),n.attributes.IV[2]=parseInt(n.attributes.IV[2],16),n.attributes.IV[3]=parseInt(n.attributes.IV[3],16),n.attributes.IV=new Uint32Array(n.attributes.IV))),void r.trigger("data",n);if(t=/^#EXT-X-START:?(.*)$/.exec(e))return n={type:"tag",tagType:"start"},t[1]&&(n.attributes=h(t[1]),n.attributes["TIME-OFFSET"]=parseFloat(n.attributes["TIME-OFFSET"]),n.attributes.PRECISE=/YES/.test(n.attributes.PRECISE)),void r.trigger("data",n);if(t=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(e))return(n={type:"tag",tagType:"cue-out-cont"}).data=t[1]?t[1]:"",void r.trigger("data",n);if(t=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(e))return(n={type:"tag",tagType:"cue-out"}).data=t[1]?t[1]:"",void r.trigger("data",n);if(t=/^#EXT-X-CUE-IN:?(.*)?$/.exec(e))return(n={type:"tag",tagType:"cue-in"}).data=t[1]?t[1]:"",void r.trigger("data",n);r.trigger("data",{type:"tag",data:e.slice(4)})}}}else r.trigger("data",{type:"comment",text:e.slice(1)})}):this.trigger("data",{type:"uri",uri:e}))},n.addParser=function(e){var t=this,n=e.expression,r=e.customType,i=e.dataParser,s=e.segment;"function"!=typeof i&&(i=function(e){return e}),this.customParsers.push(function(e){if(n.exec(e))return t.trigger("data",{type:"custom",data:i(e),customType:r,segment:s}),!0})},n.addTagMapper=function(e){var t=e.expression,n=e.map;this.tagMappers.push(function(e){return t.test(e)?n(e):e})},t}(a.a),f=function(e){function t(){var t;(t=e.call(this)||this).lineStream=new m,t.parseStream=new p,t.lineStream.pipe(t.parseStream);var n,r,i=l()(t),s=[],a={},o=function(){},d={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},g=0;t.manifest={allowCache:!0,discontinuityStarts:[],segments:[]};var h=0;return t.parseStream.on("data",function(e){var t,l;({tag:function(){({"allow-cache":function(){this.manifest.allowCache=e.allowed,"allowed"in e||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var t={};"length"in e&&(a.byterange=t,t.length=e.length,"offset"in e||(e.offset=h)),"offset"in e&&(a.byterange=t,t.offset=e.offset),h=t.offset+t.length},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),e.duration>0&&(a.duration=e.duration),0===e.duration&&(a.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=s},key:function(){if(e.attributes)if("NONE"!==e.attributes.METHOD)if(e.attributes.URI){if("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===e.attributes.KEYFORMAT)return-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(e.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===e.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==e.attributes.URI.substring(0,23)?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):e.attributes.KEYID&&"0x"===e.attributes.KEYID.substring(0,2)?void(this.manifest.contentProtection={"com.widevine.alpha":{attributes:{schemeIdUri:e.attributes.KEYFORMAT,keyId:e.attributes.KEYID.substring(2)},pssh:c()(e.attributes.URI.split(",")[1])}}):void this.trigger("warn",{message:"invalid key ID provided for Widevine"}));e.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),r={method:e.attributes.METHOD||"AES-128",uri:e.attributes.URI},void 0!==e.attributes.IV&&(r.iv=e.attributes.IV)}else this.trigger("warn",{message:"ignoring key declaration without URI"});else r=null;else this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence":function(){isFinite(e.number)?this.manifest.mediaSequence=e.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+e.number})},"discontinuity-sequence":function(){isFinite(e.number)?(this.manifest.discontinuitySequence=e.number,g=e.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+e.number})},"playlist-type":function(){/VOD|EVENT/.test(e.playlistType)?this.manifest.playlistType=e.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+e.playlist})},map:function(){n={},e.uri&&(n.uri=e.uri),e.byterange&&(n.byterange=e.byterange)},"stream-inf":function(){this.manifest.playlists=s,this.manifest.mediaGroups=this.manifest.mediaGroups||d,e.attributes?(a.attributes||(a.attributes={}),u()(a.attributes,e.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media:function(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||d,e.attributes&&e.attributes.TYPE&&e.attributes["GROUP-ID"]&&e.attributes.NAME){var n=this.manifest.mediaGroups[e.attributes.TYPE];n[e.attributes["GROUP-ID"]]=n[e.attributes["GROUP-ID"]]||{},t=n[e.attributes["GROUP-ID"]],(l={default:/yes/i.test(e.attributes.DEFAULT)}).autoselect=!!l.default||/yes/i.test(e.attributes.AUTOSELECT),e.attributes.LANGUAGE&&(l.language=e.attributes.LANGUAGE),e.attributes.URI&&(l.uri=e.attributes.URI),e.attributes["INSTREAM-ID"]&&(l.instreamId=e.attributes["INSTREAM-ID"]),e.attributes.CHARACTERISTICS&&(l.characteristics=e.attributes.CHARACTERISTICS),e.attributes.FORCED&&(l.forced=/yes/i.test(e.attributes.FORCED)),t[e.attributes.NAME]=l}else this.trigger("warn",{message:"ignoring incomplete or missing media group"})},discontinuity:function(){g+=1,a.discontinuity=!0,this.manifest.discontinuityStarts.push(s.length)},"program-date-time":function(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=e.dateTimeString,this.manifest.dateTimeObject=e.dateTimeObject),a.dateTimeString=e.dateTimeString,a.dateTimeObject=e.dateTimeObject},targetduration:function(){!isFinite(e.duration)||e.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+e.duration}):this.manifest.targetDuration=e.duration},totalduration:function(){!isFinite(e.duration)||e.duration<0?this.trigger("warn",{message:"ignoring invalid total duration: "+e.duration}):this.manifest.totalDuration=e.duration},start:function(){e.attributes&&!isNaN(e.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:e.attributes["TIME-OFFSET"],precise:e.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out":function(){a.cueOut=e.data},"cue-out-cont":function(){a.cueOutCont=e.data},"cue-in":function(){a.cueIn=e.data}}[e.tagType]||o).call(i)},uri:function(){a.uri=e.uri,s.push(a),this.manifest.targetDuration&&!("duration"in a)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),a.duration=this.manifest.targetDuration),r&&(a.key=r),a.timeline=g,n&&(a.map=n),a={}},comment:function(){},custom:function(){e.segment?(a.custom=a.custom||{},a.custom[e.customType]=e.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[e.customType]=e.data)}})[e.type].call(i)}),t}i()(t,e);var n=t.prototype;return n.push=function(e){this.lineStream.push(e)},n.end=function(){this.lineStream.push("\n")},n.addParser=function(e){this.parseStream.addParser(e)},n.addTagMapper=function(e){this.parseStream.addTagMapper(e)},t}(a.a)},"3Lai":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SegmentsMemoryStorage=function(){function e(t){o(this,e),this.settings=t,this.cache=new Map}var t,n,s,a,u,l;return d(e,[{key:"storeSegment",value:(l=r(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.cache.set(t.id,{segment:t,lastAccessed:performance.now()});case 1:case"end":return e.stop()}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"getSegmentsMap",value:(u=r(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.cache);case 1:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"getSegment",value:(a=r(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(r=this.cache.get(t))){e.next=3;break}return e.abrupt("return",(r.lastAccessed=performance.now(),r.segment));case 3:case"end":return e.stop()}},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"hasSegment",value:(s=r(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.cache.has(t));case 1:case"end":return e.stop()}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"clean",value:(n=r(regeneratorRuntime.mark(function e(t,n){var r,s,a,o,u,d,l,g,c,m,h=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=[],s=[],a=performance.now(),o=i(this.cache.values());try{for(o.s();!(u=o.n()).done;)d=u.value,a-d.lastAccessed>this.settings.cachedSegmentExpiration?r.push(d.segment.id):s.push(d)}catch(t){o.e(t)}finally{o.f()}if(!((l=s.length-this.settings.cachedSegmentsCount)>0)){e.next=23;break}s.sort(function(e,t){return e.lastAccessed-t.lastAccessed}),g=i(s),e.prev=7,g.s();case 9:if((c=g.n()).done){e.next=15;break}if(m=c.value,void 0!==n&&n(m.segment.id)||(r.push(m.segment.id),0!=--l)){e.next=13;break}return e.abrupt("break",15);case 13:e.next=9;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(7),g.e(e.t0);case 20:return e.prev=20,g.f(),e.finish(20);case 23:return e.abrupt("return",(r.forEach(function(e){return h.cache.delete(e)}),r.length>0));case 24:case"end":return e.stop()}},e,this,[[7,17,20,23]])})),function(e,t){return n.apply(this,arguments)})},{key:"destroy",value:(t=r(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.cache.clear();case 1:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})}]),e}()},"A+nu":function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=r("+qE3");n.STEEmitter=function(e){l(r,e);var n=c(r);function r(){return o(this,r),n.apply(this,arguments)}return d(r,[{key:"on",value:function(e,n){return t(p(r.prototype),"on",this).call(this,e,n)}},{key:"emit",value:function(e){for(var n,i=arguments.length,s=new Array(i>1?i-1:0),a=1;a<i;a++)s[a-1]=arguments[a];return(n=t(p(r.prototype),"emit",this)).call.apply(n,[this,e].concat(s))}}]),r}(i.EventEmitter)},CCF8:function(e,t,n){"use strict";e.exports=function(){function e(){this.listeners={}}var t=e.prototype;return t.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.off=function(e,t){if(!this.listeners[e])return!1;var n=this.listeners[e].indexOf(t);return this.listeners[e]=this.listeners[e].slice(0),this.listeners[e].splice(n,1),n>-1},t.trigger=function(e){var t=this.listeners[e];if(t)if(2===arguments.length)for(var n=t.length,r=0;r<n;++r)t[r].call(this,arguments[1]);else for(var i=Array.prototype.slice.call(arguments,1),s=t.length,a=0;a<s;++a)t[a].apply(this,i)},t.dispose=function(){this.listeners={}},t.pipe=function(e){this.on("data",function(t){e.push(t)})},e}()},O885:function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.Events||(t.Events={})).SegmentLoaded="segment_loaded",r.SegmentError="segment_error",r.SegmentAbort="segment_abort",r.PeerConnect="peer_connect",r.PeerClose="peer_close",r.PieceBytesDownloaded="piece_bytes_downloaded",r.PieceBytesUploaded="piece_bytes_uploaded"},OKKN:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("+qE3"),s=n("uOj1"),a=n("iXDm"),u=n("yLkh"),g=n("b7KT");t.Engine=function(e){l(i,e);var t,n=c(i);function i(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,i),(e=n.call(this)).loader=new s.HybridLoader(t.loader),e.segmentManager=new a.SegmentManager(e.loader,t.segments),Object.keys(s.Events).map(function(e){return s.Events[e]}).forEach(function(t){return e.loader.on(t,function(){for(var n,r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return(n=e).emit.apply(n,[t].concat(i))})}),e}return d(i,[{key:"createLoaderClass",value:function(){return g.createHlsJsLoaderClass(u.HlsJsLoader,this)}},{key:"destroy",value:(t=r(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.segmentManager.destroy();case 2:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"getSettings",value:function(){return{segments:this.segmentManager.getSettings(),loader:this.loader.getSettings()}}},{key:"getDetails",value:function(){return{loader:this.loader.getDetails()}}},{key:"setPlayingSegment",value:function(e,t,n,r){this.segmentManager.setPlayingSegment(e,t,n,r)}},{key:"setPlayingSegmentByCurrentTime",value:function(e){this.segmentManager.setPlayingSegmentByCurrentTime(e)}}],[{key:"isSupported",value:function(){return s.HybridLoader.isSupported()}}]),i}(i.EventEmitter)},R6j9:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,s,a=n("Ggrn"),u=n("A+nu"),g=n("tjlA");!function(e){e[e.SegmentData=0]="SegmentData",e[e.SegmentAbsent=1]="SegmentAbsent",e[e.SegmentsMap=2]="SegmentsMap",e[e.SegmentRequest=3]="SegmentRequest",e[e.CancelSegmentRequest=4]="CancelSegmentRequest"}(r||(r={})),function(e){e[e.Loaded=0]="Loaded",e[e.LoadingByHttp=1]="LoadingByHttp"}(s=t.MediaPeerSegmentStatus||(t.MediaPeerSegmentStatus={}));var m=function e(t,n){o(this,e),this.id=t,this.size=n,this.bytesDownloaded=0,this.pieces=[]};t.MediaPeer=function(e){l(n,e);var t=c(n);function n(e,i){var s;return o(this,n),(s=t.call(this)).peer=e,s.settings=i,s.remoteAddress="",s.downloadingSegmentId=null,s.downloadingSegment=null,s.segmentsMap=new Map,s.debug=a("p2pml:media-peer"),s.timer=null,s.onPeerConnect=function(){s.debug("peer connect",s.id,h(s)),s.remoteAddress=s.peer.remoteAddress,s.emit("connect",h(s))},s.onPeerClose=function(){s.debug("peer close",s.id,h(s)),s.terminateSegmentRequest(),s.emit("close",h(s))},s.onPeerError=function(e){s.debug("peer error",s.id,e,h(s))},s.onPeerData=function(e){var t=s.getJsonCommand(e);if(null!=t){if(s.downloadingSegment){s.debug("peer segment download is interrupted by a command",s.id,h(s));var n=s.downloadingSegment.id;return s.terminateSegmentRequest(),void s.emit("segment-error",h(s),n,"Segment download is interrupted by a command")}switch(s.debug("peer receive command",s.id,t,h(s)),t.c){case r.SegmentsMap:s.segmentsMap=s.createSegmentsMap(t.m),s.emit("data-updated");break;case r.SegmentRequest:s.emit("segment-request",h(s),t.i);break;case r.SegmentData:s.downloadingSegmentId===t.i&&(s.downloadingSegment=new m(t.i,t.s),s.cancelResponseTimeoutTimer());break;case r.SegmentAbsent:s.downloadingSegmentId===t.i&&(s.terminateSegmentRequest(),s.segmentsMap.delete(t.i),s.emit("segment-absent",h(s),t.i))}}else s.receiveSegmentPiece(e)},s.peer.on("connect",s.onPeerConnect),s.peer.on("close",s.onPeerClose),s.peer.on("error",s.onPeerError),s.peer.on("data",s.onPeerData),s.id=e.id,s}return d(n,[{key:"receiveSegmentPiece",value:function(e){if(this.downloadingSegment){this.downloadingSegment.bytesDownloaded+=e.byteLength,this.downloadingSegment.pieces.push(e),this.emit("bytes-downloaded",this,e.byteLength);var t=this.downloadingSegment.id;if(this.downloadingSegment.bytesDownloaded==this.downloadingSegment.size){var n,r=new Uint8Array(this.downloadingSegment.size),s=0,a=i(this.downloadingSegment.pieces);try{for(a.s();!(n=a.n()).done;){var o=n.value;r.set(new Uint8Array(o),s),s+=o.byteLength}}catch(u){a.e(u)}finally{a.f()}this.debug("peer segment download done",this.id,t,this),this.terminateSegmentRequest(),this.emit("segment-loaded",this,t,r.buffer)}else this.downloadingSegment.bytesDownloaded>this.downloadingSegment.size&&(this.debug("peer segment download bytes mismatch",this.id,t,this),this.terminateSegmentRequest(),this.emit("segment-error",this,t,"Too many bytes received for segment"))}else this.debug("peer segment not requested",this.id,this)}},{key:"getJsonCommand",value:function(e){var t=new Uint8Array(e);if(123==t[0]&&34==t[1]&&125==t[e.byteLength-1])try{return JSON.parse((new TextDecoder).decode(e))}catch(n){}return null}},{key:"createSegmentsMap",value:function(e){if(null==e||!(e instanceof Object))return new Map;for(var t=new Map,n=0,r=Object.keys(e);n<r.length;n++){var i=r[n],a=e[i];if(!(a instanceof Array&&2===a.length&&"string"==typeof a[0]&&a[1]instanceof Array))return new Map;var o=a[0].split("|"),u=a[1];if(o.length!==u.length)return new Map;for(var d=0;d<o.length;d++){var l=u[d];if("number"!=typeof l||void 0===s[l])return new Map;t.set("".concat(i,"+").concat(o[d]),l)}}return t}},{key:"sendCommand",value:function(e){this.debug("peer send command",this.id,e,this),this.peer.write(JSON.stringify(e))}},{key:"destroy",value:function(){this.debug("peer destroy",this.id,this),this.terminateSegmentRequest(),this.peer.destroy()}},{key:"getDownloadingSegmentId",value:function(){return this.downloadingSegmentId}},{key:"getSegmentsMap",value:function(){return this.segmentsMap}},{key:"sendSegmentsMap",value:function(e){this.sendCommand({c:r.SegmentsMap,m:e})}},{key:"sendSegmentData",value:function(e,t){this.sendCommand({c:r.SegmentData,i:e,s:t.byteLength});for(var n=t.byteLength;n>0;){var i=n>=this.settings.webRtcMaxMessageSize?this.settings.webRtcMaxMessageSize:n,s=g.Buffer.from(t,t.byteLength-n,i);this.peer.write(s),n-=i}this.emit("bytes-uploaded",this,t.byteLength)}},{key:"sendSegmentAbsent",value:function(e){this.sendCommand({c:r.SegmentAbsent,i:e})}},{key:"requestSegment",value:function(e){if(this.downloadingSegmentId)throw new Error("A segment is already downloading: "+this.downloadingSegmentId);this.sendCommand({c:r.SegmentRequest,i:e}),this.downloadingSegmentId=e,this.runResponseTimeoutTimer()}},{key:"cancelSegmentRequest",value:function(){var e;if(this.downloadingSegmentId){var t=this.downloadingSegmentId;e=this.downloadingSegment?this.downloadingSegment.pieces:void 0,this.terminateSegmentRequest(),this.sendCommand({c:r.CancelSegmentRequest,i:t})}return e}},{key:"runResponseTimeoutTimer",value:function(){var e=this;this.timer=setTimeout(function(){if(e.timer=null,e.downloadingSegmentId){var t=e.downloadingSegmentId;e.cancelSegmentRequest(),e.emit("segment-timeout",e,t)}},this.settings.p2pSegmentDownloadTimeout)}},{key:"cancelResponseTimeoutTimer",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null)}},{key:"terminateSegmentRequest",value:function(){this.downloadingSegmentId=null,this.downloadingSegment=null,this.cancelResponseTimeoutTimer()}}]),n}(u.STEEmitter)},b7KT:function(e,t){e.exports.createHlsJsLoaderClass=function(e,t){function n(){this.impl=new e(t.segmentManager),this.stats=this.impl.stats}return n.prototype.load=function(e,t,n){this.context=e,this.impl.load(e,t,n)},n.prototype.abort=function(){this.impl.abort(this.context)},n.prototype.destroy=function(){this.context&&this.impl.abort(this.context)},n.getEngine=function(){return t},n}},fnjI:function(e,t,n){var r=n("P7XM"),i=n("tnIz"),s=n("hwdV").Buffer,a=[1518500249,1859775393,-1894007588,-899497514],o=new Array(80);function u(){this.init(),this._w=o,i.call(this,64,56)}function d(e){return e<<5|e>>>27}function l(e){return e<<30|e>>>2}function g(e,t,n,r){return 0===e?t&n|~t&r:2===e?t&n|t&r|n&r:t^n^r}r(u,i),u.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},u.prototype._update=function(e){for(var t,n=this._w,r=0|this._a,i=0|this._b,s=0|this._c,o=0|this._d,u=0|this._e,c=0;c<16;++c)n[c]=e.readInt32BE(4*c);for(;c<80;++c)n[c]=(t=n[c-3]^n[c-8]^n[c-14]^n[c-16])<<1|t>>>31;for(var m=0;m<80;++m){var h=~~(m/20),p=d(r)+g(h,i,s,o)+u+n[m]+a[h]|0;u=o,o=s,s=l(i),i=r,r=p}this._a=r+this._a|0,this._b=i+this._b|0,this._c=s+this._c|0,this._d=o+this._d|0,this._e=u+this._e|0},u.prototype._hash=function(){var e=s.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=u},hQev:function(e,t,n){"use strict";var r,i=(r=n("vgmO"))&&"object"==typeof r&&"default"in r?r:{default:r};e.exports=function(e){for(var t,n=(t=e,i.default.atob?i.default.atob(t):Buffer.from(t,"base64").toString("binary")),r=new Uint8Array(n.length),s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}},iXDm:function(t,n,s){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=s("uOj1"),u=s("10ky"),l={forwardSegmentCount:20,swarmId:void 0,assetsStorage:void 0};n.SegmentManager=function(){function t(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o(this,t),this.masterPlaylist=null,this.variantPlaylists=new Map,this.segmentRequest=null,this.playQueue=[],this.onSegmentLoaded=function(e){n.segmentRequest&&n.segmentRequest.segmentUrl===e.url&&h(n.segmentRequest.segmentByterange)===e.range&&(n.segmentRequest.onSuccess(e.data.slice(0),e.downloadBandwidth),n.segmentRequest=null)},this.onSegmentError=function(e,t){n.segmentRequest&&n.segmentRequest.segmentUrl===e.url&&h(n.segmentRequest.segmentByterange)===e.range&&(n.segmentRequest.onError(t),n.segmentRequest=null)},this.onSegmentAbort=function(e){n.segmentRequest&&n.segmentRequest.segmentUrl===e.url&&h(n.segmentRequest.segmentByterange)===e.range&&(n.segmentRequest.onError("Loading aborted: internal abort"),n.segmentRequest=null)},this.settings=Object.assign(Object.assign({},l),r),this.loader=e,this.loader.on(a.Events.SegmentLoaded,this.onSegmentLoaded),this.loader.on(a.Events.SegmentError,this.onSegmentError),this.loader.on(a.Events.SegmentAbort,this.onSegmentAbort)}var n,s,p,f,y;return d(t,[{key:"getSettings",value:function(){return this.settings}},{key:"processPlaylist",value:function(t,n,r){var s=new u.Parser;s.push(n),s.end();var a=new g(t,r,s.manifest);if(a.manifest.playlists){this.masterPlaylist=a;var o,d=i(this.variantPlaylists);try{for(d.s();!(o=d.n()).done;){var l=e(o.value,2),c=l[0],m=l[1],h=this.getStreamSwarmId(m.requestUrl),p=h.streamSwarmId,f=h.found,y=h.index;f?(m.streamSwarmId=p,m.streamId="V"+y.toString()):this.variantPlaylists.delete(c)}}catch(I){d.e(I)}finally{d.f()}}else{var v=this.getStreamSwarmId(t),S=v.streamSwarmId,b=v.found,w=v.index;(b||null===this.masterPlaylist)&&(a.streamSwarmId=S,a.streamId=null===this.masterPlaylist?void 0:"V"+w.toString(),this.variantPlaylists.set(t,a),this.updateSegments())}}},{key:"loadPlaylist",value:(y=r(regeneratorRuntime.mark(function e(t){var n,r,i,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(n=this.settings.assetsStorage)){e.next=16;break}return void 0===(i=this.getMasterSwarmId())&&(i=t.split("?")[0]),e.next=5,n.getAsset(t,void 0,i);case 5:if(void 0===(s=e.sent)){e.next=10;break}r={responseURL:s.responseUri,response:s.data},e.next=14;break;case 10:return e.next=12,this.loadContent(t,"text");case 12:r=e.sent,n.storeAsset({masterManifestUri:null!==this.masterPlaylist?this.masterPlaylist.requestUrl:t,masterSwarmId:i,requestUri:t,responseUri:r.responseURL,data:r.response});case 14:e.next=19;break;case 16:return e.next=18,this.loadContent(t,"text");case 18:r=e.sent;case 19:return e.abrupt("return",(this.processPlaylist(t,r.response,r.responseURL),r));case 20:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"loadSegment",value:(f=r(regeneratorRuntime.mark(function e(t,n){var r,i,s,a,o,u,d,l,g,m,p=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.getSegmentLocation(t,n),i=h(n),r){e.next=23;break}if(void 0===(a=this.settings.assetsStorage)){e.next=17;break}if(u=null!==this.masterPlaylist?this.masterPlaylist.requestUrl:void 0,void 0===(o=this.getMasterSwarmId())&&1===this.variantPlaylists.size&&(o=this.variantPlaylists.values().next().value.requestUrl.split("?")[0]),void 0===u&&1===this.variantPlaylists.size&&(u=this.variantPlaylists.values().next().value.requestUrl),void 0===o||void 0===u){e.next=17;break}return e.next=8,a.getAsset(t,i,o);case 8:if(void 0===(d=e.sent)){e.next=13;break}s=d.data,e.next=17;break;case 13:return e.next=15,this.loadContent(t,"arraybuffer",i);case 15:l=e.sent,s=l.response,a.storeAsset({masterManifestUri:u,masterSwarmId:o,requestUri:t,requestRange:i,responseUri:l.responseURL,data:s});case 17:if(e.t0=void 0===s,!e.t0){e.next=22;break}return e.next=21,this.loadContent(t,"arraybuffer",i);case 21:s=e.sent.response;case 22:return e.abrupt("return",{content:s,downloadBandwidth:0});case 23:return g=(r.playlist.manifest.mediaSequence?r.playlist.manifest.mediaSequence:0)+r.segmentIndex,this.playQueue.length>0&&this.playQueue[this.playQueue.length-1].segmentSequence!==g-1&&(this.playQueue=[]),this.segmentRequest&&this.segmentRequest.onError("Cancel segment request: simultaneous segment requests are not supported"),m=new Promise(function(e,i){p.segmentRequest=new c(t,n,g,r.playlist.requestUrl,function(t,n){return e({content:t,downloadBandwidth:n})},function(e){return i(e)})}),e.abrupt("return",(this.playQueue.push({segmentUrl:t,segmentByterange:n,segmentSequence:g}),this.loadSegments(r.playlist,r.segmentIndex,!0),m));case 27:case"end":return e.stop()}},e,this)})),function(e,t){return f.apply(this,arguments)})},{key:"setPlayingSegment",value:function(e,t,n,r){var i=this.playQueue.findIndex(function(n){return n.segmentUrl==e&&m(n.segmentByterange,t)});i>=0&&(this.playQueue=this.playQueue.slice(i),this.playQueue[0].playPosition={start:n,duration:r},this.updateSegments())}},{key:"setPlayingSegmentByCurrentTime",value:function(e){if(0!==this.playQueue.length&&this.playQueue[0].playPosition){var t=this.playQueue[0].playPosition;t.start+t.duration-e<.2&&(this.playQueue=this.playQueue.slice(1),this.updateSegments())}}},{key:"abortSegment",value:function(e,t){this.segmentRequest&&this.segmentRequest.segmentUrl===e&&m(this.segmentRequest.segmentByterange,t)&&(this.segmentRequest.onSuccess(void 0,0),this.segmentRequest=null)}},{key:"destroy",value:(p=r(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.segmentRequest&&(this.segmentRequest.onError("Loading aborted: object destroyed"),this.segmentRequest=null),this.masterPlaylist=null,this.variantPlaylists.clear(),this.playQueue=[],e.t0=void 0!==this.settings.assetsStorage,!e.t0){e.next=8;break}return e.next=8,this.settings.assetsStorage.destroy();case 8:return e.next=10,this.loader.destroy();case 10:case"end":return e.stop()}},e,this)})),function(){return p.apply(this,arguments)})},{key:"updateSegments",value:function(){if(this.segmentRequest){var e=this.getSegmentLocation(this.segmentRequest.segmentUrl,this.segmentRequest.segmentByterange);e&&this.loadSegments(e.playlist,e.segmentIndex,!1)}}},{key:"getSegmentLocation",value:function(e,t){var n,r=i(this.variantPlaylists.values());try{for(r.s();!(n=r.n()).done;){var s=n.value,a=s.getSegmentIndex(e,t);if(a>=0)return{playlist:s,segmentIndex:a}}}catch(o){r.e(o)}finally{r.f()}}},{key:"loadSegments",value:(s=r(regeneratorRuntime.mark(function e(t,n,r){var i,s,a,o,u,d,l,g,c,m,p,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(i=[],s=t.manifest.segments,a=t.manifest.mediaSequence?t.manifest.mediaSequence:0,o=null,u=Math.max(0,this.playQueue.length-1),d=this.getMasterSwarmId(),l=n;l<s.length&&i.length<this.settings.forwardSegmentCount;++l)g=t.manifest.segments[l],c=t.getSegmentAbsoluteUrl(g.uri),m=g.byterange,p=this.getSegmentId(t,a+l),i.push({id:p,url:c,masterSwarmId:void 0!==d?d:t.streamSwarmId,masterManifestUri:null!==this.masterPlaylist?this.masterPlaylist.requestUrl:t.requestUrl,streamId:t.streamId,sequence:(a+l).toString(),range:h(m),priority:u++}),r&&!o&&(o=p);if(this.loader.load(i,t.streamSwarmId),!o){e.next=9;break}return e.next=7,this.loader.getSegment(o);case 7:(f=e.sent)&&this.onSegmentLoaded(f);case 9:case"end":return e.stop()}},e,this)})),function(e,t,n){return s.apply(this,arguments)})},{key:"getSegmentId",value:function(e,t){return"".concat(e.streamSwarmId,"+").concat(t)}},{key:"getMasterSwarmId",value:function(){var e=this.settings.swarmId&&0!==this.settings.swarmId.length?this.settings.swarmId:void 0;return void 0!==e?e:null!==this.masterPlaylist?this.masterPlaylist.requestUrl.split("?")[0]:void 0}},{key:"getStreamSwarmId",value:function(e){var t=this.getMasterSwarmId();if(null!==this.masterPlaylist)for(var n=0;n<this.masterPlaylist.manifest.playlists.length;++n)if(new URL(this.masterPlaylist.manifest.playlists[n].uri,this.masterPlaylist.responseUrl).toString()===e)return{streamSwarmId:"".concat(t,"+V").concat(n),found:!0,index:n};return{streamSwarmId:void 0!==t?t:e.split("?")[0],found:!1,index:-1}}},{key:"loadContent",value:(n=r(regeneratorRuntime.mark(function e(t,n,r){var i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,s){var a=new XMLHttpRequest;a.open("GET",t,!0),a.responseType=n,r&&a.setRequestHeader("Range",r),a.addEventListener("readystatechange",function(){4===a.readyState&&(a.status>=200&&a.status<300?e(a):s(a.statusText))});var o=i.loader.getSettings().xhrSetup;o&&o(a,t),a.send()}));case 1:case"end":return e.stop()}},e)})),function(e,t,r){return n.apply(this,arguments)})}]),t}();var g=function(){function e(t,n,r){o(this,e),this.requestUrl=t,this.responseUrl=n,this.manifest=r,this.streamSwarmId=""}return d(e,[{key:"getSegmentIndex",value:function(e,t){for(var n=0;n<this.manifest.segments.length;++n){var r=this.manifest.segments[n];if(e===this.getSegmentAbsoluteUrl(r.uri)&&m(r.byterange,t))return n}return-1}},{key:"getSegmentAbsoluteUrl",value:function(e){return new URL(e,this.responseUrl).toString()}}]),e}(),c=function e(t,n,r,i,s,a){o(this,e),this.segmentUrl=t,this.segmentByterange=n,this.segmentSequence=r,this.playlistRequestUrl=i,this.onSuccess=s,this.onError=a};function m(e,t){return void 0===e?void 0===t:void 0!==t&&e.length===t.length&&e.offset===t.offset}function h(e){if(void 0!==e)return"bytes=".concat(e.offset,"-").concat(e.offset+e.length-1)}},lcUr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n("Ggrn"),a=n("O885"),u=n("+qE3"),g=n("0ovO"),m=n("n5Qj"),h=n("R6j9"),p=n("xzjP"),f=n("3Lai"),y=n("3oOE"),v={cachedSegmentExpiration:3e5,cachedSegmentsCount:30,useP2P:!0,consumeOnly:!1,requiredSegmentsPriority:1,simultaneousHttpDownloads:2,httpDownloadProbability:.1,httpDownloadProbabilityInterval:1e3,httpDownloadProbabilitySkipIfNoPeers:!1,httpFailedSegmentTimeout:1e4,httpDownloadMaxPriority:20,httpDownloadInitialTimeout:0,httpDownloadInitialTimeoutPerSegment:4e3,httpUseRanges:!1,simultaneousP2PDownloads:3,p2pDownloadMaxPriority:20,p2pSegmentDownloadTimeout:6e4,webRtcMaxMessageSize:65535,trackerAnnounce:["wss://tracker.novage.com.ua","wss://tracker.openwebtorrent.com"],peerRequestsPerAnnounce:10,rtcConfig:n("BRrH").config};t.HybridLoader=function(e){l(w,e);var t,n,u,S,b=c(w);function w(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,w),(e=b.call(this)).debug=s("p2pml:hybrid-loader"),e.debugSegments=s("p2pml:hybrid-loader-segments"),e.segmentsQueue=[],e.bandwidthApproximator=new p.BandwidthApproximator,e.httpDownloadInitialTimeoutTimestamp=-1/0,e.processInitialSegmentTimeout=r(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===e.httpRandomDownloadInterval){t.next=7;break}if(void 0===e.masterSwarmId){t.next=6;break}return t.next=4,e.segmentsStorage.getSegmentsMap(e.masterSwarmId);case 4:n=t.sent,e.processSegmentsQueue(n)&&!e.settings.consumeOnly&&e.p2pManager.sendSegmentsMapToAll(e.createSegmentsMap(n));case 6:e.httpDownloadInitialTimeoutTimestamp!==-1/0&&setTimeout(e.processInitialSegmentTimeout,e.settings.httpDownloadInitialTimeoutPerSegment);case 7:case"end":return t.stop()}},t)})),e.downloadRandomSegmentOverHttp=r(regeneratorRuntime.mark(function t(){var n,r,i,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(void 0===e.masterSwarmId||void 0===e.httpRandomDownloadInterval||e.httpDownloadInitialTimeoutTimestamp!==-1/0||e.httpManager.getActiveDownloadsCount()>=e.settings.simultaneousHttpDownloads||e.settings.httpDownloadProbabilitySkipIfNoPeers&&0===e.p2pManager.getPeers().size||e.settings.consumeOnly)){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.segmentsStorage.getSegmentsMap(e.masterSwarmId);case 4:if(n=t.sent,r=e.p2pManager.getOvrallSegmentsMap(),0!=(i=e.segmentsQueue.filter(function(t){return!e.p2pManager.isDownloading(t)&&!e.httpManager.isDownloading(t)&&!r.has(t.id)&&!e.httpManager.isFailed(t)&&t.priority<=e.settings.httpDownloadMaxPriority&&!n.has(t.id)})).length){t.next=9;break}return t.abrupt("return");case 9:if(!(Math.random()>e.settings.httpDownloadProbability*i.length)){t.next=11;break}return t.abrupt("return");case 11:s=i[Math.floor(Math.random()*i.length)],e.debugSegments("HTTP download (random)",s.priority,s.url),e.httpManager.download(s),e.p2pManager.sendSegmentsMapToAll(e.createSegmentsMap(n));case 13:case"end":return t.stop()}},t)})),e.onPieceBytesDownloaded=function(t,n,r){e.bandwidthApproximator.addBytes(n,e.now()),e.emit(a.Events.PieceBytesDownloaded,t,n,r)},e.onPieceBytesUploaded=function(t,n,r){e.emit(a.Events.PieceBytesUploaded,t,n,r)},e.onSegmentLoaded=function(){var t=r(regeneratorRuntime.mark(function t(n,r,i){var s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.debugSegments("segment loaded",n.id,n.url),void 0!==e.masterSwarmId){t.next=2;break}return t.abrupt("return");case 2:return n.data=r,n.downloadBandwidth=e.bandwidthApproximator.getBandwidth(e.now()),t.next=6,e.segmentsStorage.storeSegment(n);case 6:if(e.emit(a.Events.SegmentLoaded,n,i),void 0!==s){t.next=13;break}return t.next=10,e.segmentsStorage.getSegmentsMap(e.masterSwarmId);case 10:t.t0=t.sent,t.next=14;break;case 13:t.t0=s;case 14:s=t.t0,e.processSegmentsQueue(s),e.settings.consumeOnly||e.p2pManager.sendSegmentsMapToAll(e.createSegmentsMap(s));case 17:case"end":return t.stop()}},t)}));return function(e,n,r){return t.apply(this,arguments)}}(),e.onSegmentError=function(){var t=r(regeneratorRuntime.mark(function t(n,r,i){var s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.debugSegments("segment error",n.id,n.url,i,r),e.emit(a.Events.SegmentError,n,r,i),void 0===e.masterSwarmId){t.next=5;break}return t.next=3,e.segmentsStorage.getSegmentsMap(e.masterSwarmId);case 3:s=t.sent,e.processSegmentsQueue(s)&&!e.settings.consumeOnly&&e.p2pManager.sendSegmentsMapToAll(e.createSegmentsMap(s));case 5:case"end":return t.stop()}},t)}));return function(e,n,r){return t.apply(this,arguments)}}(),e.onPeerConnect=function(){var t=r(regeneratorRuntime.mark(function t(n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.emit(a.Events.PeerConnect,n),t.t0=e.settings.consumeOnly||void 0===e.masterSwarmId,t.t0){t.next=11;break}return t.t1=e.p2pManager,t.t2=n.id,t.t3=e,t.next=8,e.segmentsStorage.getSegmentsMap(e.masterSwarmId);case 8:t.t4=t.sent,t.t5=t.t3.createSegmentsMap.call(t.t3,t.t4),t.t1.sendSegmentsMap.call(t.t1,t.t2,t.t5);case 11:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),e.onPeerClose=function(t){e.emit(a.Events.PeerClose,t)},e.onTrackerUpdate=function(){var t=r(regeneratorRuntime.mark(function t(n){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.httpDownloadInitialTimeoutTimestamp!==-1/0&&void 0!==n.incomplete&&n.incomplete<=1&&(e.debugSegments("cancel initial HTTP download timeout - no peers"),e.httpDownloadInitialTimeoutTimestamp=-1/0,void 0!==e.masterSwarmId))){t.next=5;break}return t.next=3,e.segmentsStorage.getSegmentsMap(e.masterSwarmId);case 3:r=t.sent,e.processSegmentsQueue(r)&&!e.settings.consumeOnly&&e.p2pManager.sendSegmentsMapToAll(e.createSegmentsMap(r));case 5:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),e.settings=Object.assign(Object.assign({},v),t),t.bufferedSegmentsCount&&(void 0===t.p2pDownloadMaxPriority&&(e.settings.p2pDownloadMaxPriority=t.bufferedSegmentsCount),void 0===t.httpDownloadMaxPriority&&(e.settings.p2pDownloadMaxPriority=t.bufferedSegmentsCount),delete e.settings.bufferedSegmentsCount),e.segmentsStorage=void 0===e.settings.segmentsStorage?new f.SegmentsMemoryStorage(e.settings):e.settings.segmentsStorage,e.debug("loader settings",e.settings),e.httpManager=e.createHttpManager(),e.httpManager.on("segment-loaded",e.onSegmentLoaded),e.httpManager.on("segment-error",e.onSegmentError),e.httpManager.on("bytes-downloaded",function(t){return e.onPieceBytesDownloaded("http",t)}),e.p2pManager=e.createP2PManager(),e.p2pManager.on("segment-loaded",e.onSegmentLoaded),e.p2pManager.on("segment-error",e.onSegmentError),e.p2pManager.on("peer-data-updated",r(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==e.masterSwarmId){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.segmentsStorage.getSegmentsMap(e.masterSwarmId);case 4:n=t.sent,e.processSegmentsQueue(n)&&!e.settings.consumeOnly&&e.p2pManager.sendSegmentsMapToAll(e.createSegmentsMap(n));case 6:case"end":return t.stop()}},t)}))),e.p2pManager.on("bytes-downloaded",function(t,n){return e.onPieceBytesDownloaded("p2p",t,n)}),e.p2pManager.on("bytes-uploaded",function(t,n){return e.onPieceBytesUploaded("p2p",t,n)}),e.p2pManager.on("peer-connected",e.onPeerConnect),e.p2pManager.on("peer-closed",e.onPeerClose),e.p2pManager.on("tracker-update",e.onTrackerUpdate),e}return d(w,[{key:"createHttpManager",value:function(){return new g.HttpMediaManager(this.settings)}},{key:"createP2PManager",value:function(){return new m.P2PMediaManager(this.segmentsStorage,this.settings)}},{key:"load",value:(S=r(regeneratorRuntime.mark(function e(t,n){var r,s,o,u,d,l,g,c,m=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:void 0===this.httpRandomDownloadInterval&&(this.httpRandomDownloadInterval=setInterval(this.downloadRandomSegmentOverHttp,this.settings.httpDownloadProbabilityInterval),this.settings.httpDownloadInitialTimeout>0&&this.settings.httpDownloadInitialTimeoutPerSegment>0&&(this.debugSegments("enable initial HTTP download timeout",this.settings.httpDownloadInitialTimeout,"per segment",this.settings.httpDownloadInitialTimeoutPerSegment),this.httpDownloadInitialTimeoutTimestamp=this.now(),setTimeout(this.processInitialSegmentTimeout,this.settings.httpDownloadInitialTimeoutPerSegment+100))),t.length>0&&(this.masterSwarmId=t[0].masterSwarmId),void 0!==this.masterSwarmId&&this.p2pManager.setStreamSwarmId(n,this.masterSwarmId),this.debug("load segments"),r=!1,s=i(this.segmentsQueue);try{for(u=function(){var e=o.value;t.find(function(t){return t.url==e.url})||(m.debug("remove segment",e.url),m.httpManager.isDownloading(e)?(r=!0,m.httpManager.abort(e)):m.p2pManager.abort(e),m.emit(a.Events.SegmentAbort,e))},s.s();!(o=s.n()).done;)u()}catch(h){s.e(h)}finally{s.f()}if(this.debug.enabled){d=i(t);try{for(g=function(){var e=l.value;m.segmentsQueue.find(function(t){return t.url==e.url})||m.debug("add segment",e.url)},d.s();!(l=d.n()).done;)g()}catch(h){d.e(h)}finally{d.f()}}if(this.segmentsQueue=t,void 0!==this.masterSwarmId){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this.segmentsStorage.getSegmentsMap(this.masterSwarmId);case 9:return c=e.sent,r=this.processSegmentsQueue(c)||r,e.next=13,this.cleanSegmentsStorage();case 13:if(e.t0=e.sent,!e.t0){e.next=19;break}return e.next=17,this.segmentsStorage.getSegmentsMap(this.masterSwarmId);case 17:c=e.sent,r=!0;case 19:r&&!this.settings.consumeOnly&&this.p2pManager.sendSegmentsMapToAll(this.createSegmentsMap(c));case 20:case"end":return e.stop()}},e,this)})),function(e,t){return S.apply(this,arguments)})},{key:"getSegment",value:(u=r(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",void 0===this.masterSwarmId?void 0:this.segmentsStorage.getSegment(t,this.masterSwarmId));case 1:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"getSettings",value:function(){return this.settings}},{key:"getDetails",value:function(){return{peerId:this.p2pManager.getPeerId()}}},{key:"destroy",value:(n=r(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void 0!==this.httpRandomDownloadInterval&&(clearInterval(this.httpRandomDownloadInterval),this.httpRandomDownloadInterval=void 0),this.httpDownloadInitialTimeoutTimestamp=-1/0,this.segmentsQueue=[],this.httpManager.destroy(),this.p2pManager.destroy(),this.masterSwarmId=void 0,e.next=8,this.segmentsStorage.destroy();case 8:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"processSegmentsQueue",value:function(e){if(this.debugSegments("process segments queue. priority",this.segmentsQueue.length>0?this.segmentsQueue[0].priority:0),void 0===this.masterSwarmId||0===this.segmentsQueue.length)return!1;var t,n=!1,r=!0;if(this.httpDownloadInitialTimeoutTimestamp!==-1/0){var s,a,o=i(this.segmentsQueue);try{for(o.s();!(a=o.n()).done;){var u=a.value;if(!e.has(u.id)){s=u.priority;break}}}catch(v){o.e(v)}finally{o.f()}var d=this.now()-this.httpDownloadInitialTimeoutTimestamp;(r=d>=this.settings.httpDownloadInitialTimeout||void 0!==s&&d>this.settings.httpDownloadInitialTimeoutPerSegment&&s<=0)&&(this.debugSegments("cancel initial HTTP download timeout - timed out"),this.httpDownloadInitialTimeoutTimestamp=-1/0)}for(var l=0;l<this.segmentsQueue.length;l++){var g=this.segmentsQueue[l];if(!e.has(g.id)&&!this.httpManager.isDownloading(g)){if(g.priority<=this.settings.requiredSegmentsPriority&&r&&!this.httpManager.isFailed(g)){if(this.httpManager.getActiveDownloadsCount()>=this.settings.simultaneousHttpDownloads)for(var c=this.segmentsQueue.length-1;c>l;c--){var m=this.segmentsQueue[c];if(this.httpManager.isDownloading(m)){this.debugSegments("cancel HTTP download",m.priority,m.url),this.httpManager.abort(m);break}}if(this.httpManager.getActiveDownloadsCount()<this.settings.simultaneousHttpDownloads){var p=this.p2pManager.abort(g);this.httpManager.download(g,p),this.debugSegments("HTTP download (priority)",g.priority,g.url),n=!0;continue}}if(!this.p2pManager.isDownloading(g))if(g.priority<=this.settings.requiredSegmentsPriority){if((t=t||this.p2pManager.getOvrallSegmentsMap()).get(g.id)!==h.MediaPeerSegmentStatus.Loaded)continue;if(this.p2pManager.getActiveDownloadsCount()>=this.settings.simultaneousP2PDownloads)for(var f=this.segmentsQueue.length-1;f>l;f--){var y=this.segmentsQueue[f];if(this.p2pManager.isDownloading(y)){this.debugSegments("cancel P2P download",y.priority,y.url),this.p2pManager.abort(y);break}}if(this.p2pManager.getActiveDownloadsCount()<this.settings.simultaneousP2PDownloads&&this.p2pManager.download(g)){this.debugSegments("P2P download (priority)",g.priority,g.url);continue}}else this.p2pManager.getActiveDownloadsCount()<this.settings.simultaneousP2PDownloads&&g.priority<=this.settings.p2pDownloadMaxPriority&&this.p2pManager.download(g)&&this.debugSegments("P2P download",g.priority,g.url)}}return n}},{key:"getStreamSwarmId",value:function(e){return void 0===e.streamId?e.masterSwarmId:"".concat(e.masterSwarmId,"+").concat(e.streamId)}},{key:"createSegmentsMap",value:function(e){var t,n=this,r={},s=function(e,t){var i=n.getStreamSwarmId(e),s=e.sequence,a=r[i];void 0===a&&(a=["",[]],r[i]=a);var o=a[1];a[0]+=0==o.length?s:"|".concat(s),o.push(t)},a=i(e.values());try{for(a.s();!(t=a.n()).done;){s(t.value.segment,h.MediaPeerSegmentStatus.Loaded)}}catch(d){a.e(d)}finally{a.f()}var o,u=i(this.httpManager.getActiveDownloads().values());try{for(u.s();!(o=u.n()).done;){s(o.value.segment,h.MediaPeerSegmentStatus.LoadingByHttp)}}catch(d){u.e(d)}finally{u.f()}return r}},{key:"cleanSegmentsStorage",value:(t=r(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",void 0!==this.masterSwarmId&&this.segmentsStorage.clean(this.masterSwarmId,function(e){return void 0!==t.segmentsQueue.find(function(t){return t.id===e})}));case 1:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"now",value:function(){return performance.now()}}],[{key:"isSupported",value:function(){var e=y();return e&&void 0!==e.RTCPeerConnection.prototype.createDataChannel}}]),w}(u.EventEmitter)},n5Qj:function(t,n,s){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=s("Ggrn"),u=s("J6t0"),g=s("A+nu"),m=s("R6j9"),h=s("tjlA"),p=s("fnjI"),f="-WW".concat(s("uOj1").version.replace(/\d*./g,function(e){return("0"+parseInt(e,10)%100).slice(-2)}).slice(0,4),"-"),y=function e(t,n){o(this,e),this.peerId=t,this.segment=n};n.P2PMediaManager=function(t){l(g,t);var n,s=c(g);function g(t,n){var u;return o(this,g),(u=s.call(this)).sementsStorage=t,u.settings=n,u.trackerClient=null,u.peers=new Map,u.peerCandidates=new Map,u.peerSegmentRequests=new Map,u.streamSwarmId=null,u.debug=a("p2pml:p2p-media-manager"),u.pendingTrackerClient=null,u.onTrackerError=function(e){u.debug("tracker error",e)},u.onTrackerWarning=function(e){u.debug("tracker warning",e)},u.onTrackerUpdate=function(e){u.debug("tracker update",e),u.emit("tracker-update",e)},u.onTrackerPeer=function(e){if(u.debug("tracker peer",e.id,e),u.peers.has(e.id))return u.debug("tracker peer already connected",e.id,e),void e.destroy();var t=new m.MediaPeer(e,u.settings);t.on("connect",u.onPeerConnect),t.on("close",u.onPeerClose),t.on("data-updated",u.onPeerDataUpdated),t.on("segment-request",u.onSegmentRequest),t.on("segment-loaded",u.onSegmentLoaded),t.on("segment-absent",u.onSegmentAbsent),t.on("segment-error",u.onSegmentError),t.on("segment-timeout",u.onSegmentTimeout),t.on("bytes-downloaded",u.onPieceBytesDownloaded),t.on("bytes-uploaded",u.onPieceBytesUploaded);var n=u.peerCandidates.get(t.id);n||(n=[],u.peerCandidates.set(t.id,n)),n.push(t)},u.onPieceBytesDownloaded=function(e,t){u.emit("bytes-downloaded",t,e.id)},u.onPieceBytesUploaded=function(e,t){u.emit("bytes-uploaded",t,e.id)},u.onPeerConnect=function(e){if(u.peers.get(e.id))return u.debug("tracker peer already connected (in peer connect)",e.id,e),void e.destroy();u.peers.set(e.id,e);var t=u.peerCandidates.get(e.id);if(t){var n,r=i(t);try{for(r.s();!(n=r.n()).done;){var s=n.value;s!=e&&s.destroy()}}catch(a){r.e(a)}finally{r.f()}u.peerCandidates.delete(e.id)}u.emit("peer-connected",{id:e.id,remoteAddress:e.remoteAddress})},u.onPeerClose=function(t){if(u.peers.get(t.id)!=t){var n=u.peerCandidates.get(t.id);if(!n)return;var r=n.indexOf(t);return-1!=r&&n.splice(r,1),void(0==n.length&&u.peerCandidates.delete(t.id))}var s,a=i(u.peerSegmentRequests);try{for(a.s();!(s=a.n()).done;){var o=e(s.value,2),d=o[0];o[1].peerId==t.id&&u.peerSegmentRequests.delete(d)}}catch(l){a.e(l)}finally{a.f()}u.peers.delete(t.id),u.emit("peer-data-updated"),u.emit("peer-closed",t.id)},u.onPeerDataUpdated=function(){u.emit("peer-data-updated")},u.onSegmentRequest=function(){var e=r(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==u.masterSwarmId){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,u.sementsStorage.getSegment(n,u.masterSwarmId);case 4:(r=e.sent)?t.sendSegmentData(n,r.data):t.sendSegmentAbsent(n);case 6:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),u.onSegmentLoaded=function(){var e=r(regeneratorRuntime.mark(function e(t,n,r){var i,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=u.peerSegmentRequests.get(n)){e.next=3;break}return e.abrupt("return");case 3:if(s=i.segment,!u.settings.segmentValidator){e.next=13;break}return e.prev=5,e.next=8,u.settings.segmentValidator(Object.assign(Object.assign({},s),{data:r}),"p2p",t.id);case 8:e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(5),e.abrupt("return",(u.debug("segment validator failed",e.t0),u.peerSegmentRequests.delete(n),u.emit("segment-error",s,e.t0,t.id),void u.onPeerClose(t)));case 13:u.peerSegmentRequests.delete(n),u.emit("segment-loaded",s,r,t.id);case 14:case"end":return e.stop()}},e,null,[[5,10]])}));return function(t,n,r){return e.apply(this,arguments)}}(),u.onSegmentAbsent=function(e,t){u.peerSegmentRequests.delete(t),u.emit("peer-data-updated")},u.onSegmentError=function(e,t,n){var r=u.peerSegmentRequests.get(t);r&&(u.peerSegmentRequests.delete(t),u.emit("segment-error",r.segment,n,e.id))},u.onSegmentTimeout=function(e,t){var n=u.peerSegmentRequests.get(t);n&&(u.peerSegmentRequests.delete(t),e.destroy(),u.peers.delete(n.peerId)&&u.emit("peer-data-updated"))},u.peerId=n.useP2P?function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=f,n=0;n<20-f.length;n++)t+=e.charAt(Math.floor(Math.random()*e.length));return(new TextEncoder).encode(t).buffer}():new ArrayBuffer(0),u.debug.enabled&&u.debug("peer ID",u.getPeerId(),(new TextDecoder).decode(u.peerId)),u}return d(g,[{key:"getPeers",value:function(){return this.peers}},{key:"getPeerId",value:function(){return h.Buffer.from(this.peerId).toString("hex")}},{key:"setStreamSwarmId",value:(n=r(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.streamSwarmId!==t){e.next=2;break}return e.abrupt("return");case 2:this.destroy(!0),this.streamSwarmId=t,this.masterSwarmId=n,this.debug("stream swarm ID",this.streamSwarmId),this.pendingTrackerClient={isDestroyed:!1},r=this.pendingTrackerClient,i=(new p).update(2+this.streamSwarmId).digest(),r.isDestroyed?null!=this.trackerClient&&(this.trackerClient.destroy(),this.trackerClient=null):(this.pendingTrackerClient=null,this.createClient(i));case 5:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"createClient",value:function(e){var t=this;if(this.settings.useP2P){var n={infoHash:h.Buffer.from(e,0,20),peerId:h.Buffer.from(this.peerId,0,20),announce:this.settings.trackerAnnounce,rtcConfig:this.settings.rtcConfig,port:6881,getAnnounceOpts:function(){return{numwant:t.settings.peerRequestsPerAnnounce}}},r=this.trackerClient;this.trackerClient=new u(n),this.trackerClient.on("error",this.onTrackerError),this.trackerClient.on("warning",this.onTrackerWarning),this.trackerClient.on("update",this.onTrackerUpdate),this.trackerClient.on("peer",this.onTrackerPeer),this.trackerClient.start(),null!=r&&(r.destroy(),r=null)}}},{key:"download",value:function(e){if(this.isDownloading(e))return!1;var t,n=[],r=i(this.peers.values());try{for(r.s();!(t=r.n()).done;){var s=t.value;null==s.getDownloadingSegmentId()&&s.getSegmentsMap().get(e.id)===m.MediaPeerSegmentStatus.Loaded&&n.push(s)}}catch(o){r.e(o)}finally{r.f()}if(0===n.length)return!1;var a=n[Math.floor(Math.random()*n.length)];return a.requestSegment(e.id),this.peerSegmentRequests.set(e.id,new y(a.id,e)),!0}},{key:"abort",value:function(e){var t,n=this.peerSegmentRequests.get(e.id);if(n){var r=this.peers.get(n.peerId);r&&(t=r.cancelSegmentRequest()),this.peerSegmentRequests.delete(e.id)}return t}},{key:"isDownloading",value:function(e){return this.peerSegmentRequests.has(e.id)}},{key:"getActiveDownloadsCount",value:function(){return this.peerSegmentRequests.size}},{key:"destroy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.streamSwarmId=null,this.trackerClient&&(this.trackerClient.stop(),e?(this.trackerClient.removeAllListeners("error"),this.trackerClient.removeAllListeners("warning"),this.trackerClient.removeAllListeners("update"),this.trackerClient.removeAllListeners("peer")):(this.trackerClient.destroy(),this.trackerClient=null)),this.pendingTrackerClient&&(this.pendingTrackerClient.isDestroyed=!0,this.pendingTrackerClient=null),this.peers.forEach(function(e){return e.destroy()}),this.peers.clear(),this.peerSegmentRequests.clear();var t,n=i(this.peerCandidates.values());try{for(n.s();!(t=n.n()).done;){var r,s=t.value,a=i(s);try{for(a.s();!(r=a.n()).done;){var o=r.value;o.destroy()}}catch(u){a.e(u)}finally{a.f()}}}catch(u){n.e(u)}finally{n.f()}this.peerCandidates.clear()}},{key:"sendSegmentsMapToAll",value:function(e){this.peers.forEach(function(t){return t.sendSegmentsMap(e)})}},{key:"sendSegmentsMap",value:function(e,t){var n=this.peers.get(e);n&&n.sendSegmentsMap(t)}},{key:"getOvrallSegmentsMap",value:function(){var t,n=new Map,r=i(this.peers.values());try{for(r.s();!(t=r.n()).done;){var s,a=i(t.value.getSegmentsMap());try{for(a.s();!(s=a.n()).done;){var o=e(s.value,2),u=o[0];o[1]===m.MediaPeerSegmentStatus.Loaded?n.set(u,m.MediaPeerSegmentStatus.Loaded):n.get(u)||n.set(u,m.MediaPeerSegmentStatus.LoadingByHttp)}}catch(d){a.e(d)}finally{a.f()}}}catch(d){r.e(d)}finally{r.f()}return n}}]),g}(g.STEEmitter)},tlK4:function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}function s(e){e&&e.config&&e.config.loader&&"function"==typeof e.config.loader.getEngine&&a(e,e.config.loader.getEngine())}function a(e,t){e.on("hlsFragChanged",function(e,n){var r=n.frag;t.setPlayingSegment(r.url,2!==r.byteRange.length?void 0:{offset:r.byteRange[0],length:r.byteRange[1]-r.byteRange[0]},r.start,r.duration)}),e.on("hlsDestroying",r(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.destroy();case 2:case"end":return e.stop()}},e)}))),e.on("hlsError",function(n,r){if("bufferStalledError"===r.details){var i=void 0===e.media?e.el_:e.media;if(void 0===i)return;t.setPlayingSegmentByCurrentTime(i.currentTime)}})}Object.defineProperty(t,"__esModule",{value:!0}),t.version="0.6.2",i(n("OKKN")),i(n("iXDm")),t.initHlsJsPlayer=s,t.initClapprPlayer=function(e){e.on("play",function(){var t=e.core.getCurrentPlayback();t._hls&&!t._hls._p2pm_linitialized&&(t._hls._p2pm_linitialized=!0,s(e.core.getCurrentPlayback()._hls))})},t.initFlowplayerHlsJsPlayer=function(e){e.on("ready",function(){return s(e.engine.hlsjs?e.engine.hlsjs:e.engine.hls)})},t.initVideoJsContribHlsJsPlayer=function(e){e.ready(function(){var t=e.tech_.options_;t&&t.hlsjsConfig&&t.hlsjsConfig.loader&&"function"==typeof t.hlsjsConfig.loader.getEngine&&a(e.tech_,t.hlsjsConfig.loader.getEngine())})},t.initVideoJsHlsJsPlugin=function(){null!=videojs&&null!=videojs.Html5Hlsjs&&videojs.Html5Hlsjs.addHook("beforeinitialize",function(e,t){t.config&&t.config.loader&&"function"==typeof t.config.loader.getEngine&&a(t,t.config.loader.getEngine())})},t.initMediaElementJsPlayer=function(e){e.addEventListener("hlsFragChanged",function(t){var n=e.hlsPlayer;if(n&&n.config&&n.config.loader&&"function"==typeof n.config.loader.getEngine){var r=n.config.loader.getEngine();if(t.data&&t.data.length>1){var i=t.data[1].frag;r.setPlayingSegment(i.url,2!==i.byteRange.length?void 0:{offset:i.byteRange[0],length:i.byteRange[1]-i.byteRange[0]},i.start,i.duration)}}}),e.addEventListener("hlsDestroying",r(regeneratorRuntime.mark(function t(){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!((n=e.hlsPlayer)&&n.config&&n.config.loader&&"function"==typeof n.config.loader.getEngine)){t.next=5;break}return r=n.config.loader.getEngine(),t.next=5,r.destroy();case 5:case"end":return t.stop()}},t)}))),e.addEventListener("hlsError",function(t){var n=e.hlsPlayer;n&&n.config&&n.config.loader&&"function"==typeof n.config.loader.getEngine&&void 0!==t.data&&"bufferStalledError"===t.data.details&&n.config.loader.getEngine().setPlayingSegmentByCurrentTime(n.media.currentTime)})},t.initJwPlayer=function(e,t){var n=setInterval(function(){e.hls&&e.hls.config&&(clearInterval(n),Object.assign(e.hls.config,t),s(e.hls))},200)}},tnIz:function(e,t,n){var r=n("hwdV").Buffer;function i(e,t){this._block=r.alloc(e),this._finalSize=t,this._blockSize=e,this._len=0}i.prototype.update=function(e,t){"string"==typeof e&&(e=r.from(e,t=t||"utf8"));for(var n=this._block,i=this._blockSize,s=e.length,a=this._len,o=0;o<s;){for(var u=a%i,d=Math.min(s-o,i-u),l=0;l<d;l++)n[u+l]=e[o+l];o+=d,(a+=d)%i==0&&this._update(n)}return this._len+=s,this},i.prototype.digest=function(e){var t=this._len%this._blockSize;this._block[t]=128,this._block.fill(0,t+1),t>=this._finalSize&&(this._update(this._block),this._block.fill(0));var n=8*this._len;if(n<=4294967295)this._block.writeUInt32BE(n,this._blockSize-4);else{var r=(4294967295&n)>>>0;this._block.writeUInt32BE((n-r)/4294967296,this._blockSize-8),this._block.writeUInt32BE(r,this._blockSize-4)}this._update(this._block);var i=this._hash();return e?i.toString(e):i},i.prototype._update=function(){throw new Error("_update must be implemented by subclass")},e.exports=i},uOj1:function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),t.version="0.6.2",r(n("O885")),r(n("lcUr"))},xzjP:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function e(t,n){o(this,e),this.value=t,this.timeStamp=n};t.BandwidthApproximator=function(){function e(){o(this,e),this.lastBytes=[],this.currentBytesSum=0,this.lastBandwidth=[]}return d(e,[{key:"addBytes",value:function(e,t){for(this.lastBytes.push(new r(e,t)),this.currentBytesSum+=e;t-this.lastBytes[0].timeStamp>1e3;)this.currentBytesSum-=this.lastBytes.shift().value;this.lastBandwidth.push(new r(this.currentBytesSum/1e3,t))}},{key:"getBandwidth",value:function(e){for(;0!=this.lastBandwidth.length&&e-this.lastBandwidth[0].timeStamp>6e4;)this.lastBandwidth.shift();var t,n=0,r=i(this.lastBandwidth);try{for(r.s();!(t=r.n()).done;){var s=t.value;s.value>n&&(n=s.value)}}catch(a){r.e(a)}finally{r.f()}return n}},{key:"getSmoothInterval",value:function(){return 1e3}},{key:"getMeasureInterval",value:function(){return 6e4}}]),e}()},yLkh:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HlsJsLoader=function(){function e(t){o(this,e),this.stats={},this.segmentManager=t}var t;return d(e,[{key:"load",value:(t=r(regeneratorRuntime.mark(function e(t,n,r){var i,s,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.type){e.next=13;break}return e.prev=1,e.next=4,this.segmentManager.loadPlaylist(t.url);case 4:i=e.sent,this.successPlaylist(i,t,r),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),this.error(e.t0,t,r);case 11:e.next=27;break;case 13:if(!t.frag){e.next=26;break}return e.prev=14,e.next=17,this.segmentManager.loadSegment(t.url,null==t.rangeStart||null==t.rangeEnd?void 0:{offset:t.rangeStart,length:t.rangeEnd-t.rangeStart});case 17:void 0!==(s=e.sent).content&&setTimeout(function(){return a.successSegment(s.content,s.downloadBandwidth,t,r)},0),e.next=24;break;case 21:e.prev=21,e.t1=e.catch(14),setTimeout(function(){return a.error(e.t1,t,r)},0);case 24:e.next=27;break;case 26:console.warn("Unknown load request",t);case 27:case"end":return e.stop()}},e,this,[[1,8],[14,21]])})),function(e,n,r){return t.apply(this,arguments)})},{key:"abort",value:function(e){this.segmentManager.abortSegment(e.url,null==e.rangeStart||null==e.rangeEnd?void 0:{offset:e.rangeStart,length:e.rangeEnd-e.rangeStart})}},{key:"successPlaylist",value:function(e,t,n){var r=performance.now();this.stats.trequest=r-300,this.stats.tfirst=r-200,this.stats.tload=r,this.stats.loaded=e.response.length,n.onSuccess({url:e.responseURL,data:e.response},this.stats,t)}},{key:"successSegment",value:function(e,t,n,r){var i=performance.now(),s=e.byteLength/(void 0===t||t<=0?12500:t);this.stats.trequest=i-1-s,this.stats.tfirst=i-s,this.stats.tload=i,this.stats.loaded=e.byteLength,r.onSuccess({url:n.url,data:e},this.stats,n)}},{key:"error",value:function(e,t,n){n.onError(e,t)}}]),e}()}}])}();